<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0" xmlns:media="http://search.yahoo.com/mrss/"><channel><title><![CDATA[柴魚筆記本]]></title><description><![CDATA[程式・軟體・攝影]]></description><link>https://vincent87720.github.io/</link><image><url>https://vincent87720.github.io/favicon.png</url><title>柴魚筆記本</title><link>https://vincent87720.github.io/</link></image><generator>Ghost 5.71</generator><lastBuildDate>Sat, 17 Feb 2024 16:44:32 GMT</lastBuildDate><atom:link href="https://vincent87720.github.io/rss/" rel="self" type="application/rss+xml"/><ttl>60</ttl><item><title><![CDATA[HAVING語句]]></title><description><![CDATA[HAVING語句用來篩選聚合函數執行後的結果]]></description><link>https://vincent87720.github.io/sql-having-clause/</link><guid isPermaLink="false">65d0dfbd2d9f94000158a994</guid><category><![CDATA[SQL]]></category><category><![CDATA[Database]]></category><dc:creator><![CDATA[Katsuobushi]]></dc:creator><pubDate>Sat, 17 Feb 2024 16:37:16 GMT</pubDate><media:content url="https://vincent87720.github.io/content/images/2024/02/jan-antonin-kolar-lRoX0shwjUQ-unsplash_database.jpeg" medium="image"/><content:encoded><![CDATA[<img src="https://vincent87720.github.io/content/images/2024/02/jan-antonin-kolar-lRoX0shwjUQ-unsplash_database.jpeg" alt="HAVING&#x8A9E;&#x53E5;"><p><code>HAVING</code>&#x8A9E;&#x53E5;&#x7528;&#x4F86;&#x7BE9;&#x9078;&#x805A;&#x5408;&#x51FD;&#x6578;&#x57F7;&#x884C;&#x5F8C;&#x7684;&#x7D50;&#x679C;</p>
<h2 id="%E7%82%BA%E4%BB%80%E9%BA%BC%E4%B8%8D%E4%BD%BF%E7%94%A8where%E7%AF%A9%E9%81%B8">&#x70BA;&#x4EC0;&#x9EBC;&#x4E0D;&#x4F7F;&#x7528;WHERE&#x7BE9;&#x9078;</h2>
<p>&#x4F7F;&#x7528;<code>HAVING</code>&#x800C;&#x4E0D;&#x4F7F;&#x7528;<code>WHERE</code>&#x4F86;&#x7BE9;&#x9078;&#x805A;&#x5408;&#x51FD;&#x6578;&#x57F7;&#x884C;&#x5F8C;&#x7684;&#x7D50;&#x679C;&#x8207;SQL&#x8A9E;&#x53E5;&#x7684;&#x57F7;&#x884C;&#x9806;&#x5E8F;&#x6709;&#x95DC;&#xFF0C;&#x5404;&#x500B;SQL&#x8A9E;&#x53E5;&#x7684;&#x57F7;&#x884C;&#x9806;&#x5E8F;&#x5982;&#x4E0B;&#xFF1A;</p>
<table>
<thead>
<tr>
<th>&#x9806;&#x5E8F;</th>
<th>&#x8A9E;&#x53E5;</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>FROM</td>
</tr>
<tr>
<td>2</td>
<td>WHERE</td>
</tr>
<tr>
<td>3</td>
<td>GROUP BY</td>
</tr>
<tr>
<td>4</td>
<td>HAVING</td>
</tr>
<tr>
<td>5</td>
<td>SELECT</td>
</tr>
<tr>
<td>6</td>
<td>ORDER BY</td>
</tr>
<tr>
<td>7</td>
<td>LIMIT</td>
</tr>
</tbody>
</table>
<p>&#x8981;&#x62FF;&#x5230;&#x805A;&#x5408;&#x51FD;&#x6578;&#x57F7;&#x884C;&#x904E;&#x5F8C;&#x7684;&#x7D50;&#x679C;&#xFF0C;&#x6211;&#x5011;&#x5FC5;&#x9808;&#x4F7F;&#x7528;&#x805A;&#x5408;&#x51FD;&#x6578;&#x9032;&#x884C;&#x904B;&#x7B97;&#xFF0C;&#x800C;&#x8981;&#x4F7F;&#x7528;&#x805A;&#x5408;&#x51FD;&#x6578;&#x53C8;&#x5FC5;&#x9808;&#x5F97;&#x4F7F;&#x7528;<code>GROUP BY</code>&#x8A9E;&#x53E5;&#x4F86;&#x9650;&#x5B9A;&#x6211;&#x5011;&#x8981;&#x7528;&#x4F86;&#x5206;&#x7D44;&#x7684;&#x689D;&#x4EF6;&#x3002;</p>
<p>&#x5F9E;&#x57F7;&#x884C;&#x9806;&#x5E8F;&#x8868;&#x4E2D;&#x6211;&#x5011;&#x53EF;&#x4EE5;&#x770B;&#x5230;<code>WHERE</code>&#x6703;&#x5728;<code>GROUP BY</code>&#x4E4B;&#x524D;&#x57F7;&#x884C;&#xFF0C;&#x4F46;&#x662F;&#x805A;&#x5408;&#x51FD;&#x6578;&#x57F7;&#x884C;&#x904E;&#x5F8C;&#x7684;&#x7D50;&#x679C;&#x6703;&#x5728;<code>GROUP BY</code>&#x4E14;&#x57F7;&#x884C;&#x5B8C;&#x805A;&#x5408;&#x51FD;&#x6578;&#x8A08;&#x7B97;&#x4E4B;&#x5F8C;&#x624D;&#x6703;&#x62FF;&#x5230;&#xFF0C;&#x5728;<code>WHERE</code>&#x57F7;&#x884C;&#x7684;&#x6642;&#x5019;&#x9084;&#x6C92;&#x6709;&#x57F7;&#x884C;<code>GROUP BY</code>&#xFF0C;&#x4E5F;&#x9084;&#x6C92;&#x6709;&#x57F7;&#x884C;&#x805A;&#x5408;&#x51FD;&#x6578;&#x904B;&#x7B97;&#xFF0C;&#x66F4;&#x4E0D;&#x53EF;&#x80FD;&#x62FF;&#x5F97;&#x5230;&#x805A;&#x5408;&#x51FD;&#x6578;&#x57F7;&#x884C;&#x5F8C;&#x7684;&#x7D50;&#x679C;&#xFF0C;&#x9019;&#x5C31;&#x662F;&#x70BA;&#x751A;&#x9EBC;&#x6211;&#x5011;&#x7121;&#x6CD5;&#x5728;<code>WHERE</code>&#x57F7;&#x884C;&#x6642;&#x5C31;&#x4F7F;&#x7528;&#x805A;&#x5408;&#x51FD;&#x6578;&#x7684;&#x7D50;&#x679C;&#x4F5C;&#x70BA;&#x7BE9;&#x9078;&#x689D;&#x4EF6;&#x7684;&#x539F;&#x56E0;&#x3002;</p>
<h2 id="%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8having%E7%AF%A9%E9%81%B8">&#x5982;&#x4F55;&#x4F7F;&#x7528;HAVING&#x7BE9;&#x9078;</h2>
<p>&#x5047;&#x8A2D;&#x6211;&#x5011;&#x6709;&#x4E00;&#x500B;&#x54E1;&#x5DE5;&#x8CC7;&#x6599;&#x8868;&#xFF08;Employee&#xFF09;&#xFF0C;&#x5305;&#x542B;&#x7DE8;&#x865F;&#x3001;&#x59D3;&#x540D;&#x53CA;&#x90E8;&#x9580;&#x6B04;&#x4F4D;&#xFF0C;&#x5176;&#x4E2D;&#x8CA1;&#x52D9;&#x90E8;&#x6709;&#x4E09;&#x500B;&#x4EBA;&#xFF0C;&#x54C1;&#x7BA1;&#x90E8;&#x6709;&#x4E09;&#x500B;&#x4EBA;&#xFF0C;&#x4F01;&#x5283;&#x90E8;&#x6709;&#x56DB;&#x500B;&#x4EBA;&#x3002;</p>
<table>
<thead>
<tr>
<th>Index</th>
<th>Name</th>
<th>Department</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>&#x6797;&#x6C34;&#x73E0;</td>
<td>&#x8CA1;&#x52D9;&#x90E8;</td>
</tr>
<tr>
<td>2</td>
<td>&#x912D;&#x6CD5;&#x6B61;</td>
<td>&#x8CA1;&#x52D9;&#x90E8;</td>
</tr>
<tr>
<td>3</td>
<td>&#x8449;&#x4F69;&#x82B3;</td>
<td>&#x8CA1;&#x52D9;&#x90E8;</td>
</tr>
<tr>
<td>4</td>
<td>&#x8521;&#x4F69;&#x821C;</td>
<td>&#x54C1;&#x7BA1;&#x90E8;</td>
</tr>
<tr>
<td>5</td>
<td>&#x7A0B;&#x6842;&#x537F;</td>
<td>&#x54C1;&#x7BA1;&#x90E8;</td>
</tr>
<tr>
<td>6</td>
<td>&#x738B;&#x96C5;&#x7B51;</td>
<td>&#x54C1;&#x7BA1;&#x90E8;</td>
</tr>
<tr>
<td>7</td>
<td>&#x9673;&#x79CB;&#x5357;</td>
<td>&#x4F01;&#x5283;&#x90E8;</td>
</tr>
<tr>
<td>8</td>
<td>&#x8D99;&#x5FD7;&#x5049;</td>
<td>&#x4F01;&#x5283;&#x90E8;</td>
</tr>
<tr>
<td>9</td>
<td>&#x9322;&#x667A;&#x5091;</td>
<td>&#x4F01;&#x5283;&#x90E8;</td>
</tr>
<tr>
<td>10</td>
<td>&#x8B1D;&#x656C;&#x9054;</td>
<td>&#x4F01;&#x5283;&#x90E8;</td>
</tr>
</tbody>
</table>
<p>&#x5982;&#x679C;&#x6211;&#x5011;&#x60F3;&#x5F97;&#x5230;&#x90E8;&#x9580;&#x4EBA;&#x6578;&#x5927;&#x65BC;3&#x4EBA;&#x7684;&#x90E8;&#x9580;&#xFF0C;&#x6211;&#x5011;&#x5FC5;&#x9808;&#x5148;&#x4F7F;&#x7528;<code>GROUP BY</code>&#x5C07;&#x90E8;&#x9580;&#x5206;&#x7D44;&#xFF0C;&#x518D;&#x4F7F;&#x7528;<code>Count()</code>&#x9019;&#x500B;&#x805A;&#x5408;&#x51FD;&#x6578;&#x8A08;&#x7B97;&#x6BCF;&#x500B;&#x90E8;&#x9580;&#x7684;&#x4EBA;&#x6578;&#xFF0C;&#x63A5;&#x8457;&#x4F7F;&#x7528;<code>HAVING</code>&#x6BD4;&#x8F03;&#x5404;&#x90E8;&#x9580;&#x4EBA;&#x6578;&#x662F;&#x5426;&#x5927;&#x65BC;3&#xFF0C;&#x6311;&#x51FA;&#x5927;&#x65BC;3&#x4EBA;&#x7684;&#x90E8;&#x9580;&#xFF0C;&#x6700;&#x5F8C;&#x4F7F;&#x7528;SELECT&#x53D6;&#x51FA;&#x90E8;&#x9580;&#x7684;&#x540D;&#x7A31;&#x4EE5;&#x53CA;&#x4EBA;&#x6578;&#x3002;</p>
<pre><code class="language-sql">SELECT&#xA0;Department, COUNT(Department)
FROM&#xA0;Employee
GROUP&#xA0;BY&#xA0;Department
HAVING&#xA0;COUNT(Department) &gt;&#xA0;3;
</code></pre>
<h6 id="%E5%8F%83%E8%80%83%E8%B3%87%E6%96%99">&#x53C3;&#x8003;&#x8CC7;&#x6599;</h6>
<ul>
<li><a href="https://blog.csdn.net/zhaomengszu/article/details/80784096?ref=localhost">SQL&#x4E2D;where&#x5B50;&#x53E5;&#x4E2D;&#x4E0D;&#x80FD;&#x51FA;&#x73B0;&#x805A;&#x5408;&#x51FD;&#x6570;&#x7684;&#x539F;&#x56E0;</a></li>
<li><a href="https://www.w3schools.com/sql/sql_having.asp?ref=localhost">SQL&#xA0;HAVING&#xA0;Clause</a></li>
<li><a href="https://www.sisense.com/blog/sql-query-order-of-operations/?ref=localhost">SQL Query Order of Execution</a></li>
</ul>
]]></content:encoded></item><item><title><![CDATA[Virtual]]></title><description><![CDATA[設定Virtual關鍵字後，允許衍生類別（Derived Class）覆寫（override）其狀態或行為。]]></description><link>https://vincent87720.github.io/csharp-virtual/</link><guid isPermaLink="false">65a4caf76883f700018af452</guid><category><![CDATA[C#]]></category><dc:creator><![CDATA[Katsuobushi]]></dc:creator><pubDate>Mon, 15 Jan 2024 06:06:50 GMT</pubDate><media:content url="https://vincent87720.github.io/content/images/2024/01/visualStudioCode.png" medium="image"/><content:encoded><![CDATA[<img src="https://vincent87720.github.io/content/images/2024/01/visualStudioCode.png" alt="Virtual"><p>&#x8A2D;&#x5B9A;Virtual&#x95DC;&#x9375;&#x5B57;&#x5F8C;&#xFF0C;&#x5141;&#x8A31;&#x884D;&#x751F;&#x985E;&#x5225;&#xFF08;Derived Class&#xFF09;&#x8986;&#x5BEB;&#xFF08;override&#xFF09;&#x5176;&#x72C0;&#x614B;&#x6216;&#x884C;&#x70BA;&#x3002;</p>
<h2 id="%E5%90%8D%E8%A9%9E%E5%AE%9A%E7%BE%A9">&#x540D;&#x8A5E;&#x5B9A;&#x7FA9;</h2>
<p>&#x70BA;&#x4E86;&#x907F;&#x514D;&#x6DF7;&#x6DC6;&#xFF0C;&#x5148;&#x4F86;&#x9EDE;&#x540D;&#x8A5E;&#x5B9A;&#x7FA9;&#xFF1A;</p>
<ul>
<li>&#x57FA;&#x790E;&#x985E;&#x5225;&#xFF08;Base Class&#xFF09;&#xFF1A;&#x5728;&#x7269;&#x4EF6;&#x5C0E;&#x5411;&#x7E7C;&#x627F;&#x95DC;&#x4FC2;&#x4E2D;&#xFF0C;&#x626E;&#x6F14;&#x7236;&#x985E;&#x5225;&#x7684;&#x89D2;&#x8272;</li>
<li>&#x884D;&#x751F;&#x985E;&#x5225;&#xFF08;Derived Class&#xFF09;&#xFF1A;&#x5728;&#x7269;&#x4EF6;&#x5C0E;&#x5411;&#x7E7C;&#x627F;&#x95DC;&#x4FC2;&#x4E2D;&#xFF0C;&#x626E;&#x6F14;&#x5B50;&#x985E;&#x5225;&#x7684;&#x89D2;&#x8272;</li>
<li>&#x8986;&#x5BEB;&#xFF08;Override&#xFF09;&#xFF1A;&#x884D;&#x751F;&#x985E;&#x5225;&#x4E2D;&#x7684;&#x67D0;&#x500B;&#x5BE6;&#x4F5C;&#x53D6;&#x4EE3;&#x57FA;&#x790E;&#x985E;&#x5225;&#x4E2D;&#x7684;&#x67D0;&#x500B;&#x5BE6;&#x4F5C;&#x7684;&#x884C;&#x70BA;</li>
<li>&#x865B;&#x64EC;&#x6210;&#x54E1;&#xFF08;Virtual Member&#xFF09;&#xFF1A;&#x5728;&#x57FA;&#x790E;&#x985E;&#x5225;&#x4E2D;&#x7684;&#x6210;&#x54E1;&#x589E;&#x52A0;&#x4E86;virtual&#x95DC;&#x9375;&#x5B57;&#x5F8C;&#xFF0C;&#x6211;&#x5011;&#x5C07;&#x8A72;&#x6210;&#x54E1;&#x7A31;&#x70BA;&#x865B;&#x64EC;&#x6210;&#x54E1;</li>
<li>&#x8986;&#x5BEB;&#x6210;&#x54E1;&#xFF08;Overriding Member&#xFF09;&#xFF1A;&#x884D;&#x751F;&#x985E;&#x5225;&#x7684;&#x6210;&#x54E1;&#x8986;&#x5BEB;&#x57FA;&#x790E;&#x985E;&#x5225;&#x7684;&#x865B;&#x64EC;&#x6210;&#x54E1;&#x5F8C;&#xFF0C;&#x6211;&#x5011;&#x5C07;&#x884D;&#x751F;&#x985E;&#x5225;&#x4E2D;&#x7684;&#x8A72;&#x6210;&#x54E1;&#x7A31;&#x70BA;&#x8986;&#x5BEB;&#x6210;&#x54E1;&#x3002;</li>
</ul>
<h2 id="%E8%99%9B%E6%93%AC%E6%88%90%E5%93%A1%E7%9A%84%E7%89%B9%E6%80%A7">&#x865B;&#x64EC;&#x6210;&#x54E1;&#x7684;&#x7279;&#x6027;</h2>
<p>Virtual&#x95DC;&#x9375;&#x5B57;&#x53EF;&#x4EE5;&#x7528;&#x5728;&#x65B9;&#x6CD5;&#xFF08;method&#xFF09;&#x3001;&#x5C6C;&#x6027;&#xFF08;property&#xFF09;&#x3001;&#x7D22;&#x5F15;&#x5B50;&#xFF08;indexer&#xFF09;&#x6216;&#x4E8B;&#x4EF6;&#xFF08;event&#xFF09;&#xFF0C;&#x6211;&#x5011;&#x5C07;&#x9019;&#x4E9B;&#x88AB;&#x52A0;&#x4E0A;virtual&#x95DC;&#x9375;&#x5B57;&#x7684;&#x6210;&#x54E1;&#x7A31;&#x70BA;&#x865B;&#x64EC;&#x6210;&#x54E1;&#x3002;</p>
<p>&#x9019;&#x4E9B;&#x865B;&#x64EC;&#x6210;&#x54E1;&#x300C;&#x5141;&#x8A31;&#x300D;&#x88AB;&#x884D;&#x751F;&#x985E;&#x5225;&#x8986;&#x5BEB;&#xFF0C;&#x63DB;&#x53E5;&#x8A71;&#x8AAA;&#x5C31;&#x662F;&#x53EF;&#x8986;&#x5BEB;&#x53EF;&#x4E0D;&#x8986;&#x5BEB;&#xFF0C;&#x5B8C;&#x5168;&#x770B;&#x884D;&#x4F38;&#x985E;&#x5225;&#x7684;&#x5FC3;&#x60C5;&#x3002;</p>
<p>&#x800C;&#x56E0;&#x70BA;&#x6709;&#x4E9B;&#x60F3;&#x8986;&#x5BEB;&#x6709;&#x4E9B;&#x4E0D;&#x60F3;&#x8986;&#x5BEB;&#x3002;&#x6709;&#x8986;&#x5BEB;&#x7684;&#x884D;&#x751F;&#x985E;&#x5225;&#x4E2D;&#x4E00;&#x5B9A;&#x6703;&#x5BE6;&#x4F5C;&#x67D0;&#x4E9B;&#x7A0B;&#x5F0F;&#x78BC;&#x8986;&#x5BEB;&#x865B;&#x64EC;&#x6210;&#x54E1;&#xFF0C;&#x81EA;&#x7136;&#x6703;&#x6709;&#x6771;&#x897F;&#x53EF;&#x4EE5;&#x88AB;&#x57F7;&#x884C;&#x3002;&#x800C;&#x6C92;&#x6709;&#x8986;&#x5BEB;&#x7684;&#x884D;&#x751F;&#x985E;&#x5225;&#x4E2D;&#x4E00;&#x5B9A;&#x4E0D;&#x6703;&#x6709;&#x7A0B;&#x5F0F;&#x78BC;&#x53EF;&#x4EE5;&#x88AB;&#x57F7;&#x884C;&#x3002;&#x70BA;&#x4E86;&#x7167;&#x9867;&#x5230;&#x90A3;&#x4E9B;&#x6C92;&#x6709;&#x8986;&#x5BEB;&#x7684;&#xFF0C;&#x5728;&#x865B;&#x64EC;&#x6210;&#x54E1;&#x5C31;&#x5FC5;&#x9808;&#x5BE6;&#x4F5C;&#x67D0;&#x4E9B;&#x6771;&#x897F;&#x8B93;&#x90A3;&#x4E9B;&#x6C92;&#x6709;&#x8981;&#x8986;&#x5BEB;&#x7684;&#x57F7;&#x884C;&#x3002;&#x9019;&#x5C31;&#x662F;&#x70BA;&#x4EC0;&#x9EBC;&#x4F7F;&#x7528;virtual&#x5BA3;&#x544A;&#x7684;&#x9019;&#x4E9B;&#x6210;&#x54E1;&#x9700;&#x8981;&#x5BE6;&#x4F5C;&#xFF0C;&#x800C;&#x7528;abstract&#x95DC;&#x9375;&#x5B57;&#x5BA3;&#x544A;&#x7684;&#x6210;&#x54E1;&#x4E0D;&#x7528;&#x5BE6;&#x4F5C;&#x7684;&#x539F;&#x56E0;&#x3002;</p>
<h2 id="%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95">&#x4F7F;&#x7528;&#x65B9;&#x6CD5;</h2>
<p>&#x4F7F;&#x7528;Virtual&#x7684;&#x65B9;&#x6CD5;&#x5F88;&#x7C21;&#x55AE;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x5169;&#x500B;&#x6B65;&#x9A5F;&#xFF1A;</p>
<ol>
<li>&#x5728;&#x57FA;&#x790E;&#x985E;&#x5225;&#x4E2D;&#x8981;&#x88AB;&#x8986;&#x5BEB;&#x7684;&#x6210;&#x54E1;&#x52A0;&#x4E0A;<code>virtual</code>&#x95DC;&#x9375;&#x5B57;</li>
<li>&#x5728;&#x884D;&#x751F;&#x985E;&#x5225;&#x4E2D;&#x8981;&#x8986;&#x5BEB;&#x865B;&#x64EC;&#x6210;&#x54E1;&#x7684;&#x540C;&#x540D;&#x540C;&#x578B;&#x614B;&#x7684;&#x6210;&#x54E1;&#x52A0;&#x4E0A;<code>override</code>&#x95DC;&#x9375;&#x5B57;</li>
</ol>
<p>&#x4F7F;&#x7528;&#x6B64;&#x65B9;&#x6CD5;&#x4FBF;&#x53EF;&#x4EE5;&#x6B63;&#x78BA;&#x7684;&#x5BA3;&#x544A;&#x865B;&#x64EC;&#x6210;&#x54E1;&#x53CA;&#x8986;&#x5BEB;&#x6210;&#x54E1;&#x3002;</p>
<h2 id="override%E9%97%9C%E9%8D%B5%E5%AD%97%E7%9A%84%E9%87%8D%E8%A6%81%E6%80%A7">Override&#x95DC;&#x9375;&#x5B57;&#x7684;&#x91CD;&#x8981;&#x6027;</h2>
<p>&#x7531;&#x65BC;&#x7DE8;&#x8B6F;&#x5668;&#x7684;&#x6AA2;&#x67E5;&#x6A5F;&#x5236;&#xFF0C;&#x6211;&#x5011;&#x5FC5;&#x9808;&#x660E;&#x78BA;&#x5BA3;&#x544A;override&#x624D;&#x80FD;&#x6B63;&#x78BA;&#x7684;&#x8986;&#x5BEB;&#x57FA;&#x790E;&#x985E;&#x5225;&#x7684;&#x865B;&#x64EC;&#x6210;&#x54E1;&#x3002;&#x6AA2;&#x67E5;&#x6D41;&#x7A0B;&#x5982;&#x4E0B;&#xFF1A;</p>
<ol>
<li>&#x6AA2;&#x67E5;&#x5BA3;&#x544A;&#x985E;&#x5225;&#x4E2D;&#xFF0C;&#x8A72;&#x6210;&#x54E1;&#x662F;&#x5426;&#x88AB;&#x5BA3;&#x544A;&#x70BA;&#x865B;&#x64EC;&#x6210;&#x54E1;&#xFF0C;&#x82E5;&#x4E0D;&#x662F;&#x865B;&#x64EC;&#x6210;&#x54E1;&#x5247;&#x76F4;&#x63A5;&#x57F7;&#x884C;&#x8A72;&#x6210;&#x54E1;&#x3002;</li>
<li>&#x82E5;&#x8A72;&#x6210;&#x54E1;&#x662F;&#x865B;&#x64EC;&#x6210;&#x54E1;&#xFF0C;&#x5247;&#x6AA2;&#x67E5;&#x5BE6;&#x9AD4;&#x985E;&#x5225;&#x4E2D;&#xFF0C;&#x8A72;&#x6210;&#x54E1;&#x662F;&#x5426;&#x6709;&#x88AB;&#x52A0;&#x4E0A;<code>override</code>&#x95DC;&#x9375;&#x5B57;&#xFF0C;&#x82E5;&#x6709;&#x5247;&#x57F7;&#x884C;&#x5E36;&#x6709;<code>override</code>&#x7684;&#x6210;&#x54E1;&#x3002;</li>
<li>&#x82E5;&#x5BE6;&#x9AD4;&#x985E;&#x5225;&#x7684;&#x6210;&#x54E1;&#x6C92;&#x6709;&#x88AB;&#x52A0;&#x4E0A;<code>override</code>&#xFF0C;&#x5247;&#x6703;&#x4E00;&#x76F4;&#x5F80;&#x7236;&#x985E;&#x5225;&#x627E;&#xFF0C;&#x76F4;&#x5230;&#x627E;&#x5230;&#x7B2C;&#x4E00;&#x500B;&#x8986;&#x5BEB;&#x865B;&#x64EC;&#x6210;&#x54E1;&#x7684;&#x985E;&#x5225;&#xFF0C;&#x4E26;&#x57F7;&#x884C;&#x8A72;&#x985E;&#x5225;&#x5167;&#x7684;&#x6210;&#x54E1;&#x3002;</li>
</ol>
<p>&#x4F9D;&#x7167;&#x6B64;&#x7279;&#x6027;&#x53EF;&#x5F97;&#x77E5;&#x82E5;&#x6C92;&#x6709;&#x5728;&#x884D;&#x751F;&#x985E;&#x5225;&#x4E2D;&#x5C07;&#x6210;&#x54E1;&#x5BA3;&#x544A;&#x70BA;override&#xFF0C;&#x5247;&#x4E0D;&#x6703;&#x8986;&#x5BEB;&#x57FA;&#x790E;&#x985E;&#x5225;&#x4E2D;&#x7684;&#x865B;&#x64EC;&#x6210;&#x54E1;&#xFF0C;&#x82E5;&#x8981;&#x8986;&#x5BEB;&#x865B;&#x64EC;&#x6210;&#x54E1;&#xFF0C;&#x4E00;&#x5B9A;&#x8981;&#x52A0;&#x4E0A;override&#x95DC;&#x9375;&#x5B57;&#x78BA;&#x4FDD;&#x8986;&#x5BEB;&#x884C;&#x70BA;&#x7684;&#x6B63;&#x78BA;&#x6027;&#x3002;</p>
<h6 id="%E5%8F%83%E8%80%83%E8%B3%87%E6%96%99">&#x53C3;&#x8003;&#x8CC7;&#x6599;</h6>
<ul>
<li><a href="https://learn.microsoft.com/zh-tw/dotnet/csharp/language-reference/keywords/virtual?ref=localhost">virtual (C# &#x53C3;&#x8003;)</a></li>
<li><a href="https://dotblogs.com.tw/MemoryRecall/2023/06/15/173115?ref=localhost">Virtual &#x4FEE;&#x98FE;&#x8A5E;&#x4F7F;&#x7528;&#x5FC3;&#x5F97;&#x7B46;&#x8A18;</a></li>
</ul>
]]></content:encoded></item><item><title><![CDATA[驗證 C# 中的 Guid 屬性]]></title><description><![CDATA[在使用[Required]這個標籤進行 Guid 型態屬性的驗證時，原本預期沒有填入該欄位時會被檔下來，但用在 Guid 型態的屬性上居然沒效。本篇紀錄如何以「自訂驗證標籤」及「更改欄位型態」兩個方法來解決這個問題。]]></description><link>https://vincent87720.github.io/csharp-validation-attribute-of-guid/</link><guid isPermaLink="false">654673fcb534770001efa757</guid><category><![CDATA[C#]]></category><dc:creator><![CDATA[Katsuobushi]]></dc:creator><pubDate>Sat, 04 Nov 2023 16:46:29 GMT</pubDate><media:content url="https://vincent87720.github.io/content/images/2023/11/jason-dent-3wPJxh-piRw-unsplash-1.jpg" medium="image"/><content:encoded><![CDATA[<img src="https://vincent87720.github.io/content/images/2023/11/jason-dent-3wPJxh-piRw-unsplash-1.jpg" alt="&#x9A57;&#x8B49; C# &#x4E2D;&#x7684; Guid &#x5C6C;&#x6027;"><p>&#x5728;&#x4F7F;&#x7528;<code>[Required]</code>&#x9019;&#x500B;&#x6A19;&#x7C64;&#x9032;&#x884C; Guid &#x578B;&#x614B;&#x5C6C;&#x6027;&#x7684;&#x9A57;&#x8B49;&#x6642;&#xFF0C;&#x539F;&#x672C;&#x9810;&#x671F;&#x6C92;&#x6709;&#x586B;&#x5165;&#x8A72;&#x6B04;&#x4F4D;&#x6642;&#x6703;&#x88AB;&#x6A94;&#x4E0B;&#x4F86;&#xFF0C;&#x4F46;&#x7528;&#x5728; Guid &#x578B;&#x614B;&#x7684;&#x5C6C;&#x6027;&#x4E0A;&#x5C45;&#x7136;&#x6C92;&#x6548;&#x3002;&#x672C;&#x7BC7;&#x7D00;&#x9304;&#x5982;&#x4F55;&#x4EE5;&#x300C;&#x81EA;&#x8A02;&#x9A57;&#x8B49;&#x6A19;&#x7C64;&#x300D;&#x53CA;&#x300C;&#x66F4;&#x6539;&#x6B04;&#x4F4D;&#x578B;&#x614B;&#x300D;&#x5169;&#x500B;&#x65B9;&#x6CD5;&#x4F86;&#x89E3;&#x6C7A;&#x9019;&#x500B;&#x554F;&#x984C;&#x3002;</p>
<h2 id="%E7%92%B0%E5%A2%83">&#x74B0;&#x5883;</h2>
<ul>
<li>macOS Sonoma 14.0(Apple M1 Pro)</li>
<li>.NET 6.0</li>
<li>Visual Studio Community 2022 for Mac 17.6.6</li>
</ul>
<h2 id="%E6%83%85%E5%A2%83">&#x60C5;&#x5883;</h2>
<p>&#x9996;&#x5148;&#x6709;&#x4E00;&#x500B;Model&#xFF0C;&#x7528;&#x65BC;&#x5B58;&#x653E;&#x4F7F;&#x7528;&#x8005;&#x8F38;&#x5165;&#x7684;&#x8CC7;&#x6599;</p>
<pre><code class="language-csharp">public class PostViewModel
{
    [Required]
    public Guid ProjectId { get; set; }

    public Guid? SupervisorId { get; set; }
}
</code></pre>
<p>&#x4F7F;&#x7528;&#x8005;&#x547C;&#x53EB;&#x4F7F;&#x7528;&#x6B64;<code>PostViewModel</code>&#x4F5C;&#x70BA;&#x53C3;&#x6578;&#x7684;API&#xFF0C;&#x50B3;&#x9001;&#x4E00;&#x500B;&#x7A7A;&#x7684;JSON&#x7D66;API</p>
<pre><code class="language-jsonld">{
    
}
</code></pre>
<p>&#x539F;&#x672C;&#x9810;&#x671F;&#x61C9;&#x8A72;&#x6703;&#x8DF3;&#x51FA;&#x985E;&#x4F3C;<code>The ProjectId field is required.</code>&#x4E4B;&#x985E;&#x7684;&#x932F;&#x8AA4;&#xFF0C;&#x7D50;&#x679C;&#x4EFB;&#x4F55;&#x932F;&#x8AA4;&#x90FD;&#x6C92;&#x8DF3;&#xFF0C;&#x9084;&#x76F4;&#x63A5;&#x8B93;&#x6211;&#x904E;&#x4E86;&#x3002;</p>
<p>&#x67E5;&#x4E86;&#x4E00;&#x4E0B;&#x767C;&#x73FE; Guid &#x662F;&#x4F7F;&#x7528; struct &#x5BE6;&#x4F5C;&#x7684;&#xFF0C;struct &#x662F;<a href="https://learn.microsoft.com/zh-tw/dotnet/csharp/language-reference/builtin-types/value-types?ref=localhost">&#x5BE6;&#x503C;&#x985E;&#x578B;</a>&#xFF0C;&#x9810;&#x8A2D;&#x503C;&#x662F;<code>Guid.Empty</code>&#xFF0C;&#x4F7F;&#x7528;<code>[Required]</code>&#x7121;&#x6CD5;&#x6709;&#x6548;&#x7684;&#x9A57;&#x8B49; Guid &#x578B;&#x614B;&#x7684;&#x5C6C;&#x6027;&#x3002;</p>
<h2 id="%E8%87%AA%E8%A8%82%E9%A9%97%E8%AD%89%E6%A8%99%E7%B1%A4%E6%96%B9%E6%B3%95">&#x81EA;&#x8A02;&#x9A57;&#x8B49;&#x6A19;&#x7C64;&#x65B9;&#x6CD5;</h2>
<p>&#x81EA;&#x8A02;&#x9A57;&#x8B49;&#x6A19;&#x7C64;&#xFF08;ValidationAttribute&#xFF09;&#x9700;&#x8981;&#x5B8C;&#x6210;&#x5169;&#x500B;&#x52D5;&#x4F5C;&#xFF0C;&#x5206;&#x5225;&#x662F;</p>
<ol>
<li>&#x65B0;&#x589E;&#x4E00;&#x500B;&#x985E;&#x5225;&#xFF0C;&#x7E7C;&#x627F;<code>ValidationAttribute</code>&#x985E;&#x5225;</li>
<li>&#x5BE6;&#x4F5C;<code>IsValid</code>&#x65B9;&#x6CD5;</li>
</ol>
<p>&#x6211;&#x5011;&#x5728;&#x5C08;&#x6848;&#x4E2D;&#x65B0;&#x589E;&#x4E00;&#x500B;<code>ValidationAttributes</code>&#x76EE;&#x9304;&#xFF0C;&#x5728;&#x76EE;&#x9304;&#x4E2D;&#x65B0;&#x589E;<code>RequiredAttribute.cs</code>&#x6A94;&#x6848;&#xFF0C;&#x5728;&#x6A94;&#x6848;&#x4E2D;&#x52A0;&#x5165;&#x4EE5;&#x4E0B;&#x7A0B;&#x5F0F;&#x78BC;&#xFF1A;</p>
<pre><code class="language-csharp">using System.Collections;
using System.ComponentModel.DataAnnotations;

namespace Example.ValidationAttributes
{
    public class GuidRequiredAttribute : ValidationAttribute
    {
        // &#x5BE6;&#x4F5C; IsValid &#x65B9;&#x6CD5;&#xFF0C;&#x81EA;&#x8A02;&#x9A57;&#x8B49;&#x908F;&#x8F2F;&#xFF0C;
        // &#x56DE;&#x50B3;true&#x4EE3;&#x8868;&#x901A;&#x904E;&#x9A57;&#x8B49;&#xFF0C;false&#x4EE3;&#x8868;&#x4E0D;&#x901A;&#x904E;&#x9A57;&#x8B49;
        public override bool IsValid(object? value)
        {
            var guidValue = value as Guid?;
            
            // &#x5224;&#x65B7;&#x50B3;&#x5165;&#x7684;&#x503C;&#x662F;&#x5426;&#x70BA; null&#xFF0C;&#x4E26;&#x4E14;&#x5224;&#x65B7;&#x662F;&#x5426;&#x70BA;Guid.Empty
            if (guidValue == null || guidValue == Guid.Empty)
            {
                return false;
            }
            return true;
        }
    }
}
</code></pre>
<p>&#x5B8C;&#x6210;&#x9A57;&#x8B49;&#x908F;&#x8F2F;&#x5F8C;&#xFF0C;&#x6211;&#x5011;&#x5C31;&#x53EF;&#x4EE5;&#x5C07;&#x81EA;&#x8A02;&#x7684;<code>[GuidRequired]</code>&#x6A19;&#x7C64;&#x7528;&#x5728;&#x6211;&#x5011;&#x9700;&#x8981;&#x9A57;&#x8B49;&#x7684;&#x5C6C;&#x6027;&#x4E0A;</p>
<pre><code class="language-csharp">public class PostViewModel
{
    [GuidRequired]
    public Guid ProjectId { get; set; }

    public Guid? SupervisorId { get; set; }
}
</code></pre>
<h2 id="%E6%9B%B4%E6%94%B9%E6%AC%84%E4%BD%8D%E5%9E%8B%E6%85%8B%E6%96%B9%E6%B3%95">&#x66F4;&#x6539;&#x6B04;&#x4F4D;&#x578B;&#x614B;&#x65B9;&#x6CD5;</h2>
<p>&#x66F4;&#x6539;&#x6B04;&#x4F4D;&#x578B;&#x614B;&#x4E5F;&#x662F;&#x5176;&#x4E2D;&#x4E00;&#x7A2E;&#x65B9;&#x6CD5;&#xFF0C;&#x5C07;&#x9700;&#x8981;&#x9A57;&#x8B49;&#x7684; Guid &#x578B;&#x614B;&#x5C6C;&#x6027;&#x6539;&#x6210; Nullable &#x7684; Guid &#x5373;&#x53EF;&#x4F7F;&#x7528;<code>[Required]</code>&#x9032;&#x884C;&#x9A57;&#x8B49;&#x3002;</p>
<pre><code class="language-csharp">public class PostViewModel
{
    //&#x5C07;&#x6B64;&#x6B04;&#x4F4D;&#x6539;&#x6210;Guid?&#x4EE5;&#x4F7F;&#x7528;[Required]&#x9A57;&#x8B49;&#x6A19;&#x7C64;
    [Required]
    public Guid? ProjectId { get; set; } 

    public Guid? SupervisorId { get; set; }
}
</code></pre>
<h6 id="%E5%8F%83%E8%80%83%E8%B3%87%E6%96%99">&#x53C3;&#x8003;&#x8CC7;&#x6599;</h6>
<ul>
<li><a href="https://stackoverflow.com/questions/7187576/validation-of-guid?ref=localhost">Validation of Guid</a></li>
<li><a href="https://stackoverflow.com/a/3413875?ref=localhost">How to create Custom Data Annotation Validators</a></li>
<li><a href="https://learn.microsoft.com/zh-tw/dotnet/csharp/language-reference/builtin-types/value-types?ref=localhost">&#x5BE6;&#x503C;&#x985E;&#x578B;-Microsoft</a></li>
</ul>
]]></content:encoded></item><item><title><![CDATA[使用 C# 建立上傳檔案請求]]></title><description><![CDATA[<!--kg-card-begin: markdown--><h2 id="%E7%92%B0%E5%A2%83">&#x74B0;&#x5883;</h2>
<ul>
<li>macOS Sonoma 14.0(Apple M1 Pro)</li>
<li>.NET 6.0</li>
<li>Visual Studio Community 2022 for Mac 17.6.6</li>
</ul>
<h2 id="%E8%AE%80%E5%8F%96%E6%AA%94%E6%A1%88%E3%80%81%E5%BB%BA%E7%AB%8B%E8%AB%8B%E6%B1%82%E5%8F%8A%E5%82%B3%E9%80%81%E8%AB%8B%E6%B1%82">&#x8B80;&#x53D6;&#x6A94;&#x6848;&#x3001;&#x5EFA;&#x7ACB;&#x8ACB;&#x6C42;&#x53CA;&#x50B3;&#x9001;&#x8ACB;&#x6C42;</h2>
<pre><code class="language-csharp">var filename = &quot;test.png&quot;;

// &#x5EFA;&#x7ACB; HttpClient &#x5BE6;&#x9AD4;
using (var client = new</code></pre>]]></description><link>https://vincent87720.github.io/upload-file-using-csharp/</link><guid isPermaLink="false">654285210b04b200017b53f7</guid><category><![CDATA[C#]]></category><dc:creator><![CDATA[Katsuobushi]]></dc:creator><pubDate>Wed, 01 Nov 2023 17:14:07 GMT</pubDate><media:content url="https://vincent87720.github.io/content/images/2023/11/visualStudioCode.png" medium="image"/><content:encoded><![CDATA[<!--kg-card-begin: markdown--><h2 id="%E7%92%B0%E5%A2%83">&#x74B0;&#x5883;</h2>
<ul>
<li>macOS Sonoma 14.0(Apple M1 Pro)</li>
<li>.NET 6.0</li>
<li>Visual Studio Community 2022 for Mac 17.6.6</li>
</ul>
<h2 id="%E8%AE%80%E5%8F%96%E6%AA%94%E6%A1%88%E3%80%81%E5%BB%BA%E7%AB%8B%E8%AB%8B%E6%B1%82%E5%8F%8A%E5%82%B3%E9%80%81%E8%AB%8B%E6%B1%82">&#x8B80;&#x53D6;&#x6A94;&#x6848;&#x3001;&#x5EFA;&#x7ACB;&#x8ACB;&#x6C42;&#x53CA;&#x50B3;&#x9001;&#x8ACB;&#x6C42;</h2>
<pre><code class="language-csharp">var filename = &quot;test.png&quot;;

// &#x5EFA;&#x7ACB; HttpClient &#x5BE6;&#x9AD4;
using (var client = new HttpClient())
{
    // &#x5EFA;&#x7ACB; FileStream
    using (Stream stream = new FileStream(filename, FileMode.Open, FileAccess.Read,
            FileShare.ReadWrite, 4096, FileOptions.SequentialScan))
    {
        // &#x5EFA;&#x7ACB; multipart/form-data &#x985E;&#x578B;&#x7684; HttpContent
        using (var content = new MultipartFormDataContent())
        {
            // &#x5C07;&#x6587;&#x5B57;&#x7684; key-value &#x52A0;&#x5165; content
            content.Add(new StringContent(&quot;40fe36a4-b5b3-485a-b18e-5127106b3795&quot;), &quot;\&quot;Id\&quot;&quot;);

            // &#x5C07;&#x6A94;&#x6848;&#x52A0;&#x5165; content
            // &#x6700;&#x5F8C;&#x4E00;&#x500B;&#x6A94;&#x540D;&#x53C3;&#x6578;&#x5FC5;&#x9808;&#x8981;&#x52A0;&#x5426;&#x5247;&#x6703;&#x51FA;&#x932F;
            content.Add(new StreamContent(stream), &quot;\&quot;File\&quot;&quot;, filename);

            // &#x50B3;&#x9001;&#x8ACB;&#x6C42;
            var responseMessage = await client.PostAsync(&quot;https://localhost:7113/api/File&quot;, content);

            // &#x8B80;&#x53D6;&#x56DE;&#x8986;&#x5167;&#x5BB9;
            var responseContent = await responseMessage.Content.ReadAsStringAsync();
            Console.WriteLine(responseContent);
        }
    }
}
</code></pre>
<h6 id="%E5%8F%83%E8%80%83%E8%B3%87%E6%96%99">&#x53C3;&#x8003;&#x8CC7;&#x6599;</h6>
<ul>
<li><a href="https://stackoverflow.com/a/55424886?ref=localhost">How to post form-data IFormFile with HttpClient?</a></li>
<li><a href="https://stackoverflow.com/a/29309941?ref=localhost">400 - Bad Request when performing bulk import of contacts</a></li>
</ul>
<!--kg-card-end: markdown-->]]></content:encoded></item><item><title><![CDATA[Race condition 的種類、成因與解決辦法]]></title><description><![CDATA[當多個程序同時存取同一個資源時，很可能會發生該資源在其他程序進行期間被進行更動，導致資料與預期的結果不同的問題。]]></description><link>https://vincent87720.github.io/race-condition-intro/</link><guid isPermaLink="false">6534cec4bee2720001e0bdd5</guid><category><![CDATA[concurrency]]></category><dc:creator><![CDATA[Katsuobushi]]></dc:creator><pubDate>Sun, 22 Oct 2023 07:42:51 GMT</pubDate><media:content url="https://vincent87720.github.io/content/images/2023/10/bruno-kelzer-zZoscDXH6ss-unsplash-3.jpg" medium="image"/><content:encoded><![CDATA[<!--kg-card-begin: markdown--><img src="https://vincent87720.github.io/content/images/2023/10/bruno-kelzer-zZoscDXH6ss-unsplash-3.jpg" alt="Race condition &#x7684;&#x7A2E;&#x985E;&#x3001;&#x6210;&#x56E0;&#x8207;&#x89E3;&#x6C7A;&#x8FA6;&#x6CD5;"><p>&#x7576;&#x591A;&#x500B;&#x7A0B;&#x5E8F;&#x540C;&#x6642;&#x5B58;&#x53D6;&#x540C;&#x4E00;&#x500B;&#x8CC7;&#x6E90;&#x6642;&#xFF0C;&#x5F88;&#x53EF;&#x80FD;&#x6703;&#x767C;&#x751F;&#x8A72;&#x8CC7;&#x6E90;&#x5728;&#x5176;&#x4ED6;&#x7A0B;&#x5E8F;&#x9032;&#x884C;&#x671F;&#x9593;&#x88AB;&#x9032;&#x884C;&#x66F4;&#x52D5;&#xFF0C;&#x5C0E;&#x81F4;&#x8CC7;&#x6599;&#x8207;&#x9810;&#x671F;&#x7684;&#x7D50;&#x679C;&#x4E0D;&#x540C;&#x7684;&#x554F;&#x984C;&#x3002;</p>
<p>&#x9020;&#x6210;Race condition&#x901A;&#x5E38;&#x8981;&#x6EFF;&#x8DB3;&#x4EE5;&#x4E0B;&#x5169;&#x9EDE;</p>
<ol>
<li>&#x5E73;&#x884C;&#x8655;&#x7406;</li>
<li>&#x540C;&#x6642;&#x5B58;&#x53D6;&#x540C;&#x4E00;&#x500B;&#x8CC7;&#x6E90;</li>
</ol>
<h2 id="race-condition-%E7%9A%84%E6%83%85%E5%A2%83%E8%88%87%E8%A7%A3%E6%B3%95">Race condition &#x7684;&#x60C5;&#x5883;&#x8207;&#x89E3;&#x6CD5;</h2>
<p>Race condition &#x53EF;&#x5927;&#x81F4;&#x4E0A;&#x5206;&#x70BA;&#x4E94;&#x500B;&#x73FE;&#x8C61;&#xFF0C;&#x5305;&#x542B;</p>
<ul>
<li>Dirty Read</li>
<li>Non-repeatable Read (Read Skew)</li>
<li>Phantom</li>
<li>Lost update</li>
<li>Write Skew</li>
</ul>
<h2 id="dirty-read-%E9%AB%92%E8%AE%80">Dirty Read &#x9AD2;&#x8B80;</h2>
<p>&#x6240;&#x8B02;&#x9AD2;&#x8B80;&#x5C31;&#x662F;&#x8B80;&#x5230;&#x9AD2;&#x6771;&#x897F;&#xFF0C;&#x610F;&#x5373;&#x8B80;&#x53D6;&#x5230;&#x53E6;&#x4E00;&#x500B; Transaction &#x5C1A;&#x672A; commit &#x7684;&#x503C;&#x3002;</p>
<h3 id="dirty-read-%E7%9A%84%E6%83%85%E5%A2%83">Dirty Read &#x7684;&#x60C5;&#x5883;</h3>
<p>&#x5047;&#x8A2D;&#x6709;&#x4E09;&#x500B;&#x89D2;&#x8272;&#xFF0C;&#x8CC7;&#x6599;&#x5EAB;&#x3001;Transaction A &#x548C; Transaction B</p>
<p>&#x8CC7;&#x6599;&#x5EAB;&#xFF1A;&#x5728;&#x8CC7;&#x6599;&#x5EAB;&#x4E2D;&#x5B58;&#x5728;&#x4E00;&#x500B;&#x503C; X=0<br>
Transaction A&#xFF1A;&#x8B8A;&#x66F4;&#x6578;&#x503C; X &#x70BA; 2 &#x4F46;&#x56E0;&#x70BA;&#x67D0;&#x4E9B;&#x539F;&#x56E0;&#x9700;&#x8981; rollback&#xFF0C;&#x6C92;&#x6709;&#x6210;&#x529F;&#x66F4;&#x65B0;<br>
Transaction B&#xFF1A;&#x8B80;&#x53D6;&#x6578;&#x503C; X</p>
<p>&#x5982;&#x679C;&#x662F;&#x6B63;&#x5E38;&#x7684;&#x60C5;&#x6CC1;&#x61C9;&#x8A72;&#x662F; Transaction A &#x60F3;&#x5C07; X &#x8B8A;&#x66F4;&#x70BA; 2 &#x4F46;&#x6C92;&#x6709;&#x6210;&#x529F;&#xFF0C;&#x6240;&#x4EE5;&#x5C07; rollback &#x56DE; 0 &#xFF0C;&#x6B64;&#x6642; Transaction B &#x8B80;&#x53D6;&#x5230;&#x7684;&#x6578;&#x503C;&#x61C9;&#x8A72;&#x8981;&#x662F;0&#xFF0C;&#x8207;&#x8CC7;&#x6599;&#x5EAB;&#x5167;&#x7684;&#x6578;&#x503C;&#x76F8;&#x540C;&#x3002;</p>
<p>&#x82E5;&#x767C;&#x751F; Dirty Read &#x7684;&#x60C5;&#x6CC1;&#x6642; Transaction B &#x8B80;&#x5230;&#x7684;&#x6578;&#x503C;&#x6703;&#x662F;2&#xFF0C;&#x767C;&#x751F;&#x7AF6;&#x722D;&#x6642;&#x7684;&#x57F7;&#x884C;&#x9806;&#x5E8F;&#x5982;&#x4E0B;&#xFF1A;</p>
<table>
<thead>
<tr>
<th style="text-align:center">Transaction A</th>
<th style="text-align:center">Transaction B</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">&#x4EA4;&#x6613;&#x958B;&#x59CB;</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center">&#x4EA4;&#x6613;&#x958B;&#x59CB;</td>
</tr>
<tr>
<td style="text-align:center">&#x5C07;X&#x8B8A;&#x66F4;&#x70BA;2</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center">&#x8B80;&#x53D6;&#x5230;X&#x7684;&#x503C;&#x70BA;2</td>
</tr>
<tr>
<td style="text-align:center">&#x5C07; X rollback &#x56DE; 0</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">&#x4EA4;&#x6613;&#x7D50;&#x675F;&#xFF0C;commit</td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<p>&#x76EE;&#x524D;&#x7684;&#x72C0;&#x614B;&#x662F;&#x8CC7;&#x6599;&#x5EAB;&#x4E2D;X&#x7684;&#x503C;&#x4F9D;&#x7136;&#x662F;0&#xFF0C;&#x6211;&#x5011;&#x672C;&#x4F86;&#x9810;&#x671F; Transaction B &#x4E5F;&#x61C9;&#x8A72;&#x62FF;&#x5230; 0&#xFF0C;&#x4F46; Transaction B &#x5728; Transaction A &#x5C1A;&#x672A; commit &#x5C31;&#x8B80;&#x53D6; X &#x7684;&#x503C;&#xFF0C;&#x62FF;&#x5230;&#x4E86;&#x932F;&#x8AA4;&#x7684;&#x6578;&#x503C;&#xFF0C;&#x6211;&#x5011;&#x628A;&#x9019;&#x500B;&#x73FE;&#x8C61;&#x7A31;&#x70BA; Dirty Read&#x3002;</p>
<p>&#x6B64;&#x73FE;&#x8C61;&#x662F; Transaction A &#x6539;&#x52D5;&#x7684;&#x503C;&#x5728;commit&#x524D;&#x6C92;&#x6709;&#x88AB;&#x53D7;&#x5230;&#x4FDD;&#x8B77;&#x9020;&#x6210;&#x7684;&#x7D50;&#x679C;&#x3002;</p>
<h3 id="dirty-read-%E7%9A%84%E8%A7%A3%E6%B1%BA%E8%BE%A6%E6%B3%95">Dirty Read &#x7684;&#x89E3;&#x6C7A;&#x8FA6;&#x6CD5;</h3>
<p>&#x5C07;&#x4EA4;&#x6613;&#x9694;&#x96E2;&#x7B49;&#x7D1A;&#x8A2D;&#x5B9A;&#x70BA;<code>READ UNCOMMITTED</code>&#x5373;&#x53EF;&#x907F;&#x514D; Dirty Read &#x7684;&#x767C;&#x751F;&#x3002;<br>
<code>READ UNCOMMITTED</code>&#x6703;&#x9632;&#x6B62;&#x9AD2;&#x8B80;&#xFF0C;&#x5373;&#x9632;&#x6B62;&#x6B64;&#x4EA4;&#x6613;&#x8B80;&#x53D6;&#x5230;&#x5176;&#x4ED6;&#x4EA4;&#x6613;&#x5C1A;&#x672A; commit &#x7684;&#x8CC7;&#x6599;&#x3002;</p>
<h2 id="non-repeatable-read-read-skew">Non-repeatable Read (Read Skew)</h2>
<p>Non-repeatable Read &#x7684;&#x4E2D;&#x6587;&#x7FFB;&#x8B6F;&#x662F;&#x300C;&#x4E0D;&#x53EF;&#x91CD;&#x8907;&#x8B80;&#x300D;&#xFF0C;&#x4F46;&#x9019;&#x7FFB;&#x8B6F;&#x6211;&#x8A8D;&#x70BA;&#x6C92;&#x6709;&#x5F88;&#x597D;&#x61C2;&#xFF0C;&#x53EF;&#x80FD;&#x610F;&#x601D;&#x6703;&#x6BD4;&#x8F03;&#x63A5;&#x8FD1;&#x300C;&#x7121;&#x91CD;&#x8907;&#x8B80;&#x300D;&#xFF1F;<br>
&#x7528;&#x767D;&#x8A71;&#x4E00;&#x9EDE;&#x89E3;&#x91CB;&#x5C31;&#x662F;&#x5728;&#x540C;&#x4E00;&#x500B;&#x4EA4;&#x6613;&#x4E2D;&#x67E5;&#x8A62;&#x76F8;&#x540C;&#x7684;&#x503C;&#x5169;&#x6B21;&#x4F46;&#x5F97;&#x5230;&#x4E0D;&#x540C;&#x7684;&#x7D50;&#x679C;&#xFF08;&#x5728;&#x540C;&#x4E00;&#x500B;&#x4EA4;&#x6613;&#x4E2D;&#x6211;&#x5011;&#x6703;&#x671F;&#x671B;&#x5982;&#x679C;&#x6C92;&#x6709;&#x66F4;&#x52D5;&#x8CC7;&#x6599;&#xFF0C;&#x4F7F;&#x7528;&#x76F8;&#x540C;&#x689D;&#x4EF6;&#x9032;&#x884C;&#x67E5;&#x8A62;&#x61C9;&#x8A72;&#x5F97;&#x5230;&#x76F8;&#x540C;&#x7D50;&#x679C;&#xFF09;&#x3002;</p>
<p>&#x8209;&#x500B;&#x4F8B;&#x5B50;&#xFF0C;&#x9019;&#x611F;&#x89BA;&#x5C31;&#x50CF;&#x6211;&#x958B;&#x4E86;&#x4E00;&#x5718;&#x98F2;&#x6599;&#x8A02;&#x55AE;&#xFF0C;&#x6211;&#x8CA0;&#x8CAC;&#x53BB;&#x554F;&#x50F9;&#x9322;&#x662F;&#x591A;&#x5C11;&#x4E26;&#x56DE;&#x8986;&#x7D66;&#x8981;&#x8A02;&#x98F2;&#x6599;&#x7684;&#x5927;&#x5BB6;&#xFF0C;&#x524D;&#x4E00;&#x79D2;&#x624D;&#x554F;&#x5E97;&#x54E1;&#x5F97;&#x77E5;&#x4E00;&#x676F;&#x70CF;&#x9F8D;&#x9BAE;&#x5976;&#x8336;50&#x5143;&#xFF0C;&#x8DDF;&#x540C;&#x4E8B;&#x56DE;&#x5831;&#x5B8C;&#x50F9;&#x683C;&#x78BA;&#x8A8D;&#x91D1;&#x984D;&#x5F8C;&#xFF0C;&#x6B63;&#x8981;&#x7D50;&#x5E33;&#x6642;&#x537B;&#x8DDF;&#x6211;&#x8AAA;&#x62B1;&#x6B49;&#x525B;&#x525B;&#x50F9;&#x683C;&#x88AB;&#x7E3D;&#x516C;&#x53F8;&#x6539;&#x52D5;&#x4E86;&#xFF0C;&#x4E00;&#x676F;&#x8B8A;&#x6210;70&#x5143;&#x4E86;&#xFF0C;&#x6211;&#x60F3;&#x5927;&#x90E8;&#x5206;&#x4EBA;&#x90FD;&#x6703;&#x5F88;&#x50BB;&#x773C;&#x3002;</p>
<p>&#x4EE5;&#x9019;&#x500B;&#x4F8B;&#x5B50;&#x4F86;&#x8AAA;&#x5C31;&#x662F;&#x5728;&#x540C;&#x4E00;&#x500B;&#x4EA4;&#x6613;&#xFF08;&#x958B;&#x98F2;&#x6599;&#x5718;&#x8A02;&#x55AE;&#xFF09;&#x4E2D;&#xFF0C;&#x67E5;&#x8A62;&#x76F8;&#x540C;&#x7684;&#x503C;&#xFF08;&#x90FD;&#x662F;&#x67E5;&#x8A62;&#x70CF;&#x9F8D;&#x9BAE;&#x5976;&#x8336;&#x7684;&#x50F9;&#x683C;&#xFF09;&#x5169;&#x6B21;&#xFF0C;&#x5169;&#x6B21;&#x7684;&#x7D50;&#x679C;&#x4E0D;&#x76F8;&#x540C;&#xFF08;&#x7B2C;&#x4E00;&#x6B21;&#x70BA;&#x554F;&#x5E97;&#x54E1;&#x5F97;&#x77E5;&#x7684;&#x50F9;&#x683C;&#x8207;&#x7B2C;&#x4E8C;&#x6B21;&#x70BA;&#x7D50;&#x5E33;&#x6642;&#x5F97;&#x77E5;&#x7684;&#x50F9;&#x683C;&#x4E0D;&#x76F8;&#x540C;&#xFF09;&#x3002;<br>
&#x800C;&#x4E0D;&#x76F8;&#x540C;&#x7684;&#x539F;&#x56E0;&#x51FA;&#x5728;&#x53E6;&#x4E00;&#x500B;&#x4EA4;&#x6613;&#xFF08;&#x7E3D;&#x516C;&#x53F8;&#x8ABF;&#x6F32;&#x50F9;&#x683C;&#x70BA;70&#x5143;&#xFF09;&#x5728;&#x6B64;&#x4EA4;&#x6613;&#x5169;&#x6B21;&#x67E5;&#x8A62;&#x7684;&#x9014;&#x4E2D;&#x66F4;&#x6539;&#x4E86;&#x8A72;&#x6578;&#x503C;&#x5C0E;&#x81F4;&#x7684;&#x73FE;&#x8C61;&#x3002;</p>
<h3 id="non-repeatable-read-%E7%9A%84%E6%83%85%E5%A2%83">Non-repeatable Read &#x7684;&#x60C5;&#x5883;</h3>
<p>&#x5047;&#x8A2D;&#x6709;&#x4E09;&#x500B;&#x89D2;&#x8272;&#xFF0C;&#x8CC7;&#x6599;&#x5EAB;&#x3001;Transaction A&#x548C;Transaction B</p>
<p>&#x8CC7;&#x6599;&#x5EAB;&#xFF1A;&#x5728;&#x8CC7;&#x6599;&#x5EAB;&#x4E2D;&#x5B58;&#x5728;&#x4E00;&#x500B;&#x503C;X=0<br>
Transaction A&#xFF1A;&#x8B8A;&#x66F4;&#x6578;&#x503C;X&#x70BA;2<br>
Transaction B&#xFF1A;&#x8B80;&#x53D6;&#x5169;&#x6B21;&#x6578;&#x503C;X</p>
<p>&#x6B63;&#x5E38;&#x60C5;&#x6CC1;&#x4E0B; Transaction B &#x8B80;&#x5169;&#x6B21;&#x6578;&#x503C;&#x61C9;&#x8A72;&#x6703;&#x90FD;&#x662F; 0 &#x6216;&#x90FD;&#x662F; 2&#x3002;</p>
<p>&#x82E5;&#x767C;&#x751F; Non-repeatable Read&#xFF0C;&#x5247;&#x6709;&#x53EF;&#x80FD; Transaction B &#x5728;&#x5169;&#x6B21;&#x8B80;&#x53D6;&#x7684;&#x671F;&#x9593; X &#x7684;&#x503C;&#x88AB;&#x6539;&#x4E86;&#xFF0C;&#x767C;&#x751F;&#x7AF6;&#x722D;&#x6642;&#x7684;&#x57F7;&#x884C;&#x9806;&#x5E8F;&#x5982;&#x4E0B;&#xFF1A;</p>
<table>
<thead>
<tr>
<th style="text-align:center">Transaction A</th>
<th style="text-align:center">Transaction B</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">&#x4EA4;&#x6613;&#x958B;&#x59CB;</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center">&#x4EA4;&#x6613;&#x958B;&#x59CB;</td>
</tr>
<tr>
<td style="text-align:center">&#x5C07;X&#x8B8A;&#x66F4;&#x70BA;2</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center">&#x8B80;&#x53D6;&#x5230;X&#x7684;&#x503C;&#x70BA;0&#xFF08;&#x6C92;&#x6709;Dirty Read&#x7684;&#x60C5;&#x6CC1;&#x4E0B;&#x8B80;&#x5230;0&#x662F;&#x6B63;&#x5E38;&#x7684;&#xFF09;</td>
</tr>
<tr>
<td style="text-align:center">&#x4EA4;&#x6613;&#x7D50;&#x675F;&#xFF0C;commit</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center">&#x8B80;&#x53D6;&#x5230;X&#x7684;&#x503C;&#x70BA;2</td>
</tr>
</tbody>
</table>
<p>&#x9019;&#x7A2E;&#x60C5;&#x5883;&#x4E0B; Transaction A &#x6539;&#x52D5;&#x7684;&#x503C;&#x6709;&#x88AB;&#x59A5;&#x5584;&#x4FDD;&#x8B77;&#x76F4;&#x5230; commit&#xFF0C;&#x4F46; Transaction B &#x7684;&#x5169;&#x6B21;&#x8B80;&#x53D6;&#x5206;&#x5225;&#x5728; Transaction A &#x7684; commit &#x524D;&#x548C; commit &#x5F8C;&#xFF0C;&#x9020;&#x6210;&#x4E86; Non-repeatable Read &#x7684;&#x73FE;&#x8C61;&#x3002;</p>
<h3 id="non-repeatable-read-%E7%9A%84%E8%A7%A3%E6%B1%BA%E8%BE%A6%E6%B3%95">Non-repeatable Read &#x7684;&#x89E3;&#x6C7A;&#x8FA6;&#x6CD5;</h3>
<p>&#x5C07;&#x4EA4;&#x6613;&#x9694;&#x96E2;&#x7B49;&#x7D1A;&#x8A2D;&#x5B9A;&#x70BA;<code>READ COMMITTED</code>&#x5373;&#x53EF;&#x907F;&#x514D;&#x4EE5;&#x4E0B;&#x60C5;&#x6CC1;&#x767C;&#x751F;&#xFF1A;</p>
<ul>
<li>&#x9632;&#x6B62;&#x76EE;&#x524D;&#x7684;&#x4EA4;&#x6613;&#x8B80;&#x53D6;&#x5176;&#x4ED6;&#x4EA4;&#x6613;&#x5DF2;&#x7DE8;&#x8F2F;&#x4F46;&#x5C1A;&#x672A; commit &#x7684;&#x8CC7;&#x6599;</li>
<li>&#x9632;&#x6B62;&#x5176;&#x4ED6;&#x4EA4;&#x6613;&#x7DE8;&#x8F2F;&#x76EE;&#x524D;&#x4EA4;&#x6613;&#x6703;&#x8B80;&#x53D6;&#x5230;&#x7684;&#x8CC7;&#x6599;</li>
</ul>
<p>&#x4E5F;&#x53EF;&#x4EE5;&#x5C07;&#x4EA4;&#x6613;&#x9694;&#x96E2;&#x7B49;&#x7D1A;&#x8A2D;&#x5B9A;&#x70BA;<code>READ COMMITTED SNAPSHOT</code>&#xFF0C;&#x8207; READ COMMITTED &#x7684;&#x5DEE;&#x7570;&#x5728;&#x65BC; READ COMMITTED SNAPSHOT &#x4F7F;&#x7528;&#x6A02;&#x89C0;&#x9396;&#x7684;&#x65B9;&#x5F0F;&#x8655;&#x7406; race condition&#x3002;&#x800C; READ COMMITTED &#x4F7F;&#x7528;&#x60B2;&#x89C0;&#x9396;&#x8655;&#x7406; race condition &#x554F;&#x984C;&#x3002;</p>
<h2 id="phantom">Phantom</h2>
<p>&#x5728;&#x540C;&#x4E00;&#x500B;&#x4EA4;&#x6613;&#x4E2D;&#x4E0B;&#x9054;&#x540C;&#x6A23;&#x7684;&#x67E5;&#x8A62;&#x5F0F;&#xFF0C;&#x4F46;&#x5F97;&#x5230;&#x4E0D;&#x540C;&#x7B46;&#x6578;&#x7684;&#x8CC7;&#x6599;&#x3002;</p>
<h3 id="phantom-%E7%9A%84%E6%83%85%E5%A2%83">Phantom &#x7684;&#x60C5;&#x5883;</h3>
<p>&#x5047;&#x8A2D;&#x6709;&#x4E09;&#x500B;&#x89D2;&#x8272;&#xFF0C;&#x8CC7;&#x6599;&#x5EAB;&#x3001;Transaction A&#x548C;Transaction B</p>
<p>&#x8CC7;&#x6599;&#x5EAB;&#xFF1A;&#x5728;&#x8CC7;&#x6599;&#x5EAB;&#x4E2D;&#x5B58;&#x5728;&#x4E00;&#x7B46;&#x8CC7;&#x6599;<br>
Transaction A&#xFF1A;&#x589E;&#x52A0;&#x4E00;&#x7B46;&#x8CC7;&#x6599;<br>
Transaction B&#xFF1A;&#x67E5;&#x8A62;&#x6240;&#x6709;&#x8CC7;&#x6599;&#x5169;&#x6B21;</p>
<p>&#x6B63;&#x5E38;&#x60C5;&#x6CC1;&#x4E0B; Transaction B &#x7684;&#x5169;&#x6B21;&#x67E5;&#x8A62;&#x61C9;&#x8A72;&#x90FD;&#x8981;&#x662F;&#x76F8;&#x540C;&#x7684;&#x7B46;&#x6578;&#x3002;</p>
<p>&#x5047;&#x8A2D; Transaction A &#x548C; Transaction B &#x5E7E;&#x4E4E;&#x540C;&#x6642;&#x767C;&#x751F;&#xFF0C;&#x5247;&#x6709;&#x53EF;&#x80FD;&#x767C;&#x751F;&#x5728; Transaction B &#x5206;&#x5225;&#x5728; Transaction A &#x65B0;&#x589E;&#x8CC7;&#x6599;&#x7684;&#x524D;&#x8207;&#x5F8C;&#x8B80;&#x53D6;&#x8CC7;&#x6599;&#xFF0C;&#x5C0E;&#x81F4;&#x8B80;&#x5230;&#x7684;&#x8CC7;&#x6599;&#x7B46;&#x6578;&#x4E0D;&#x4E00;&#x81F4;&#x7684;&#x554F;&#x984C;&#xFF0C;&#x7BC4;&#x4F8B;&#x5982;&#x4E0B;&#xFF1A;</p>
<table>
<thead>
<tr>
<th style="text-align:center">Transaction A</th>
<th style="text-align:center">Transaction B</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">&#x4EA4;&#x6613;&#x958B;&#x59CB;</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center">&#x4EA4;&#x6613;&#x958B;&#x59CB;</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center">&#x67E5;&#x8A62;&#x6240;&#x6709;&#x8CC7;&#x6599;&#xFF0C;&#x5F97;&#x5230;1&#x7B46;&#x8CC7;&#x6599;</td>
</tr>
<tr>
<td style="text-align:center">&#x589E;&#x52A0;&#x4E00;&#x7B46;&#x8CC7;&#x6599;</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">&#x4EA4;&#x6613;&#x7D50;&#x675F;&#xFF0C;commit</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center">&#x67E5;&#x8A62;&#x6240;&#x6709;&#x8CC7;&#x6599;&#xFF0C;&#x5F97;&#x5230;2&#x7B46;&#x8CC7;&#x6599;</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center">&#x4EA4;&#x6613;&#x7D50;&#x675F;&#xFF0C;commit</td>
</tr>
</tbody>
</table>
<p>&#x9019;&#x7A2E;&#x73FE;&#x8C61;&#x70BA; Transaction B &#x7684;&#x5169;&#x6B21;&#x8B80;&#x53D6;&#x5206;&#x5225;&#x5728; Transaction A &#x7684; commit &#x524D;&#x548C; commit &#x5F8C;&#xFF0C;&#x9020;&#x6210;&#x53D6;&#x5F97;&#x7684;&#x8CC7;&#x6599;&#x7B46;&#x6578;&#x4E0D;&#x4E00;&#x81F4;&#x7684;&#x554F;&#x984C;&#xFF0C;&#x6B64;&#x73FE;&#x8C61;&#x7A31;&#x70BA; Phantom&#x3002;</p>
<h2 id="lost-update">Lost update</h2>
<p>&#x7576;&#x66F4;&#x65B0;&#x7684;&#x6578;&#x503C;&#x5728; commit &#x524D;&#x88AB;&#x5176;&#x4ED6; transaction &#x6539;&#x52D5;&#x6642;&#x7A31;&#x70BA; lost update&#x3002;</p>
<h3 id="lost-update-%E7%9A%84%E6%83%85%E5%A2%83">Lost update &#x7684;&#x60C5;&#x5883;</h3>
<p>&#x5047;&#x8A2D;&#x6709;&#x4E09;&#x500B;&#x89D2;&#x8272;&#xFF0C;&#x8CC7;&#x6599;&#x5EAB;&#x3001;Transaction A&#x548C;Transaction B</p>
<p>&#x8CC7;&#x6599;&#x5EAB;&#xFF1A;&#x5728;&#x8CC7;&#x6599;&#x5EAB;&#x4E2D;&#x5B58;&#x5728;&#x4E00;&#x500B;&#x503C;X=0<br>
Transaction A&#xFF1A;&#x8B8A;&#x66F4;&#x6578;&#x503C;X&#xFF0C;&#x5C07;X&#x52A0;&#x4E0A;2<br>
Transaction B&#xFF1A;&#x8B8A;&#x66F4;&#x6578;&#x503C;X&#xFF0C;&#x5C07;X&#x52A0;&#x4E0A;3</p>
<p>&#x6B63;&#x5E38;&#x60C5;&#x6CC1;&#x4E0B; Transaction A &#x548C; B &#x5C0D; X &#x52A0;&#x4E0A; 2 &#x548C; 3 &#x5F8C;&#xFF0C;X &#x61C9;&#x8A72;&#x8981;&#x8B8A;&#x6210; 5&#x3002;</p>
<p>&#x5047;&#x8A2D; Transaction A &#x548C; Transaction B &#x5E7E;&#x4E4E;&#x540C;&#x6642;&#x767C;&#x751F;&#xFF0C;&#x4E14;&#x6C92;&#x6709;&#x9632;&#x6B62; race condition&#xFF0C;&#x5247;&#x6703;&#x767C;&#x751F;&#x4EE5;&#x4E0B;&#x60C5;&#x6CC1;&#xFF1A;</p>
<table>
<thead>
<tr>
<th style="text-align:center">Transaction A</th>
<th style="text-align:center">Transaction B</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">&#x4EA4;&#x6613;&#x958B;&#x59CB;</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center">&#x4EA4;&#x6613;&#x958B;&#x59CB;</td>
</tr>
<tr>
<td style="text-align:center">&#x8B80;&#x53D6;&#x5230;X&#x70BA;0</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center">&#x8B80;&#x53D6;&#x5230;X&#x70BA;0</td>
</tr>
<tr>
<td style="text-align:center">&#x5C07;X&#x589E;&#x52A0;2&#xFF0C;X&#x8B8A;&#x6210;2</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center">&#x5C07;X&#x589E;&#x52A0;3&#xFF0C;X&#x8B8A;&#x6210;3</td>
</tr>
<tr>
<td style="text-align:center">&#x4EA4;&#x6613;&#x7D50;&#x675F;&#xFF0C;commit</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center">&#x4EA4;&#x6613;&#x7D50;&#x675F;&#xFF0C;commit</td>
</tr>
</tbody>
</table>
<p>&#x7D50;&#x679C;&#x6703;&#x662F; Transaction B &#x7684;&#x66F4;&#x52D5;&#x7D50;&#x679C;&#x8986;&#x84CB;&#x4E86; Transaction A &#x7684;&#x66F4;&#x52D5;&#x7D50;&#x679C;&#xFF0C;&#x9020;&#x6210; Transaction A &#x7684;&#x66F4;&#x52D5;&#x7D50;&#x679C;&#x907A;&#x5931;&#x4E86;&#xFF0C;&#x8207;&#x9810;&#x671F;&#x7684;&#x7D50;&#x679C;&#x4E0D;&#x76F8;&#x540C;&#x3002;</p>
<h3 id="lost-update-%E7%9A%84%E8%A7%A3%E6%B1%BA%E8%BE%A6%E6%B3%95">Lost update &#x7684;&#x89E3;&#x6C7A;&#x8FA6;&#x6CD5;</h3>
<h4 id="%E4%BD%BF%E7%94%A8%E8%B3%87%E6%96%99%E5%BA%AB%E6%8F%90%E4%BE%9B%E7%9A%84-atomic-%E7%9A%84%E6%93%8D%E4%BD%9C">&#x4F7F;&#x7528;&#x8CC7;&#x6599;&#x5EAB;&#x63D0;&#x4F9B;&#x7684; Atomic &#x7684;&#x64CD;&#x4F5C;</h4>
<pre><code class="language-sql">UPDATE record SET x=3 WHERE uid=1
</code></pre>
<h4 id="%E4%BD%BF%E7%94%A8-select-for-update">&#x4F7F;&#x7528; SELECT FOR UPDATE</h4>
<p>InnoDB &#x53EF;&#x4EE5;&#x4F7F;&#x7528; FOR UPDATE &#x8A9E;&#x6CD5;&#x89E3;&#x6C7A; lost update &#x7684;&#x554F;&#x984C;&#x3002;<br>
FOR UPDATE &#x662F;&#x4E00;&#x7A2E;&#x884C;&#x7D1A;&#x9396;&#xFF0C;&#x53C8;&#x7A31;&#x70BA;&#x6392;&#x4ED6;&#x9396;&#xFF0C;&#x5C6C;&#x65BC;&#x60B2;&#x89C0;&#x9396;&#x3002;</p>
<h4 id="%E4%BD%BF%E7%94%A8-snapshot">&#x4F7F;&#x7528; SNAPSHOT</h4>
<p>&#x8CC7;&#x6599;&#x5EAB;&#x7684; SNAPSHOT &#x53EF;&#x4EE5;&#x81EA;&#x52D5;&#x6AA2;&#x67E5;&#x662F;&#x5426;&#x767C;&#x751F; Lost update&#xFF0C;&#x4E26;&#x7D42;&#x6B62;&#x51FA;&#x554F;&#x984C;&#x7684;&#x4EA4;&#x6613;&#x3002;<br>
&#x4F7F;&#x7528; SNAPSHOT &#x6642;&#x8981;&#x8A18;&#x5F97;&#x8655;&#x7406;&#x88AB;&#x7D42;&#x6B62;&#x7684;&#x4EA4;&#x6613;&#xFF0C;&#x91CD;&#x65B0;&#x57F7;&#x884C;&#x5C31;&#x53EF;&#x4EE5;&#x89E3;&#x6C7A;&#x6B64;&#x554F;&#x984C;&#x3002;</p>
<h2 id="write-skew">Write Skew</h2>
<p>&#x7576;&#x5169;&#x500B;&#x4EA4;&#x6613;&#x540C;&#x6642;&#x8B80;&#x53D6;&#x4E00;&#x500B;&#x8CC7;&#x6599;&#x96C6;&#xFF0C;&#x4E26;&#x4E14;&#x5404;&#x81EA;&#x6539;&#x52D5;&#x4E0D;&#x540C;&#x7684;&#x8CC7;&#x6599;&#x6642;&#xFF0C;&#x6703;&#x9020;&#x6210;&#x8CC7;&#x6599;&#x4E0D;&#x4E00;&#x81F4;&#x7684;&#x554F;&#x984C;&#x3002;</p>
<h3 id="write-skew-%E7%9A%84%E6%83%85%E5%A2%83">Write Skew &#x7684;&#x60C5;&#x5883;</h3>
<p>&#x5047;&#x8A2D;&#x6709;&#x4E09;&#x500B;&#x89D2;&#x8272;&#xFF0C;&#x8CC7;&#x6599;&#x5EAB;&#x3001;Transaction A&#x548C;Transaction B</p>
<p>&#x8CC7;&#x6599;&#x5EAB;&#xFF1A;&#x5728;&#x8CC7;&#x6599;&#x5EAB;&#x4E2D;&#x5B58;&#x5728;&#x4E8C;&#x7B46;&#x8CC7;&#x6599;&#xFF0C;&#x5169;&#x7B46;&#x8CC7;&#x6599;&#x7684;&#x6578;&#x503C;&#x7686;&#x70BA;false<br>
Transaction A&#xFF1A;&#x8B80;&#x53D6;&#x4E26;&#x7DE8;&#x8F2F;&#x5176;&#x4E2D;&#x4E00;&#x7B46;&#x8CC7;&#x6599;<br>
Transaction B&#xFF1A;&#x8B80;&#x53D6;&#x4E26;&#x7DE8;&#x8F2F;&#x53E6;&#x5916;&#x4E00;&#x7B46;&#x8CC7;&#x6599;</p>
<p>&#x5047;&#x8A2D;&#x6211;&#x7684;&#x5546;&#x696D;&#x908F;&#x8F2F;&#x662F;&#x6240;&#x6709;&#x8CC7;&#x6599;&#x4E2D;&#x53EA;&#x5141;&#x8A31;&#x5176;&#x4E2D;&#x4E00;&#x7B46;&#x8CC7;&#x6599;&#x7684;&#x72C0;&#x614B;&#x70BA; true &#xFF0C;&#x4E00;&#x4F46;&#x6709;&#x5176;&#x4E2D;&#x4E00;&#x500B;&#x70BA; true &#x4E4B;&#x5F8C;&#x5176;&#x9918;&#x7684;&#x8CC7;&#x6599;&#x90FD;&#x4E0D;&#x80FD;&#x88AB;&#x8B8A;&#x66F4;&#x70BA; true&#x3002;</p>
<p>&#x6B63;&#x5E38;&#x60C5;&#x6CC1;&#x4E0B;&#x7B2C;&#x4E8C;&#x500B;&#x4EA4;&#x6613;&#x7684;&#x67E5;&#x8A62;&#x61C9;&#x8A72;&#x6703;&#x57FA;&#x65BC;&#x524D;&#x4E00;&#x500B;&#x4EA4;&#x6613;&#x7684;&#x7D50;&#x679C;&#x9032;&#x884C;&#x67E5;&#x8A62;&#xFF0C;&#x6240;&#x4EE5;&#x4E00;&#x4F46; Transaction A &#x5C07;&#x7B2C;&#x4E00;&#x7B46;&#x8CC7;&#x6599;&#x7684;&#x72C0;&#x614B;&#x6539;&#x70BA;true&#x4E4B;&#x5F8C;&#xFF0C;Transaction B &#x61C9;&#x8A72;&#x4E0D;&#x80FD;&#x5C07;&#x7B2C;&#x4E8C;&#x7B46;&#x8CC7;&#x6599;&#x6539;&#x70BA; true&#x3002;</p>
<p>&#x5047;&#x8A2D; Transaction A &#x548C; B &#x540C;&#x6642;&#x8B80;&#x53D6;&#x5230;&#x4E00;&#x6A23;&#x7684;&#x72C0;&#x614B;&#xFF0C;&#x5169;&#x500B;&#x90FD;&#x5404;&#x81EA;&#x9032;&#x884C;&#x7DE8;&#x8F2F;&#x4E26; commit&#xFF0C;&#x96D6;&#x7136;&#x6539;&#x52D5;&#x4E0D;&#x540C;&#x7B46;&#x8CC7;&#x6599;&#x6240;&#x4EE5;&#x4E0D;&#x6703;&#x5C07;&#x53E6;&#x4E00;&#x500B;&#x4EA4;&#x6613;&#x7684;&#x7D50;&#x679C;&#x8986;&#x84CB;&#x6389;&#xFF0C;&#x4F46;&#x662F;&#x53EF;&#x80FD;&#x6703;&#x5C0E;&#x81F4;&#x5546;&#x696D;&#x908F;&#x8F2F;&#x4E0A;&#x7684;&#x932F;&#x8AA4;&#xFF0C;&#x7BC4;&#x4F8B;&#x5982;&#x4E0B;&#xFF1A;</p>
<table>
<thead>
<tr>
<th style="text-align:center">Transaction A</th>
<th style="text-align:center">Transaction B</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">&#x4EA4;&#x6613;&#x958B;&#x59CB;</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center">&#x4EA4;&#x6613;&#x958B;&#x59CB;</td>
</tr>
<tr>
<td style="text-align:center">&#x67E5;&#x8A62;&#x6240;&#x6709;&#x8CC7;&#x6599;<br>&#x7B2C;&#x4E00;&#x7B46;&#x8CC7;&#x6599;&#x7684;&#x72C0;&#x614B;&#x70BA;false<br>&#x7B2C;&#x4E8C;&#x7B46;&#x8CC7;&#x6599;&#x7684;&#x72C0;&#x614B;&#x70BA;false</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center">&#x67E5;&#x8A62;&#x6240;&#x6709;&#x8CC7;&#x6599;<br>&#x7B2C;&#x4E00;&#x7B46;&#x8CC7;&#x6599;&#x7684;&#x72C0;&#x614B;&#x70BA;false<br>&#x7B2C;&#x4E8C;&#x7B46;&#x8CC7;&#x6599;&#x7684;&#x72C0;&#x614B;&#x70BA;false</td>
</tr>
<tr>
<td style="text-align:center">&#x5C07;&#x7B2C;&#x4E00;&#x7B46;&#x8CC7;&#x6599;&#x7684;&#x72C0;&#x614B;&#x6539;&#x70BA;true&#xFF0C;&#x6C92;&#x6709;&#x9055;&#x53CD;&#x5546;&#x696D;&#x908F;&#x8F2F;</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center">&#x5C07;&#x7B2C;&#x4E8C;&#x7B46;&#x8CC7;&#x6599;&#x7684;&#x72C0;&#x614B;&#x6539;&#x70BA;true&#xFF0C;&#x6C92;&#x6709;&#x9055;&#x53CD;&#x5546;&#x696D;&#x908F;&#x8F2F;</td>
</tr>
<tr>
<td style="text-align:center">&#x4EA4;&#x6613;&#x7D50;&#x675F;&#xFF0C;commit</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center">&#x4EA4;&#x6613;&#x7D50;&#x675F;&#xFF0C;commit</td>
</tr>
</tbody>
</table>
<p>&#x7D50;&#x679C;&#x6703;&#x662F;&#x5169;&#x7B46;&#x8CC7;&#x6599;&#x90FD;&#x88AB;&#x8B8A;&#x66F4;&#x70BA; true &#x4E86;&#xFF0C;&#x8207;&#x5546;&#x696D;&#x908F;&#x8F2F;&#x76F8;&#x62B5;&#x89F8;&#x3002;</p>
<h3 id="write-skew-%E7%9A%84%E8%A7%A3%E6%B1%BA%E8%BE%A6%E6%B3%95">Write Skew &#x7684;&#x89E3;&#x6C7A;&#x8FA6;&#x6CD5;</h3>
<h4 id="%E5%B0%87%E4%BA%A4%E6%98%93%E9%9A%94%E9%9B%A2%E7%AD%89%E7%B4%9A%E8%A8%AD%E7%82%BA-serializable">&#x5C07;&#x4EA4;&#x6613;&#x9694;&#x96E2;&#x7B49;&#x7D1A;&#x8A2D;&#x70BA; SERIALIZABLE</h4>
<p>SERIALIZABLE &#x7B49;&#x7D1A;&#x7684;&#x4EA4;&#x6613;&#x6703;&#x5E8F;&#x5217;&#x5316;&#x57F7;&#x884C;&#xFF0C;&#x5C31;&#x50CF;&#x4F75;&#x767C;&#x4E0D;&#x5B58;&#x5728;&#x4E00;&#x6A23;&#xFF0C;&#x53EF;&#x907F;&#x514D; Write Skew &#x7684;&#x554F;&#x984C;&#xFF0C;&#x4F46;&#x7F3A;&#x9EDE;&#x5C31;&#x662F;&#x6548;&#x7387;&#x6975;&#x5DEE;&#x3002;</p>
<h4 id="%E4%BD%BF%E7%94%A8%E5%85%A9%E9%9A%8E%E6%AE%B5%E9%8E%96%E5%AE%9A-2pl%EF%BC%8Ctwo-phase-locking">&#x4F7F;&#x7528;&#x5169;&#x968E;&#x6BB5;&#x9396;&#x5B9A; (2PL&#xFF0C;two-phase locking)</h4>
<p>&#x4E00;&#x7A2E;&#x5E8F;&#x5217;&#x5316;&#x6F14;&#x7B97;&#x6CD5;&#xFF0C;&#x5C6C;&#x65BC;&#x60B2;&#x89C0;&#x7684;&#x4F75;&#x767C;&#x63A7;&#x5236;&#x6A5F;&#x5236;</p>
<h4 id="%E4%BD%BF%E7%94%A8%E5%8F%AF%E5%BA%8F%E5%88%97%E5%8C%96%E5%BF%AB%E7%85%A7%E9%9A%94%E9%9B%A2%EF%BC%88ssi-serializable-snapshot-isolation%EF%BC%89">&#x4F7F;&#x7528;&#x53EF;&#x5E8F;&#x5217;&#x5316;&#x5FEB;&#x7167;&#x9694;&#x96E2;&#xFF08;SSI, serializable snapshot isolation&#xFF09;</h4>
<p>&#x4E00;&#x7A2E;&#x5E8F;&#x5217;&#x5316;&#x6F14;&#x7B97;&#x6CD5;&#xFF0C;&#x5C6C;&#x65BC;&#x6A02;&#x89C0;&#x7684;&#x4F75;&#x767C;&#x63A7;&#x5236;&#x6A5F;&#x5236;</p>
<h2 id="%E5%90%84%E6%83%85%E5%A2%83%E4%B9%8B%E9%96%93%E7%9A%84%E5%B7%AE%E7%95%B0">&#x5404;&#x60C5;&#x5883;&#x4E4B;&#x9593;&#x7684;&#x5DEE;&#x7570;</h2>
<h3 id="non-repeatable-read-%E5%92%8C-phantom-%E7%9A%84%E5%B7%AE%E7%95%B0">Non-repeatable Read &#x548C; Phantom &#x7684;&#x5DEE;&#x7570;</h3>
<p>Non-repeatable Read &#x662F;&#x5728;&#x540C;&#x4E00;&#x500B;&#x4EA4;&#x6613;&#x4E2D;&#x7684;&#x5169;&#x6B21;&#x67E5;&#x8A62;&#x4E4B;&#x9593;&#x6709;&#x5176;&#x4ED6;&#x4EA4;&#x6613; commit&#xFF0C;&#x5176;&#x4E2D;&#x6709;&#x6578;&#x503C;&#x88AB;&#x6539;&#x52D5;&#x4E86;&#xFF0C;&#x5C0E;&#x81F4;&#x591A;&#x6B21;&#x67E5;&#x8A62;&#x540C;&#x4E00;&#x7B46;&#x8CC7;&#x6599;&#x7684;&#x7D50;&#x679C;&#x662F;&#x4E0D;&#x540C;&#x7684;&#x3002;<br>
Phantom &#x662F;&#x5728;&#x540C;&#x4E00;&#x500B;&#x4EA4;&#x6613;&#x4E2D;&#x7684;&#x5169;&#x6B21;&#x67E5;&#x8A62;&#x4E4B;&#x9593;&#x6709;&#x5176;&#x4ED6;&#x4EA4;&#x6613; commit&#xFF0C;&#x5176;&#x4E2D;&#x8CC7;&#x6599;&#x7B46;&#x6578;&#x6709;&#x88AB;&#x8B8A;&#x52D5;&#xFF0C;&#x5C0E;&#x81F4;&#x591A;&#x6B21;&#x67E5;&#x8A62;&#x7684;&#x56DE;&#x50B3;&#x8CC7;&#x6599;&#x7B46;&#x6578;&#x4E0D;&#x540C;&#x3002;</p>
<h3 id="lost-update-%E8%88%87-dirty-write-%E7%9A%84%E5%B7%AE%E7%95%B0">Lost update &#x8207; dirty write &#x7684;&#x5DEE;&#x7570;</h3>
<p>Dirty write &#x662F;&#x5728; commit &#x524D;&#x5C31;&#x88AB;&#x8986;&#x84CB;&#x6389;&#xFF0C;lost update &#x5247;&#x662F;&#x5DF2;&#x7D93; commit &#x5F8C;&#x624D;&#x88AB;&#x84CB;&#x6389;&#x3002;</p>
<h3 id="lost-update-%E8%88%87-write-skew-%E7%9A%84%E5%B7%AE%E7%95%B0">Lost update &#x8207; Write Skew &#x7684;&#x5DEE;&#x7570;</h3>
<p>Lost update &#x662F;&#x5171;&#x540C;&#x7DE8;&#x8F2F;&#x540C;&#x4E00;&#x7B46;&#x8CC7;&#x6599;&#x4E14;&#x7DE8;&#x8F2F;&#x5230;&#x4E86;&#x904E;&#x6642;&#x7684;&#x8CC7;&#x6599;&#xFF0C;&#x5C0E;&#x81F4;&#x7DE8;&#x8F2F;&#x7684;&#x503C;&#x88AB;&#x5F8C;&#x7E8C; commit &#x7684;&#x503C;&#x8986;&#x84CB;&#x6389;&#x5C0E;&#x81F4;&#x7684;&#x554F;&#x984C;&#x3002;<br>
Write Skew &#x662F;&#x7DE8;&#x8F2F;&#x5230;&#x4E86;&#x904E;&#x6642;&#x7684;&#x8CC7;&#x6599;&#x5C0E;&#x81F4;&#x5546;&#x696D;&#x908F;&#x8F2F;&#x932F;&#x8AA4;&#x7684;&#x554F;&#x984C;&#x3002;<br>
Lost update &#x53EF;&#x4EE5;&#x7B97;&#x662F; Write Skew &#x7684;&#x4E00;&#x7A2E; special case&#x3002;</p>
<h6 id="%E5%8F%83%E8%80%83%E8%B3%87%E6%96%99">&#x53C3;&#x8003;&#x8CC7;&#x6599;</h6>
<ul>
<li><a href="https://ajing-notebook.blogspot.com/2021/12/postgresql-transaction.html?ref=localhost">[PostgreSQL] &#x8CC7;&#x6599;&#x5EAB;&#x7684;Race Condition&#x554F;&#x984C;&#x8207;&#x4EA4;&#x6613;&#x9694;&#x96E2;&#x7B49;&#x7D1A;</a></li>
<li><a href="https://learn.microsoft.com/zh-tw/sql/t-sql/statements/set-transaction-isolation-level-transact-sql?view=sql-server-ver16&amp;ref=localhost">SET TRANSACTION ISOLATION LEVEL (Transact-SQL)</a></li>
<li><a href="https://totoroliu.medium.com/%E8%B3%87%E6%96%99%E5%BA%AB-isolation-levels-c587d3103ba4?ref=localhost">&#x8CC7;&#x6599;&#x5EAB; Isolation Levels</a></li>
<li><a href="https://blog.amis.com/database-transaction-isolation-a1e448a7736e?ref=localhost">&#x8CC7;&#x6599;&#x5EAB;&#x4EA4;&#x6613;&#x7684; Isolation</a></li>
<li><a href="https://myapollo.com.tw/blog/interview-question-race-condition/?ref=localhost">&#x5F8C;&#x7AEF;&#x5DE5;&#x7A0B;&#x5E2B;&#x9762;&#x8A66;&#x8003;&#x4EC0;&#x9EBC; - Race Condition &#x7BC7;</a></li>
<li><a href="https://stackoverflow.com/a/52245852?ref=localhost">Why write skew can happen in Repeatable reads?</a></li>
<li><a href="https://stackoverflow.com/questions/11043712/what-is-the-difference-between-non-repeatable-read-and-phantom-read?ref=localhost">What is the difference between Non-Repeatable Read and Phantom Read?</a></li>
<li><a href="https://blog.csdn.net/u013288190/article/details/119773584?ref=localhost">&#x5199;&#x504F;&#x659C;&#xFF08;Write Skew&#xFF09;&#x548C;&#x4E22;&#x5931;&#x66F4;&#x65B0;&#xFF08;Lost Updates&#xFF09;&#x533A;&#x522B;</a></li>
<li><a href="https://blog.ite2.com/repeating-number/?ref=localhost">&#x5E7E;&#x7A2E;&#x65B9;&#x5F0F;&#x907F;&#x514D;&#x53D6;&#x865F;&#x529F;&#x80FD;&#x53D6;&#x5230;&#x91CD;&#x8907;&#x7684;&#x503C;</a></li>
<li><a href="https://dotblogs.com.tw/joysdw12/2012/06/07/72668?ref=localhost">[ASP.NET] &#x4F7F;&#x7528;Lock&#x9396;&#x5B9A; &#x5728;&#x591A;&#x4F7F;&#x7528;&#x8005;&#x6216;&#x591A;&#x57F7;&#x884C;&#x7DD2;&#x4E0B;&#x65B0;&#x589E;&#x7DE8;&#x865F;&#x78BA;&#x4FDD;&#x7DE8;&#x865F;&#x4E0D;&#x91CD;&#x8907;</a></li>
<li><a href="http://ddia.vonng.com/?ref=localhost#/zh-tw/ch7?id=%e7%ac%ac%e4%b8%83%e7%ab%a0%ef%bc%9a%e4%ba%8b%e5%8b%99">DDIA &#x7B2C;&#x4E03;&#x7AE0;&#xFF1A;&#x4E8B;&#x52D9;</a></li>
<li><a href="https://segmentfault.com/a/1190000023045909?ref=localhost">&#x6570;&#x636E;&#x5E93;-MySQL&#x4E2D;for update&#x7684;&#x4F5C;&#x7528;&#x548C;&#x7528;&#x6CD5;</a></li>
</ul>
<!--kg-card-end: markdown-->]]></content:encoded></item><item><title><![CDATA[Queued background tasks in ASP.NET Core]]></title><description><![CDATA[在實務上有時候會遇到某些需要花費大量時間執行的任務，像我就是在寫公司專案時遇到需要產生縮圖和轉檔的需求，若不想讓使用者一直轉圈圈等待的話，我們必須採用一些方法讓我們可以先回覆使用者，之後再來慢慢處理這些需求，在背景中讓這些任務排隊執行就是其中一個方法。]]></description><link>https://vincent87720.github.io/queued-background-tasks-in-asp-net-core/</link><guid isPermaLink="false">651996620bc50e000198cfe7</guid><category><![CDATA[ASP.NET Core]]></category><category><![CDATA[C#]]></category><dc:creator><![CDATA[Katsuobushi]]></dc:creator><pubDate>Sun, 01 Oct 2023 16:01:03 GMT</pubDate><media:content url="https://vincent87720.github.io/content/images/2023/10/will-truettner-VYeFTyjns0M-unsplash.jpg" medium="image"/><content:encoded><![CDATA[<!--kg-card-begin: markdown--><img src="https://vincent87720.github.io/content/images/2023/10/will-truettner-VYeFTyjns0M-unsplash.jpg" alt="Queued background tasks in ASP.NET Core"><p>&#x5728;&#x5BE6;&#x52D9;&#x4E0A;&#x6709;&#x6642;&#x5019;&#x6703;&#x9047;&#x5230;&#x67D0;&#x4E9B;&#x9700;&#x8981;&#x82B1;&#x8CBB;&#x5927;&#x91CF;&#x6642;&#x9593;&#x57F7;&#x884C;&#x7684;&#x4EFB;&#x52D9;&#xFF0C;&#x50CF;&#x6211;&#x5C31;&#x662F;&#x5728;&#x5BEB;&#x516C;&#x53F8;&#x5C08;&#x6848;&#x6642;&#x9047;&#x5230;&#x9700;&#x8981;&#x7522;&#x751F;&#x7E2E;&#x5716;&#x548C;&#x8F49;&#x6A94;&#x7684;&#x9700;&#x6C42;&#xFF0C;&#x82E5;&#x4E0D;&#x60F3;&#x8B93;&#x4F7F;&#x7528;&#x8005;&#x4E00;&#x76F4;&#x8F49;&#x5708;&#x5708;&#x7B49;&#x5F85;&#x7684;&#x8A71;&#xFF0C;&#x6211;&#x5011;&#x5FC5;&#x9808;&#x63A1;&#x7528;&#x4E00;&#x4E9B;&#x65B9;&#x6CD5;&#x8B93;&#x6211;&#x5011;&#x53EF;&#x4EE5;&#x5148;&#x56DE;&#x8986;&#x4F7F;&#x7528;&#x8005;&#xFF0C;&#x4E4B;&#x5F8C;&#x518D;&#x4F86;&#x6162;&#x6162;&#x8655;&#x7406;&#x9019;&#x4E9B;&#x9700;&#x6C42;&#xFF0C;&#x5728;&#x80CC;&#x666F;&#x4E2D;&#x8B93;&#x9019;&#x4E9B;&#x4EFB;&#x52D9;&#x6392;&#x968A;&#x57F7;&#x884C;&#x5C31;&#x662F;&#x5176;&#x4E2D;&#x4E00;&#x500B;&#x65B9;&#x6CD5;&#x3002;</p>
<h2 id="%E7%92%B0%E5%A2%83">&#x74B0;&#x5883;</h2>
<ul>
<li>macOS Ventura 13.0(Apple M1 Pro)</li>
<li>.NET 6.0</li>
<li>Visual Studio Community 2022 for Mac 17.6.1</li>
</ul>
<h2 id="%E5%BB%BA%E7%AB%8B%E4%BD%87%E5%88%97%E6%9C%8D%E5%8B%99">&#x5EFA;&#x7ACB;&#x4F47;&#x5217;&#x670D;&#x52D9;</h2>
<p>&#x5728;<code>Services</code>&#x76EE;&#x9304;&#x4E0B;&#x5EFA;&#x7ACB;<code>BackgroundTaskQueue.cs</code>&#x6A94;&#x6848;&#x3002;</p>
<p>&#x5728;&#x9019;&#x500B;&#x6A94;&#x6848;&#x4E2D;&#x653E;&#x5165;&#x4E00;&#x500B;interface&#x53CA;&#x4E00;&#x500B;&#x985E;&#x5225;&#xFF0C;&#x5206;&#x5225;&#x662F;<code>IBackgroundTaskQueue</code>&#x53CA;<code>BackgroundTaskQueue</code>&#x3002;</p>
<p><code>IBackgroundTaskQueue</code>&#x5B9A;&#x7FA9;Queue&#x7684;interface&#xFF0C;&#x5305;&#x542B;&#x5C07;&#x4EFB;&#x52D9;&#x52A0;&#x5165;Queue&#x4EE5;&#x53CA;&#x5F9E;Queue&#x4E2D;&#x53D6;&#x51FA;&#x670D;&#x52D9;&#x7684;&#x5169;&#x500B;&#x65B9;&#x6CD5;&#x3002;</p>
<p><code>BackgroundTaskQueue</code>&#x662F;<code>IBackgroundTaskQueue</code>&#x7684;&#x5BE6;&#x4F5C;&#x985E;&#x5225;&#xFF0C;&#x63D0;&#x4F9B;&#x8CC7;&#x6599;&#x5132;&#x5B58;&#x53CA;&#x5BE6;&#x4F5C;&#x4ECB;&#x9762;&#x5B9A;&#x7FA9;&#x7684;&#x65B9;&#x6CD5;&#x3002;</p>
<h3 id="%E5%AE%9A%E7%BE%A9ibackgroundtaskqueue%E4%BB%8B%E9%9D%A2">&#x5B9A;&#x7FA9;IBackgroundTaskQueue&#x4ECB;&#x9762;</h3>
<p>&#x9996;&#x5148;&#x662F;<code>IBackgroundTaskQueue</code>&#xFF0C;interface&#x4E2D;&#x5B9A;&#x7FA9;&#x4E86;<code>QueueBackgroundWorkItem</code>&#x548C;<code>DequeueAsync</code>&#x5169;&#x500B;&#x65B9;&#x6CD5;&#x3002;</p>
<pre><code class="language-csharp">// BackgroundTaskQueue.cs

public interface IBackgroundTaskQueue
{
    void QueueBackgroundWorkItem(Func&lt;CancellationToken, Task&gt; workItem);

    Task&lt;Func&lt;CancellationToken, Task&gt;&gt; DequeueAsync(CancellationToken cancellationToken);
}
</code></pre>
<p><code>QueueBackgroundWorkItem</code>&#x7528;&#x65BC;&#x5C07;&#x4EFB;&#x52D9;&#x52A0;&#x5165;&#x5230;Queue&#x4E2D;&#xFF0C;&#x6B64;&#x65B9;&#x6CD5;&#x50B3;&#x5165;&#x4E00;&#x500B;&#x51FD;&#x5F0F;&#x4F5C;&#x70BA;&#x53C3;&#x6578;&#x3002;<br>
&#x9019;&#x500B;&#x4F5C;&#x70BA;&#x53C3;&#x6578;&#x50B3;&#x5165;&#x7684;&#x51FD;&#x5F0F;&#x4E5F;&#x6709;&#x53C3;&#x6578;&#x53CA;&#x56DE;&#x50B3;&#x503C;&#xFF0C;&#x53C3;&#x6578;&#x662F;<code>CancellationToken</code>&#xFF0C;&#x56DE;&#x50B3;&#x5247;&#x662F;<code>Task</code>&#x3002;<br>
&#x610F;&#x5373;&#x5FC5;&#x9808;&#x5C07;&#x4E00;&#x500B;&#x578B;&#x5225;&#x70BA;<code>Func&lt;CancellationToken, Task&gt;</code>&#x7684;&#x51FD;&#x5F0F;&#x50B3;&#x5165;&#x5230;<code>QueueBackgroundWorkItem</code>&#x51FD;&#x5F0F;&#x4E2D;&#xFF0C;&#x88AB;&#x50B3;&#x5165;&#x7684;&#x51FD;&#x5F0F;&#x4FBF;&#x662F;&#x6211;&#x5011;&#x8981;&#x6392;&#x968A;&#x57F7;&#x884C;&#x7684;&#x4EFB;&#x52D9;&#x3002;</p>
<p><code>DequeueAsync</code>&#x7528;&#x65BC;&#x5C07;&#x4EFB;&#x52D9;&#x5F9E;Queue&#x4E2D;&#x53D6;&#x51FA;&#xFF0C;&#x6B64;&#x65B9;&#x6CD5;&#x50B3;&#x5165;<code>CancellationToken</code>&#x4F5C;&#x70BA;&#x53C3;&#x6578;&#xFF0C;&#x56DE;&#x50B3;&#x503C;&#x662F;<code>Func&lt;CancellationToken, Task&gt;</code>&#xFF0C;&#x8207;&#x5148;&#x524D;&#x52A0;&#x5165;Queue&#x7684;&#x4EFB;&#x52D9;&#x7684;&#x578B;&#x5225;&#x76F8;&#x540C;&#x3002;</p>
<h3 id="%E5%AF%A6%E4%BD%9Cbackgroundtaskqueue%E9%A1%9E%E5%88%A5">&#x5BE6;&#x4F5C;BackgroundTaskQueue&#x985E;&#x5225;</h3>
<p>&#x5B9A;&#x7FA9;&#x597D;<code>IBackgroundTaskQueue</code>&#x4ECB;&#x9762;&#x5F8C;&#xFF0C;&#x4EE5;<code>BackgroundTaskQueue</code>&#x5BE6;&#x4F5C;&#x8A72;&#x4ECB;&#x9762;&#xFF0C;&#x6B64;&#x985E;&#x5225;&#x9664;&#x4E86;<code>QueueBackgroundWorkItem</code>&#x548C;<code>DequeueAsync</code>&#x5169;&#x500B;&#x65B9;&#x6CD5;&#x4EE5;&#x5916;&#x9084;&#x589E;&#x52A0;&#x4E86;<code>_workItems</code>&#x53CA;<code>_signal</code>&#x5169;&#x500B;&#x5C6C;&#x6027;&#x3002;</p>
<pre><code class="language-csharp">// BackgroundTaskQueue.cs

public class BackgroundTaskQueue : IBackgroundTaskQueue
{
    // ConcurrentQueue&#x662F;&#x57F7;&#x884C;&#x5E8F;&#x5B89;&#x5168;&#x7684;&#x96C6;&#x5408;&#x985E;&#x578B;&#xFF0C;&#x7528;&#x4F86;&#x5B58;&#x653E;&#x4EFB;&#x52D9;
    private ConcurrentQueue&lt;Func&lt;CancellationToken, Task&gt;&gt; _workItems =
        new ConcurrentQueue&lt;Func&lt;CancellationToken, Task&gt;&gt;();

    // &#x865F;&#x8A8C;
    private SemaphoreSlim _signal = new SemaphoreSlim(0);

    // &#x5C07;&#x4EFB;&#x52D9;&#x52A0;&#x5165;&#x4F47;&#x5217;
    public void QueueBackgroundWorkItem(
        Func&lt;CancellationToken, Task&gt; workItem)
    {
        if (workItem == null)
        {
            throw new ArgumentNullException(nameof(workItem));
        }

        _workItems.Enqueue(workItem);
        _signal.Release();
    }

    // &#x5C07;&#x4EFB;&#x52D9;&#x5F9E;&#x4F47;&#x5217;&#x53D6;&#x51FA;
    public async Task&lt;Func&lt;CancellationToken, Task&gt;&gt; DequeueAsync(CancellationToken cancellationToken)
    {
        await _signal.WaitAsync(cancellationToken);
        _workItems.TryDequeue(out var workItem);

        return workItem;
    }
}
</code></pre>
<p><code>_workItems</code>&#x7684;&#x578B;&#x5225;&#x662F;<code>ConcurrentQueue&lt;Func&lt;CancellationToken, Task&gt;&gt;</code>&#xFF0C;ConcurrentQueue&#x662F;&#x57F7;&#x884C;&#x5E8F;&#x5B89;&#x5168;&#x7684;Queue&#xFF0C;&#x7528;&#x4F86;&#x5B58;&#x653E;&#x578B;&#x5225;&#x70BA;<code>Func&lt;CancellationToken, Task&gt;</code>&#x7684;&#x4EFB;&#x52D9;&#x3002;<br>
<code>_signal</code>&#x7684;&#x578B;&#x5225;&#x662F;<code>SemaphoreSlim</code>&#xFF0C;&#x7528;&#x65BC;&#x7BA1;&#x5236;&#x76EE;&#x524D;&#x53EF;&#x5B58;&#x53D6;<code>_workItems</code>&#x4EFB;&#x52D9;&#x7684;&#x6578;&#x91CF;&#x3002;&#x6211;&#x5011;&#x6703;&#x5728;&#x5C07;&#x4EFB;&#x52D9;&#x52A0;&#x5165;&#x4F47;&#x5217;&#x6642;&#x4F7F;&#x7528;<code>_signal</code>&#x7684;<code>Release()</code>&#x65B9;&#x6CD5;&#xFF0C;&#x8B93;<code>_signal</code>&#x7684;&#x53EF;&#x540C;&#x6642;&#x5B58;&#x53D6;&#x6578;&#x91CF;&#x52A0;1&#x3002;&#x5728;&#x5C07;&#x4EFB;&#x52D9;&#x5F9E;&#x4F47;&#x5217;&#x53D6;&#x51FA;&#x6642;&#x547C;&#x53EB;<code>WaitAsync()</code>&#x65B9;&#x6CD5;&#xFF0C;&#x82E5;<code>_signal</code>&#x7684;&#x53EF;&#x7528;&#x6578;&#x91CF;&#x8DB3;&#x5920;&#x6642;&#x5247;&#x5C07;&#x4EFB;&#x52D9;&#x5F9E;&#x4F47;&#x5217;&#x53D6;&#x51FA;&#xFF0C;&#x82E5;<code>_signal</code>&#x7684;&#x53EF;&#x7528;&#x6578;&#x91CF;&#x4E0D;&#x8DB3;&#x6642;&#x5247;&#x8B93;&#x547C;&#x53EB;&#x8005;&#x7B49;&#x5F85;&#x3002;</p>
<p><code>QueueBackgroundWorkItem</code>&#x65B9;&#x6CD5;&#x50B3;&#x5165;&#x8981;&#x88AB;&#x52A0;&#x5165;&#x5230;<code>_workItems</code>&#x7684;&#x4EFB;&#x52D9;&#xFF0C;&#x6B64;&#x65B9;&#x6CD5;&#x9996;&#x5148;&#x6AA2;&#x67E5;&#x50B3;&#x5165;&#x7684;<code>workItem</code>&#x662F;&#x5426;&#x70BA;null&#xFF0C;&#x82E5;&#x4E0D;&#x662F;null&#x5247;&#x5C07;&#x4EFB;&#x52D9;&#x52A0;&#x5165;&#x5230;<code>_workItems</code>&#x88E1;&#x982D;&#x6392;&#x968A;&#xFF0C;&#x4E26;&#x5C07;<code>_signal</code>&#x7684;&#x53EF;&#x7528;&#x6578;&#x91CF;&#x52A0;1&#x3002;</p>
<p><code>DequeueAsync</code>&#x65B9;&#x6CD5;&#x50B3;&#x5165;<code>cancellationToken</code>&#xFF0C;&#x9032;&#x5165;&#x65B9;&#x6CD5;&#x5F8C;&#x6301;&#x7E8C;&#x7B49;&#x5F85;&#x76F4;&#x5230;&#x53EF;&#x7528;&#x6578;&#x91CF;&#x8DB3;&#x5920;&#x4E14;&#x88AB;<code>_signal</code>&#x653E;&#x884C;&#x70BA;&#x6B62;&#xFF0C;&#x88AB;&#x653E;&#x884C;&#x5F8C;&#x5C31;&#x53EF;&#x4EE5;&#x5F9E;<code>_workItems</code>&#x5C07;&#x4EFB;&#x52D9;Dequeue&#x51FA;&#x4F86;&#x4E26;&#x56DE;&#x50B3;&#x3002;</p>
<h3 id="%E8%A8%BB%E5%86%8Abackgroundtaskqueue%E6%9C%8D%E5%8B%99">&#x8A3B;&#x518A;BackgroundTaskQueue&#x670D;&#x52D9;</h3>
<p>&#x5728;&#x4F7F;&#x7528;BackgroundTaskQueue&#x670D;&#x52D9;&#x524D;&#xFF0C;&#x6211;&#x5011;&#x9700;&#x8981;&#x5728;<code>Program.cs</code>&#x6A94;&#x6848;&#x4E2D;&#x8A3B;&#x518A;BackgroundTaskQueue&#x670D;&#x52D9;&#x3002;&#x7531;&#x65BC;BackgroundTaskQueue&#x5728;&#x6574;&#x500B;&#x7A0B;&#x5F0F;&#x4E2D;&#x53EA;&#x80FD;&#x5B58;&#x5728;&#x4E00;&#x500B;&#x5BE6;&#x9AD4;&#xFF0C;&#x5FC5;&#x9808;&#x4F7F;&#x7528;AddSingleton&#x65B9;&#x6CD5;&#x5C07;BackgroundTaskQueue&#x8A3B;&#x518A;&#x70BA;Singleton&#x7684;&#x670D;&#x52D9;&#x3002;</p>
<pre><code class="language-csharp">// Program.cs

...
    
var builder = WebApplication.CreateBuilder(args);

...

// &#x5C07;BackgroundTaskQueue&#x8A3B;&#x518A;&#x70BA;Singleton&#x670D;&#x52D9;
builder.Services.AddSingleton&lt;IBackgroundTaskQueue, BackgroundTaskQueue&gt;();

...
    
var app = builder.Build();

...
    
app.Run();
</code></pre>
<h2 id="%E5%BB%BA%E7%AB%8B%E8%83%8C%E6%99%AF%E6%9C%8D%E5%8B%99">&#x5EFA;&#x7ACB;&#x80CC;&#x666F;&#x670D;&#x52D9;</h2>
<p>&#x6709;&#x4E86;&#x6392;&#x968A;&#x7684;&#x6A5F;&#x5236;&#x4E4B;&#x5F8C;&#xFF0C;&#x6211;&#x5011;&#x9700;&#x8981;&#x8B93;&#x7A0B;&#x5F0F;&#x6709;&#x7A7A;&#x9592;&#x6642;&#x81EA;&#x52D5;&#x5728;&#x80CC;&#x666F;&#x4E2D;&#x57F7;&#x884C;&#x9019;&#x4E9B;&#x4EFB;&#x52D9;&#xFF0C;&#x9019;&#x6642;&#x5019;&#x5C31;&#x9700;&#x8981;&#x7528;&#x5230;<code>BackgroundService</code>&#x985E;&#x5225;&#x4F86;&#x5E6B;&#x52A9;&#x6211;&#x5011;&#x9054;&#x6210;&#x9019;&#x500B;&#x6A5F;&#x5236;&#x3002;</p>
<h3 id="%E5%AF%A6%E4%BD%9Cqueuedhostedservice%E9%A1%9E%E5%88%A5">&#x5BE6;&#x4F5C;QueuedHostedService&#x985E;&#x5225;</h3>
<p>&#x5728;<code>Services</code>&#x76EE;&#x9304;&#x4E0B;&#x5EFA;&#x7ACB;<code>QueuedHostedService.cs</code>&#x6A94;&#x6848;&#x3002;</p>
<p>&#x5728;&#x9019;&#x500B;&#x6A94;&#x6848;&#x4E2D;&#x5EFA;&#x7ACB;&#x4E00;&#x500B;<code>QueuedHostedService</code>&#x985E;&#x5225;&#xFF0C;&#x6B64;&#x985E;&#x5225;&#x7E7C;&#x627F;<code>BackgroundService</code>&#x985E;&#x5225;&#x4E26;&#x5BE6;&#x4F5C;&#x5176;<code>ExecuteAsync</code>&#x65B9;&#x6CD5;&#x3002;</p>
<pre><code class="language-csharp">public class QueuedHostedService : BackgroundService
{
    private readonly ILogger _logger;
    private readonly IBackgroundTaskQueue _taskQueue;

    public QueuedHostedService(
        IBackgroundTaskQueue taskQueue,
        ILoggerFactory loggerFactory)
    {
        _taskQueue = taskQueue;
        _logger = loggerFactory.CreateLogger&lt;QueuedHostedService&gt;();
    }

    protected async override Task ExecuteAsync(CancellationToken cancellationToken)
    {
        _logger.LogInformation(&quot;Queued Hosted Service is starting.&quot;);

        while (!cancellationToken.IsCancellationRequested)
        {
            // &#x5F9E;&#x4F47;&#x5217;&#x4E2D;&#x53D6;&#x5F97;workItem
            var workItem = await _taskQueue.DequeueAsync(cancellationToken);

            try
            {
                // &#x57F7;&#x884C;&#x5F9E;&#x4F47;&#x5217;&#x53D6;&#x5F97;&#x7684;&#x51FD;&#x5F0F;
                await workItem(cancellationToken);
            }
            catch (Exception ex)
            {
                _logger.LogError(ex,
                   $&quot;Error occurred executing {nameof(workItem)}.&quot;);
            }
        }

        _logger.LogInformation(&quot;Queued Hosted Service is stopping.&quot;);
    }
}
</code></pre>
<p><code>ExecuteAsync</code>&#x65B9;&#x6CD5;&#x88E1;&#x7684;while&#x8FF4;&#x5708;&#x6703;&#x4E0D;&#x505C;&#x7684;&#x57F7;&#x884C;&#xFF0C;&#x7576;&#x6709;&#x4EFB;&#x52D9;&#x9700;&#x8981;&#x88AB;&#x57F7;&#x884C;&#x6642;&#x6703;&#x5F9E;_taskQueue.DequeueAsync&#x53D6;&#x5F97;&#x4EFB;&#x52D9;&#xFF0C;&#x4E26;&#x5728;try&#x5340;&#x584A;&#x5167;&#x88AB;&#x57F7;&#x884C;&#xFF0C;&#x82E5;&#x767C;&#x751F;&#x932F;&#x8AA4;&#x4E5F;&#x6703;&#x5728;&#x6B64;&#x88AB;&#x6355;&#x6349;&#x5230;&#x3002;</p>
<p>&#x7E3D;&#x7684;&#x4F86;&#x8AAA;&#xFF0C;QueuedHostedService&#x5C31;&#x662F;&#x8CA0;&#x8CAC;&#x4E0D;&#x65B7;&#x7684;&#x5728;&#x80CC;&#x666F;&#x4E2D;&#x5F9E;Queue&#x53D6;&#x5F97;&#x4EFB;&#x52D9;&#x4E26;&#x57F7;&#x884C;&#x3002;</p>
<h3 id="%E8%A8%BB%E5%86%8Aqueuedhostedservice%E6%9C%8D%E5%8B%99">&#x8A3B;&#x518A;QueuedHostedService&#x670D;&#x52D9;</h3>
<p>&#x8207;&#x5176;&#x4ED6;&#x670D;&#x52D9;&#x4E00;&#x6A23;&#xFF0C;&#x6211;&#x5011;&#x9700;&#x8981;&#x5728;<code>Program.cs</code>&#x6A94;&#x6848;&#x4E2D;&#x8A3B;&#x518A;QueuedHostedService&#x670D;&#x52D9;&#x3002;&#x4E0D;&#x904E;&#x56E0;&#x70BA;QueuedHostedService&#x8981;&#x63D0;&#x4F9B;&#x7684;&#x662F;&#x80CC;&#x666F;&#x670D;&#x52D9;&#xFF0C;&#x5FC5;&#x9808;&#x4F7F;&#x7528;AddHostedService&#x65B9;&#x6CD5;&#x5C07;QueuedHostedService&#x8A3B;&#x518A;&#x70BA;HostedService&#x3002;</p>
<pre><code class="language-csharp">// Program.cs

...
    
var builder = WebApplication.CreateBuilder(args);

...

// &#x5C07;QueuedHostedService&#x8A3B;&#x518A;&#x70BA;HostedService
builder.Services.AddHostedService&lt;QueuedHostedService&gt;();

...
    
var app = builder.Build();

...
    
app.Run();
</code></pre>
<p>&#x5230;&#x9019;&#x908A;&#x6211;&#x5011;&#x5DF2;&#x7D93;&#x53EF;&#x4EE5;&#x8B93;&#x670D;&#x52D9;&#x5728;Queue&#x4E2D;&#x6392;&#x968A;&#xFF0C;&#x4E26;&#x4E14;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x80CC;&#x666F;&#x670D;&#x52D9;&#x5C07;&#x5728;&#x6392;&#x968A;&#x7684;&#x670D;&#x52D9;&#x53D6;&#x51FA;&#x57F7;&#x884C;&#xFF0C;&#x63A5;&#x8457;&#x6211;&#x5011;&#x53EA;&#x8981;&#x628A;&#x6211;&#x5011;&#x7684;&#x4EFB;&#x52D9;&#x52A0;&#x5165;&#x5230;Queue&#x4E2D;&#x8B93;&#x4ED6;&#x5011;&#x6392;&#x968A;&#x5C31;&#x884C;&#x4E86;&#x3002;</p>
<h2 id="%E8%AE%93%E4%BB%BB%E5%8B%99%E5%8A%A0%E5%85%A5%E5%88%B0%E9%9A%8A%E4%BC%8D%E4%B8%AD">&#x8B93;&#x4EFB;&#x52D9;&#x52A0;&#x5165;&#x5230;&#x968A;&#x4F0D;&#x4E2D;</h2>
<p>&#x5728;<code>Services</code>&#x76EE;&#x9304;&#x4E0B;&#x5EFA;&#x7ACB;<code>RecordService.cs</code>&#x6A94;&#x6848;&#xFF0C;&#x6B64;&#x6A94;&#x6848;&#x53EA;&#x662F;&#x70BA;&#x4E86;&#x5C55;&#x793A;&#x5982;&#x4F55;&#x5C07;&#x4EFB;&#x52D9;&#x52A0;&#x5165;&#x5230;Queue&#x4E2D;&#xFF0C;&#x4E0D;&#x4E00;&#x5B9A;&#x8981;&#x5EFA;&#x7ACB;&#x9019;&#x500B;&#x6A94;&#x6848;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;&#x4EFB;&#x4F55;&#x9700;&#x8981;&#x8B93;&#x4EFB;&#x52D9;&#x6392;&#x968A;&#x7684;&#x5730;&#x65B9;&#x52A0;&#x5165;&#x6392;&#x968A;&#x7684;&#x7A0B;&#x5F0F;&#x78BC;&#x3002;</p>
<pre><code class="language-csharp">public class RecordService
{
    private readonly IBackgroundTaskQueue _taskQueue;

    public RecordService(IBackgroundTaskQueue taskQueue)
    {
        _taskQueue = taskQueue;
    }

    public void ShowText(int from, int to)
    {
        Console.WriteLine(&quot;1&quot;);
        _taskQueue.QueueBackgroundWorkItem(async cancellationToken =&gt;
        {
            for(int i= from; i&lt; to; i++)
            {
                Console.WriteLine(i);
            }
        });
        Console.WriteLine(&quot;2&quot;);
    }
}
</code></pre>
<p>&#x5728;&#x5EFA;&#x69CB;&#x5B50;&#x4E2D;&#xFF0C;&#x6211;&#x5011;&#x4F7F;&#x7528;DI&#x6CE8;&#x5165;<code>IBackgroundTaskQueue</code>&#x670D;&#x52D9;&#xFF0C;&#x5C07;&#x670D;&#x52D9;&#x5B58;&#x653E;&#x5728;<code>_taskQueue</code>&#x4E2D;&#x3002;<br>
&#x5728;<code>ShowText</code>&#x4E2D;&#xFF0C;&#x6211;&#x5011;&#x4F7F;&#x7528;<code>_taskQueue.QueueBackgroundWorkItem</code>&#x65B9;&#x6CD5;&#x5C07;&#x4E00;&#x500B;&#x6703;&#x5F9E;from&#x8F38;&#x51FA;&#x5230;to&#x7684;&#x8FF4;&#x5708;&#x4F5C;&#x70BA;&#x4EFB;&#x52D9;&#x52A0;&#x5165;&#x5230;<code>_taskQueue</code>&#x53BB;&#x6392;&#x968A;&#xFF0C;&#x9019;&#x500B;&#x4EFB;&#x52D9;&#x6703;&#x5728;<code>QueuedHostedService</code>&#x88E1;&#x7684;<code>ExecuteAsync</code>&#x88AB;&#x6392;&#x968A;&#x57F7;&#x884C;&#x3002;</p>
<h3 id="%E8%A8%BB%E5%86%8Arecordservice%E6%9C%8D%E5%8B%99">&#x8A3B;&#x518A;RecordService&#x670D;&#x52D9;</h3>
<p>&#x8A18;&#x5F97;&#x5C07;RecordService&#x4E5F;&#x8A3B;&#x518A;&#x5230;<code>Program.cs</code>&#x6A94;&#x6848;&#x4E2D;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x81EA;&#x5DF1;&#x9700;&#x8981;&#x7684;&#x751F;&#x547D;&#x9031;&#x671F;&#x8A3B;&#x518A;&#x670D;&#x52D9;&#xFF0C;&#x9019;&#x88E1;&#x4F7F;&#x7528;AddTransient&#x9032;&#x884C;&#x793A;&#x7BC4;&#x3002;</p>
<pre><code class="language-csharp">// Program.cs

...
    
var builder = WebApplication.CreateBuilder(args);

...

// &#x5C07;RecordService&#x8A3B;&#x518A;&#x70BA;Transient&#x7684;&#x670D;&#x52D9;
builder.Services.AddTransient&lt;RecordService&gt;();

...
    
var app = builder.Build();

...
    
app.Run();
</code></pre>
<p>&#x5C07;&#x4E0A;&#x9762;&#x7684;&#x6240;&#x6709;&#x670D;&#x52D9;&#x90FD;&#x5EFA;&#x7ACB;&#x597D;&#x4E4B;&#x5F8C;&#x6211;&#x5011;&#x5C31;&#x53EF;&#x4EE5;&#x8B93;&#x6703;&#x82B1;&#x8CBB;&#x5F88;&#x591A;&#x6642;&#x9593;&#x7684;&#x4EFB;&#x52D9;&#x901A;&#x901A;&#x53BB;&#x6392;&#x968A;&#x4E86;(&#xFF89;&gt;&#x3C9;&lt;)&#xFF89;</p>
<h6 id="%E5%8F%83%E8%80%83%E8%B3%87%E6%96%99">&#x53C3;&#x8003;&#x8CC7;&#x6599;</h6>
<ul>
<li><a href="https://www.cnblogs.com/Vincent-yuan/p/11048748.html?ref=localhost">dotnet core&#x7CFB;&#x5217;&#x4E4B;Background tasks with hosted services (&#x540E;&#x53F0;&#x4EFB;&#x52A1;)</a></li>
<li><a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/host/hosted-services?view=aspnetcore-7.0&amp;3Btabs=visual-studio&amp;tabs=visual-studio-mac%2Cvisual-studio&amp;ref=localhost#queued-background-tasks">Background tasks with hosted services in ASP.NET Core | Microsoft Learn</a></li>
</ul>
<!--kg-card-end: markdown-->]]></content:encoded></item><item><title><![CDATA[IEnumerable或IQueryable物件在進行LINQ查詢時的差異]]></title><description><![CDATA[當使用LINQ查詢時，執行對象是IEnumerable或是IQueryable有很大的差異。]]></description><link>https://vincent87720.github.io/difference-between-ienumerable-iqueryable-linq/</link><guid isPermaLink="false">65105b6630e7a60001e1d564</guid><category><![CDATA[C#]]></category><dc:creator><![CDATA[Katsuobushi]]></dc:creator><pubDate>Sun, 24 Sep 2023 16:01:52 GMT</pubDate><media:content url="https://vincent87720.github.io/content/images/2023/09/vs2012_gray_imprint.png" medium="image"/><content:encoded><![CDATA[<!--kg-card-begin: markdown--><img src="https://vincent87720.github.io/content/images/2023/09/vs2012_gray_imprint.png" alt="IEnumerable&#x6216;IQueryable&#x7269;&#x4EF6;&#x5728;&#x9032;&#x884C;LINQ&#x67E5;&#x8A62;&#x6642;&#x7684;&#x5DEE;&#x7570;"><p>&#x7576;&#x4F7F;&#x7528;LINQ&#x67E5;&#x8A62;&#x6642;&#xFF0C;&#x57F7;&#x884C;&#x5C0D;&#x8C61;&#x662F;IEnumerable&#x6216;&#x662F;IQueryable&#x6709;&#x5F88;&#x5927;&#x7684;&#x5DEE;&#x7570;&#x3002;</p>
<h2 id="%E5%B0%8Diqueryable%E7%89%A9%E4%BB%B6%E6%88%96ienumerable%E7%89%A9%E4%BB%B6%E4%BD%BF%E7%94%A8linq%E6%9F%A5%E8%A9%A2%E7%9A%84%E5%B7%AE%E7%95%B0">&#x5C0D;IQueryable&#x7269;&#x4EF6;&#x6216;IEnumerable&#x7269;&#x4EF6;&#x4F7F;&#x7528;LINQ&#x67E5;&#x8A62;&#x7684;&#x5DEE;&#x7570;</h2>
<p>&#x91DD;&#x5C0D;IQueryable&#x5BE6;&#x4F5C;&#x7684;LINQ&#x67E5;&#x8A62;&#x65B9;&#x6CD5;&#x7528;&#x65BC;&#x5E6B;&#x52A9;DataProvider&#x751F;&#x6210;SQL&#x8A9E;&#x6CD5;&#x3002;<br>
&#x91DD;&#x5C0D;IEnumerable&#x5BE6;&#x4F5C;&#x7684;LINQ&#x67E5;&#x8A62;&#x65B9;&#x6CD5;&#x662F;&#x76F4;&#x63A5;&#x5C0D;&#x8A18;&#x61B6;&#x9AD4;&#x4E2D;&#x7684;&#x8CC7;&#x6599;&#x9032;&#x884C;&#x904E;&#x6FFE;&#x3002;</p>
<pre><code class="language-csharp">IEnumerable&lt;Record&gt; records = _dbContext.Record.Where(r =&gt; r.Uid == uid).ToList();
IEnumerable&lt;Record&gt; records = _dbContext.Record.ToList().Where(r =&gt; r.Uid == uid);
</code></pre>
<p>&#x9019;&#x5169;&#x884C;&#x7684;&#x5DEE;&#x7570;&#x5728;&#x65BC;<code>.ToList()</code>&#x53CA;<code>.Where()</code>&#x7684;&#x4F4D;&#x7F6E;&#x4E0D;&#x540C;&#xFF0C;&#x50C5;&#x50C5;&#x662F;&#x4F4D;&#x7F6E;&#x4E0D;&#x540C;&#x5C31;&#x6703;&#x7522;&#x751F;&#x4E0D;&#x540C;&#x7684;SQL&#x8A9E;&#x53E5;&#x548C;&#x884C;&#x70BA;&#x3002;</p>
<p>&#x7B2C;&#x4E00;&#x884C;&#x7684;<code>.Where()</code>&#x662F;&#x91DD;&#x5C0D;IQueryable&#x5BE6;&#x4F5C;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x4F7F;&#x7528;&#x9019;&#x7A2E;&#x65B9;&#x6CD5;&#x6703;&#x7522;&#x751F;&#x5305;&#x542B;Where&#x8A9E;&#x6CD5;&#x7684;SQL&#x8A9E;&#x53E5;&#xFF0C;&#x4E26;&#x5728;<code>.ToList()</code>&#x65B9;&#x6CD5;&#x88AB;&#x547C;&#x53EB;&#x6642;&#x57F7;&#x884C;&#xFF0C;&#x8CC7;&#x6599;&#x5EAB;&#x6703;&#x4F9D;&#x7167;where&#x7684;&#x689D;&#x4EF6;&#x904E;&#x6FFE;&#x5F8C;&#x56DE;&#x50B3;&#x904E;&#x6FFE;&#x5F8C;&#x7684;&#x8CC7;&#x6599;&#x3002;</p>
<p>&#x7B2C;&#x4E8C;&#x884C;&#x7684;<code>.ToList()</code>&#x5728;<code>.Where()</code>&#x4E4B;&#x524D;&#x88AB;&#x547C;&#x53EB;&#xFF0C;&#x6B64;&#x6642;&#x6703;&#x9001;&#x51FA;&#x5B8C;&#x5168;&#x6C92;&#x6709;&#x904E;&#x6FFE;&#x689D;&#x4EF6;&#x7684;SQL&#x5230;&#x8CC7;&#x6599;&#x5EAB;&#xFF0C;&#x4E26;&#x8FD4;&#x56DE;&#x6240;&#x6709;&#x8CC7;&#x6599;&#xFF0C;&#x9019;&#x4E9B;&#x8CC7;&#x6599;&#x518D;&#x7D93;&#x7531;&#x91DD;&#x5C0D;IEnumerable&#x5BE6;&#x4F5C;&#x7684;<code>.Where()</code>&#x65B9;&#x6CD5;&#x904E;&#x6FFE;&#xFF0C;&#x6B64;&#x6642;&#x904E;&#x6FFE;&#x4FBF;&#x4E0D;&#x662F;&#x5728;&#x8CC7;&#x6599;&#x5EAB;&#x800C;&#x662F;&#x5728;&#x8A18;&#x61B6;&#x9AD4;&#x3002;</p>
<p>&#x7531;&#x6B64;&#x53EF;&#x77E5;&#xFF0C;&#x5728;&#x8CC7;&#x6599;&#x88AB;&#x5217;&#x8209;&#x524D;&#x7684;LINQ&#x67E5;&#x8A62;&#x65B9;&#x6CD5;&#x7684;&#x985E;&#x5225;&#x6703;&#x662F;IQueryable&#xFF0C;&#x5141;&#x8A31;&#x88AB;&#x8ABF;&#x6574;&#x70BA;&#x5404;&#x5F0F;&#x5404;&#x6A23;&#x7684;SQL&#x8A9E;&#x53E5;&#x3002;<br>
&#x800C;&#x5728;&#x8CC7;&#x6599;&#x88AB;&#x5217;&#x8209;&#x5F8C;&#x7684;LINQ&#x67E5;&#x8A62;&#x65B9;&#x6CD5;&#x7684;&#x985E;&#x5225;&#x6703;&#x662F;IEnumerable&#xFF0C;&#x6B64;&#x6642;&#x8CC7;&#x6599;&#x5DF2;&#x5B58;&#x653E;&#x5728;&#x8A18;&#x61B6;&#x9AD4;&#xFF0C;&#x4E0D;&#x6703;&#x518D;&#x62FC;&#x6E4A;&#x4EFB;&#x4F55;SQL&#x8A9E;&#x53E5;&#x3002;</p>
<p>&#x7E3D;&#x7684;&#x4F86;&#x8AAA;&#x5169;&#x8005;&#x7684;&#x5DEE;&#x7570;&#x5728;&#x65BC;&#xFF1A;<br>
&#x91DD;&#x5C0D;IQueryable&#x5BE6;&#x4F5C;&#x7684;LINQ&#x67E5;&#x8A62;&#x6703;&#x5C07;&#x689D;&#x4EF6;&#x90FD;&#x4E32;&#x597D;&#x53BB;query&#x8CC7;&#x6599;&#xFF0C;&#x8CC7;&#x6599;&#x6703;&#x5728;&#x8CC7;&#x6599;&#x5EAB;&#x4E2D;&#x88AB;&#x7BE9;&#x9078;<br>
&#x800C;&#x91DD;&#x5C0D;IEnumerable&#x5BE6;&#x4F5C;&#x7684;LINQ&#x67E5;&#x8A62;&#x662F;&#x91DD;&#x5C0D;&#x5DF2;&#x5B58;&#x5728;&#x8A18;&#x61B6;&#x9AD4;&#x7684;&#x8CC7;&#x6599;&#x9032;&#x884C;&#x7BE9;&#x9078;</p>
<h6 id="%E5%8F%83%E8%80%83%E8%B3%87%E6%96%99">&#x53C3;&#x8003;&#x8CC7;&#x6599;</h6>
<ul>
<li><a href="https://dotblogs.com.tw/UgiYo/2019/08/10/001704?ref=localhost">[&#x7B46;&#x8A18;] IEnumerable v.s IQueryable</a></li>
<li><a href="https://blog.darkthread.net/blog/iqueryable-experiment/?ref=localhost">&#x95DC;&#x65BC;IQueryable&lt;T&gt;&#x7279;&#x6027;&#x7684;&#x5C0F;&#x5BE6;&#x9A57;</a></li>
<li><a href="https://blog.csdn.net/weixin_43263355/article/details/121680150?ref=localhost">C#&#x4E2D;&#x7684;IQueryable vs IEnumerable</a></li>
<li><a href="https://dotblogs.com.tw/wasichris/2015/03/04/150633?ref=localhost">[Entity Framework][LINQ] IEnumerable&#x8207;IQueryable&#x5DEE;&#x7570;&#x6BD4;&#x8F03;</a></li>
</ul>
<!--kg-card-end: markdown-->]]></content:encoded></item><item><title><![CDATA[使用ASP.NET Core Web API提供HLS影片串流服務]]></title><description><![CDATA[公司的APP其中一個功能是影片上傳及串流的服務，這陣子比較了許多影片串流及直播的通訊協定，最後選擇使用HLS協定來提供影片串流服務，流程包括「建立影片上傳API」、「影片轉檔」及「建立串流API」，這篇筆記記錄如何使用ASP.NET Core Web API來建立影音串流服務。]]></description><link>https://vincent87720.github.io/build-media-streaming-in-asp-net-core-using-hls/</link><guid isPermaLink="false">64fc94aefc699500018c4164</guid><category><![CDATA[ASP.NET Core]]></category><category><![CDATA[C#]]></category><category><![CDATA[HLS]]></category><category><![CDATA[StreamingMedia]]></category><dc:creator><![CDATA[Katsuobushi]]></dc:creator><pubDate>Sat, 09 Sep 2023 16:08:45 GMT</pubDate><media:content url="https://vincent87720.github.io/content/images/2023/09/jonatan-lewczuk-CSsUkXtQ_PM-unsplash.jpg" medium="image"/><content:encoded><![CDATA[<!--kg-card-begin: markdown--><img src="https://vincent87720.github.io/content/images/2023/09/jonatan-lewczuk-CSsUkXtQ_PM-unsplash.jpg" alt="&#x4F7F;&#x7528;ASP.NET Core Web API&#x63D0;&#x4F9B;HLS&#x5F71;&#x7247;&#x4E32;&#x6D41;&#x670D;&#x52D9;"><p>&#x516C;&#x53F8;&#x7684;APP&#x5176;&#x4E2D;&#x4E00;&#x500B;&#x529F;&#x80FD;&#x662F;&#x5F71;&#x7247;&#x4E0A;&#x50B3;&#x53CA;&#x4E32;&#x6D41;&#x7684;&#x670D;&#x52D9;&#xFF0C;&#x9019;&#x9663;&#x5B50;&#x6BD4;&#x8F03;&#x4E86;&#x8A31;&#x591A;&#x5F71;&#x7247;&#x4E32;&#x6D41;&#x53CA;&#x76F4;&#x64AD;&#x7684;&#x901A;&#x8A0A;&#x5354;&#x5B9A;&#xFF0C;&#x6700;&#x5F8C;&#x9078;&#x64C7;&#x4F7F;&#x7528;HLS&#x5354;&#x5B9A;&#x4F86;&#x63D0;&#x4F9B;&#x5F71;&#x7247;&#x4E32;&#x6D41;&#x670D;&#x52D9;&#xFF0C;&#x6D41;&#x7A0B;&#x5305;&#x62EC;&#x300C;&#x5EFA;&#x7ACB;&#x5F71;&#x7247;&#x4E0A;&#x50B3;API&#x300D;&#x3001;&#x300C;&#x5F71;&#x7247;&#x8F49;&#x6A94;&#x300D;&#x53CA;&#x300C;&#x5EFA;&#x7ACB;&#x4E32;&#x6D41;API&#x300D;&#xFF0C;&#x9019;&#x7BC7;&#x7B46;&#x8A18;&#x8A18;&#x9304;&#x5982;&#x4F55;&#x4F7F;&#x7528;ASP.NET Core Web API&#x4F86;&#x5EFA;&#x7ACB;&#x5F71;&#x97F3;&#x4E32;&#x6D41;&#x670D;&#x52D9;&#x3002;</p>
<h2 id="%E6%AA%94%E6%A1%88%E7%B5%90%E6%A7%8B">&#x6A94;&#x6848;&#x7D50;&#x69CB;</h2>
<pre><code class="language-shell">|-- Example
|    |--Program.cs          #&#x7A0B;&#x5F0F;&#x9032;&#x5165;&#x9EDE;
|    |
|    |--Example.csproj      #CSharp&#x5C08;&#x6848;&#x6A94;
|    |
|    |--ApiControllers      #&#x5B58;&#x653E;API
|    |    |--MultimediaController.cs #&#x63D0;&#x4F9B;&#x591A;&#x5A92;&#x9AD4;&#x4E0A;&#x50B3;&#x53CA;&#x4E0B;&#x8F09;&#x7684;API
|    |
|    |--Models              #&#x8CC7;&#x6599;&#x8868;&#x6A21;&#x578B;&#x5B58;&#x653E;&#x8CC7;&#x6599;&#x593E;
|    |    |--Multimedia.cs  #&#x7528;&#x65BC;&#x5B58;&#x653E;&#x5F71;&#x97F3;&#x8CC7;&#x8A0A;&#x7684;&#x6A21;&#x578B;
|    |
|    |--Services                     #&#x670D;&#x52D9;&#x5B58;&#x653E;&#x8CC7;&#x6599;&#x593E;
|    |    |--MultimediaService.cs    #&#x63D0;&#x4F9B;&#x591A;&#x5A92;&#x9AD4;&#x670D;&#x52D9;
|    |    |--FileService.cs          #&#x63D0;&#x4F9B;&#x6A94;&#x6848;&#x64CD;&#x4F5C;&#x670D;&#x52D9;
|    |    |--HLSService.cs           #&#x63D0;&#x4F9B;HLS&#x4E32;&#x6D41;&#x670D;&#x52D9;
|    |
|    |--FFMpeg                       #FFMpeg&#x53EF;&#x57F7;&#x884C;&#x6A94;&#xFF08;&#x5B98;&#x7DB2;&#x4E0B;&#x8F09;&#xFF09;
|
|-- Example.sln             #&#x5C08;&#x6848;
</code></pre>
<h2 id="%E5%BD%B1%E7%89%87%E4%B8%8A%E5%82%B3">&#x5F71;&#x7247;&#x4E0A;&#x50B3;</h2>
<h3 id="%E5%BB%BA%E7%AB%8B%E4%B8%8A%E5%82%B3%E5%BD%B1%E7%89%87%E6%9C%8D%E5%8B%99">&#x5EFA;&#x7ACB;&#x4E0A;&#x50B3;&#x5F71;&#x7247;&#x670D;&#x52D9;</h3>
<p>&#x4E0A;&#x50B3;&#x5F71;&#x7247;&#x6703;&#x7528;&#x5230;<code>IFormFile</code>&#x9019;&#x500B;&#x4ECB;&#x9762;&#xFF0C;<code>IFormFile</code>&#x7528;&#x4F86;&#x8655;&#x7406;&#x6216;&#x5132;&#x5B58;&#x6A94;&#x6848;&#xFF0C;&#x6211;&#x5011;&#x5728;<code>Services</code>&#x76EE;&#x9304;&#x5E95;&#x4E0B;&#x7684;<code>MultimediaService.cs</code>&#x6A94;&#x6848;&#x88E1;&#x65B0;&#x589E;<code>CreateMultimedia</code>&#x51FD;&#x5F0F;&#x4E26;&#x50B3;&#x5165;&#x578B;&#x5225;&#x70BA;<code>IFormFile</code>&#x7684;&#x53C3;&#x6578;&#x3002;</p>
<p>&#x9996;&#x5148;&#x53D6;&#x5F97;&#x6A94;&#x6848;&#x7684;&#x526F;&#x6A94;&#x540D;&#xFF0C;&#x540C;&#x6642;&#x7522;&#x751F;&#x4E00;&#x500B;&#x65B0;&#x6A94;&#x540D;&#xFF0C;&#x63A5;&#x8457;&#x5EFA;&#x7ACB;&#x4E00;&#x500B;Multimedia&#x7684;&#x7269;&#x4EF6;&#xFF0C;&#x5C07;&#x8CC7;&#x8A0A;&#x5B58;&#x653E;&#x9032;&#x53BB;&#x3002;</p>
<p>&#x9019;&#x88E1;&#x6211;&#x5011;&#x4F7F;&#x7528;&#x6CE8;&#x5165;&#x65B9;&#x5F0F;&#x5C07;&#x8CC7;&#x6599;&#x5EAB;&#x6CE8;&#x5165;&#xFF0C;&#x5DF2;&#x5EFA;&#x7ACB;&#x597D;&#x7684;Multimedia&#x7269;&#x4EF6;&#x4F7F;&#x7528;&#x88AB;&#x6CE8;&#x5165;&#x7684;_dbContext&#x52A0;&#x5165;&#x5230;&#x8CC7;&#x6599;&#x5EAB;&#x4E2D;&#xFF0C;&#x4E26;&#x4E14;&#x547C;&#x53EB;SaveChanges&#x4FDD;&#x5B58;&#x8B8A;&#x52D5;&#x3002;</p>
<pre><code class="language-csharp">//MultimediaService.cs

public class MultimediaService
{    
    private readonly DBContext _dbContext;

    public MultimediaService(DBContext dbContext)
    {
        //&#x6CE8;&#x5165;&#x8CC7;&#x6599;&#x5EAB;Context&#xFF0C;&#x7528;&#x65BC;&#x5C0D;&#x8CC7;&#x6599;&#x5EAB;&#x9032;&#x884C;CRUD
        _dbContext = dbContext;
    }

    public void CreateMultimedia(IFormFile file)
    {
        //&#x53D6;&#x5F97;&#x526F;&#x6A94;&#x540D;
        var fileExt = Path.GetExtension(file.FileName);
        
        //&#x7522;&#x751F;&#x4E00;&#x500B;&#x65B0;&#x96A8;&#x6A5F;&#x6A94;&#x540D;&#xFF0C;&#x907F;&#x514D;&#x6A94;&#x540D;&#x91CD;&#x8907;
        var fileNewName = Path.GetRandomFileName();
        
        //&#x7522;&#x751F;&#x4E00;&#x500B;Multimedia&#x7269;&#x4EF6;&#xFF0C;&#x547C;&#x53EB;Add&#x65B9;&#x6CD5;&#x52A0;&#x5165;Multimedia&#x8CC7;&#x6599;&#x8868;&#xFF0C;
        //&#x6700;&#x5F8C;&#x4F7F;&#x7528;_dbContext.SaveChanges()&#x5132;&#x5B58;&#x66F4;&#x52D5;
        Multimedia multimedia = new Multimedia()
        {
            Uid = Guid.NewGuid(),
            Type = file.ContentType,
            Size = file.Length,
            Ext = fileExt,
            Name = fileNewName,
            RecordId = request.RecordId
        };
        var mmedia = _dbContext.Multimedia.Add(multimedia);
        _dbContext.SaveChanges();
    }
}
</code></pre>
<p>&#x9019;&#x500B;&#x6A94;&#x6848;&#x5148;&#x5BEB;&#x5230;&#x9019;&#xFF0C;&#x6211;&#x5011;&#x5148;&#x5EFA;&#x7ACB;&#x8CC7;&#x6599;&#x5132;&#x5B58;&#x53CA;&#x8F49;&#x6A94;&#x7684;&#x7A0B;&#x5F0F;&#xFF0C;&#x63A5;&#x8457;&#x624D;&#x6703;&#x628A;&#x6240;&#x6709;&#x670D;&#x52D9;&#x90FD;&#x4E32;&#x8D77;&#x4F86;&#x3002;</p>
<p>&#x9664;&#x4E86;&#x5728;&#x8CC7;&#x6599;&#x5EAB;&#x5B58;&#x653E;&#x6A94;&#x6848;&#x8CC7;&#x8A0A;&#x5916;&#xFF0C;&#x9084;&#x9700;&#x8981;&#x5728;&#x5BE6;&#x9AD4;&#x76EE;&#x9304;&#x4E2D;&#x5B58;&#x653E;&#x5BE6;&#x9AD4;&#x5F71;&#x97F3;&#x6A94;&#x6848;&#x63D0;&#x4F9B;&#x4E32;&#x6D41;&#x53CA;&#x4E0B;&#x8F09;&#xFF0C;&#x6211;&#x5011;&#x5728;<code>Services</code>&#x76EE;&#x9304;&#x5E95;&#x4E0B;&#x65B0;&#x589E;<code>FileService.cs</code>&#xFF0C;&#x7528;&#x65BC;&#x63D0;&#x4F9B;&#x6A94;&#x6848;&#x5132;&#x5B58;&#x53CA;&#x8B80;&#x53D6;&#x7684;&#x64CD;&#x4F5C;&#x3002;</p>
<p><code>WriteFile</code>&#x51FD;&#x5F0F;&#x50B3;&#x5165;&#x8981;&#x5BEB;&#x5165;&#x5230;&#x672C;&#x6A5F;&#x7684;&#x6A94;&#x6848;&#x3001;&#x6A94;&#x6848;&#x540D;&#x7A31;&#x53CA;&#x526F;&#x6A94;&#x540D;&#xFF0C;&#x6AA2;&#x67E5;&#x76EE;&#x7684;&#x76EE;&#x9304;&#x662F;&#x5426;&#x5B58;&#x5728;&#xFF0C;&#x4E26;&#x4F7F;&#x7528;CopyToAsync&#x53CA;Stream&#x5BEB;&#x5165;&#x6A94;&#x6848;&#x3002;</p>
<pre><code class="language-csharp">//FileService.cs

public class FileService
{
    //&#x8A2D;&#x5B9A;&#x6A94;&#x6848;&#x5B58;&#x653E;&#x4F4D;&#x7F6E;
    private readonly string basePath = &quot;./MultimediaFiles/&quot;;
    
    public async Task WriteFile(IFormFile file, string fileName, string fileExt)
    {
        //&#x4F7F;&#x7528;Path.Combine&#x5408;&#x4F75;&#x591A;&#x500B;&#x8DEF;&#x5F91;&#xFF0C;&#x907F;&#x514D;&#x591A;&#x9918;&#x7684;&apos;/&apos;&#x7B26;&#x865F;&#x7522;&#x751F;
        var filePath = Path.Combine(basePath, fileName);
        
        //&#x5224;&#x65B7;&#x76EE;&#x6A19;&#x76EE;&#x9304;&#x662F;&#x5426;&#x5B58;&#x5728;&#xFF0C;&#x4E0D;&#x5B58;&#x5728;&#x4FBF;&#x5275;&#x5EFA;&#x76EE;&#x9304;
        if (Directory.Exists(basePath) == false)
        {
            Directory.CreateDirectory(basePath);
        }
        
        //&#x5EFA;&#x7ACB;&#x6A94;&#x6848;&#x4E26;&#x6307;&#x5B9A;&#x7D66;stream
        Stream stream = File.Create(filePath + fileExt);
        
        //&#x4F7F;&#x7528;IFormFile&#x7684;CopyToAsync&#x65B9;&#x6CD5;&#xFF0C;&#x5C07;file&#x653E;&#x5165;stream
        await file.CopyToAsync(stream);
        
        //&#x95DC;&#x9589;stream
        stream.Close();
    }
}
</code></pre>
<p>&#x6B64;&#x6642;&#x6211;&#x5011;&#x5DF2;&#x7D93;&#x80FD;&#x5920;&#x5C07;&#x6A94;&#x6848;&#x5BEB;&#x5165;&#x672C;&#x6A5F;&#x76EE;&#x9304;&#x4E2D;&#x4E86;&#xFF0C;&#x63A5;&#x8457;&#x4FBF;&#x662F;&#x6211;&#x5011;&#x4ECA;&#x5929;&#x7684;&#x91CD;&#x982D;&#x6232;&#xFF0D;&#x8F49;&#x6A94;</p>
<h3 id="%E5%BD%B1%E7%89%87%E8%BD%89%E6%AA%94%E7%82%BAm3u8%E6%A0%BC%E5%BC%8F">&#x5F71;&#x7247;&#x8F49;&#x6A94;&#x70BA;m3u8&#x683C;&#x5F0F;</h3>
<p>&#x4E0D;&#x514D;&#x4FD7;&#x7684;&#x6211;&#x5011;&#x518D;&#x4F86;&#x5EFA;&#x7ACB;&#x4E00;&#x500B;&#x670D;&#x52D9;</p>
<p>&#x5728;<code>Services</code>&#x76EE;&#x9304;&#x5E95;&#x4E0B;&#x65B0;&#x589E;<code>HLSService.cs</code>&#xFF0C;&#x7528;&#x65BC;&#x63D0;&#x4F9B;HLS&#x7684;&#x8F49;&#x6A94;&#x670D;&#x52D9;&#x3002;</p>
<p>&#x9019;&#x88E1;&#x4F7F;&#x7528;FFMpeg&#x9032;&#x884C;&#x8F49;&#x6A94;&#xFF0C;&#x4F7F;&#x7528;FFMpeg&#x9032;&#x884C;&#x8F49;&#x6A94;&#x9664;&#x4E86;&#x8981;&#x4F7F;&#x7528;NuGet&#x5B89;&#x88DD;<code>FFMpegCore</code>Package&#x4E4B;&#x5916;&#xFF0C;&#x9084;&#x8981;&#x53BB;&#x5B98;&#x7DB2;&#x4E0B;&#x8F09;FFMpeg&#x7684;&#x53EF;&#x57F7;&#x884C;&#x6A94;&#xFF0C;&#x653E;&#x5165;&#x5C08;&#x6848;&#x76EE;&#x9304;&#x4E2D;&#x3002;</p>
<p>&#x5EFA;&#x7ACB;&#x4E00;&#x500B;WriteFile&#x51FD;&#x5F0F;&#xFF0C;&#x5728;&#x51FD;&#x5F0F;&#x5167;&#x4F7F;&#x7528;<code>FFMpegArguments</code>&#x985E;&#x5225;&#x9032;&#x884C;&#x8A2D;&#x5B9A;&#x53CA;&#x8F49;&#x6A94;&#x3002;</p>
<p><code>FromFileInput</code>&#x53EF;&#x4EE5;&#x7528;&#x65BC;&#x6307;&#x5B9A;&#x8F38;&#x5165;&#x6A94;&#x6848;&#x7684;&#x8DEF;&#x5F91;<br>
<code>OutputToFile</code>&#x53EF;&#x4EE5;&#x7528;&#x65BC;&#x6307;&#x5B9A;&#x8F38;&#x51FA;&#x6A94;&#x6848;&#x8DEF;&#x5F91;<br>
<code>ProcessAsynchronously</code>&#x7528;&#x65BC;&#x57F7;&#x884C;&#x8F49;&#x6A94;</p>
<pre><code class="language-csharp">//HLSService.cs

using FFMpegCore;

public class HLSService
{
    private readonly string basePath = &quot;./MultimediaFiles/&quot;;

    public async Task WriteFile(string fileName, string fileExt)
    {
        //&#x5224;&#x65B7;&#x76EE;&#x6A19;&#x76EE;&#x9304;&#x662F;&#x5426;&#x5B58;&#x5728;&#xFF0C;&#x4E0D;&#x5B58;&#x5728;&#x4FBF;&#x5275;&#x5EFA;&#x76EE;&#x9304;
        var filePath = Path.Combine(basePath, fileName);
        if (Directory.Exists(basePath) == false)
        {
            Directory.CreateDirectory(basePath);
        }
        await FFMpegArguments
            .FromFileInput(filePath + fileExt)//&#x8F38;&#x5165;&#x8DEF;&#x5F91;&#x5F8C;&#x65B9;&#x5FC5;&#x9808;&#x5305;&#x542B;&#x539F;&#x6A94;&#x7684;&#x526F;&#x6A94;&#x540D;
            .OutputToFile(filePath + &quot;.m3u8&quot;)//&#x8F38;&#x51FA;&#x8DEF;&#x5F91;&#x5F8C;&#x65B9;&#x5FC5;&#x9808;&#x5305;&#x542B;&quot;.m3u8&quot;&#x526F;&#x6A94;&#x540D;
            .ProcessAsynchronously();
    }
}
</code></pre>
<p>&#x5230;&#x9019;&#x908A;&#x5DF2;&#x7D93;&#x53EF;&#x4EE5;&#x5C07;&#x5F71;&#x7247;&#x6A94;&#x8F49;&#x70BA;m3u8&#x53CA;ts&#x6A94;&#x4E86;&#xFF0C;&#x63A5;&#x8457;&#x5C31;&#x662F;&#x8981;&#x628A;&#x525B;&#x624D;&#x7684;&#x6240;&#x6709;&#x6B65;&#x9A5F;&#x4E32;&#x8D77;&#x4F86;&#xFF0C;&#x6211;&#x5011;&#x628A;&#x525B;&#x525B;&#x7684;&#x6B65;&#x9A5F;&#x90FD;&#x4E32;&#x5230;<code>MultimediaService</code>&#x88E1;&#x7684;<code>CreateMultimedia</code>&#x51FD;&#x5F0F;&#x88E1;&#x9762;&#x3002;</p>
<h3 id="%E5%8C%85%E8%A3%9D%E4%B8%8A%E5%82%B3%E6%B5%81%E7%A8%8B">&#x5305;&#x88DD;&#x4E0A;&#x50B3;&#x6D41;&#x7A0B;</h3>
<p>&#x525B;&#x624D;&#x5728;<code>FileService</code>&#x5EFA;&#x7ACB;&#x4E86;<code>WriteFile</code>&#x65B9;&#x6CD5;&#xFF0C;&#x7528;&#x65BC;&#x5C07;&#x6A94;&#x6848;&#x5BEB;&#x5165;&#x76EE;&#x9304;&#x4E2D;&#xFF0C;&#x5728;<code>HLSService</code>&#x4E5F;&#x5EFA;&#x7ACB;&#x4E86;<code>WriteFile</code>&#x65B9;&#x6CD5;&#xFF0C;&#x7528;&#x65BC;&#x9032;&#x884C;&#x5F71;&#x7247;&#x8F49;&#x6A94;&#xFF0C;&#x6211;&#x5011;&#x63A5;&#x8457;&#x8981;&#x628A;&#x9019;&#x4E9B;&#x670D;&#x52D9;&#x4E32;&#x8D77;&#x4F86;&#x3002;</p>
<p>&#x76EE;&#x524D;<code>MultimediaService</code>&#x4E2D;&#x7684;<code>CreateMultimedia</code>&#x51FD;&#x5F0F;&#x5BEB;&#x5230;&#x65B0;&#x589E;&#x5F71;&#x7247;&#x8CC7;&#x8A0A;&#x5230;&#x8CC7;&#x6599;&#x5EAB;&#xFF0C;&#x63A5;&#x8457;<code>_dbContext.SaveChanges();</code>&#x7684;&#x5F8C;&#x9762;&#x52A0;&#x5165;&#x5BEB;&#x6A94;&#x53CA;&#x8F49;&#x6A94;&#x7684;&#x670D;&#x52D9;&#x3002;</p>
<pre><code class="language-csharp">//MultimediaService.cs

public class MultimediaService
{    
    private readonly DBContext _dbContext;
    private readonly FileService _file;
    private readonly HLSService _hls;

    public MultimediaService(DBContext dbContext, FileService file, HLSService hls)
    {
        _dbContext = dbContext;
        _file = file;
        _hls = hls;
    }

    //&#x6CE8;&#x610F;&#x5FC5;&#x9808;&#x4F7F;&#x7528;async&#x5C07;&#x6B64;&#x51FD;&#x5F0F;&#x6307;&#x5B9A;&#x70BA;&#x975E;&#x540C;&#x6B65;&#xFF0C;
    //&#x56E0;&#x70BA;_file.WriteFile&#x53CA;_hls.WriteFile&#x51FD;&#x5F0F;&#x90FD;&#x662F;&#x975E;&#x540C;&#x6B65;&#x65B9;&#x6CD5;&#xFF0C;&#x5FC5;&#x9808;&#x88AB;&#x7B49;&#x5F85;
    //&#x9664;&#x4E86;&#x52A0;&#x5165;async&#x4EE5;&#x5916;&#x4E5F;&#x5FC5;&#x9808;&#x52A0;&#x5165;Task&#xFF0C;Task&#x4EE3;&#x8868;&#x4E0D;&#x6703;&#x56DE;&#x50B3;&#x503C;&#x4E14;&#x4EE5;&#x975E;&#x540C;&#x6B65;&#x65B9;&#x5F0F;&#x57F7;&#x884C;&#x51FD;&#x5F0F;
    //&#x82E5;&#x4F7F;&#x7528;void&#xFF0C;&#x51FD;&#x5F0F;&#x7684;&#x547C;&#x53EB;&#x7AEF;&#x7121;&#x6CD5;&#x52A0;&#x4E0A;await&#xFF0C;&#x6703;&#x5C0E;&#x81F4;&#x547C;&#x53EB;&#x7AEF;&#x7121;&#x6CD5;&#x6514;&#x622A;&#x4F8B;&#x5916;
    //&#x5BB9;&#x6613;&#x9020;&#x6210;&#x9748;&#x7570;&#x73FE;&#x8C61;
    public async Task CreateMultimedia(IFormFile file)
    {
        var fileExt = Path.GetExtension(file.FileName);
        
        var fileNewName = Path.GetRandomFileName();
        
        Multimedia multimedia = new Multimedia()
        {
            Uid = Guid.NewGuid(),
            Type = file.ContentType,
            Size = file.Length,
            Ext = fileExt,
            Name = fileNewName
        };
        var mmedia = _dbContext.Multimedia.Add(multimedia);
        _dbContext.SaveChanges();
        
        //&#x5C07;&#x6A94;&#x6848;&#x5132;&#x5B58;&#x5728;&#x672C;&#x6A5F;
        //&#x4F7F;&#x7528;DI&#x6CE8;&#x5165;&#x7684;FileService&#x670D;&#x52D9;&#xFF0C;&#x547C;&#x53EB;WriteFile&#x51FD;&#x5F0F;
        //&#x53C3;&#x6578;&#x50B3;&#x5165;&#x6A94;&#x6848;&#x3001;&#x6A94;&#x540D;&#x53CA;&#x526F;&#x6A94;&#x540D;
        await _file.WriteFile(file, fileNewName, fileExt);

        //&#x5C07;&#x6A94;&#x6848;&#x8F49;&#x70BA;m3u8&#x53CA;ts&#x6A94;
        //&#x50B3;&#x5165;&#x6A94;&#x540D;&#x53CA;&#x526F;&#x6A94;&#x540D;
        await _hls.WriteFile(fileNewName, fileExt);
    }
}
</code></pre>
<p>&#x606D;&#x559C;&#x6211;&#x5011;&#x7D42;&#x65BC;&#x5B8C;&#x6210;&#x4E0A;&#x50B3;&#x4E86;&#xFF0C;&#x63A5;&#x8457;&#x53EA;&#x8981;&#x5728;API&#x4E2D;&#x63D0;&#x4F9B;&#x6B64;&#x670D;&#x52D9;&#x5373;&#x53EF;</p>
<h3 id="%E5%BB%BA%E7%AB%8B%E4%B8%8A%E5%82%B3%E5%BD%B1%E7%89%87api">&#x5EFA;&#x7ACB;&#x4E0A;&#x50B3;&#x5F71;&#x7247;API</h3>
<p>&#x4E0A;&#x50B3;&#x5F71;&#x7247;&#x7684;API&#x6211;&#x5011;&#x628A;&#x4ED6;&#x653E;&#x5728;<code>ApiControllers</code>&#x76EE;&#x9304;&#x4E2D;&#xFF0C;&#x5728;&#x76EE;&#x9304;&#x4E2D;&#x5EFA;&#x7ACB;<code>MultimediaController.cs</code>&#x6A94;&#x6848;&#x5B58;&#x653E;API</p>
<pre><code class="language-csharp">//MultimediaController.cs

[Route(&quot;api/[controller]&quot;)]
[ApiController]
public class MultimediaController : Controller
{
    private MultimediaService _mmedia;

    public MultimediaController(MultimediaService mmedia)
    {
        _mmedia = mmedia;
    }

    [HttpPost]
    public async Task&lt;IActionResult&gt; PostMultimedia([FromForm] IFormFile file)
    {
        if (file.File.ContentType.Contains(&quot;video&quot;) == false)
        {
            return BadRequest();
        }

        //&#x547C;&#x53EB;&#x4E0A;&#x50B3;&#x5F71;&#x7247;&#x670D;&#x52D9;
        await _mmedia.CreateMultimedia(file);

        return Ok();
    }
}
</code></pre>
<p>&#x5F71;&#x7247;&#x4E0A;&#x50B3;&#x7D42;&#x65BC;&#x544A;&#x4E00;&#x6BB5;&#x843D;&#x4E86;&#xFF0C;&#x63A5;&#x8457;&#x662F;&#x5F71;&#x7247;&#x4E0B;&#x8F09;&#x53CA;&#x4E32;&#x6D41;</p>
<h2 id="%E5%BD%B1%E7%89%87%E4%B8%B2%E6%B5%81">&#x5F71;&#x7247;&#x4E32;&#x6D41;</h2>
<p>&#x525B;&#x624D;&#x5DF2;&#x7D93;&#x628A;&#x5F71;&#x7247;&#x90FD;&#x8F49;&#x6A94;&#x597D;&#x4E86;&#xFF0C;&#x5176;&#x5BE6;&#x5F71;&#x7247;&#x4E32;&#x6D41;&#x5C31;&#x53EA;&#x662F;&#x958B;&#x4E00;&#x500B;API&#x8B93;&#x524D;&#x7AEF;&#x4E1F;&#x8ACB;&#x6C42;&#x904E;&#x4F86;&#x62FF;&#x6A94;&#x6848;&#x800C;&#x5DF2;...&#x55CE;&#xFF1F;<br>
&#x4E5F;&#x6C92;&#x9019;&#x9EBC;&#x55AE;&#x7D14;&#xFF0C;&#x6211;&#x5011;&#x8981;&#x5148;&#x5F9E;&#x8CC7;&#x6599;&#x5EAB;&#x53D6;&#x5F97;&#x5F71;&#x7247;&#x5217;&#x8868;&#xFF0C;&#x6211;&#x5011;&#x9700;&#x8981;&#x88E1;&#x9762;&#x7684;&#x6A94;&#x6848;&#x540D;&#x7A31;&#xFF0C;&#x5B58;&#x53D6;&#x5B8C;&#x8CC7;&#x6599;&#x5EAB;&#x9084;&#x8981;&#x958B;&#x4E00;&#x500B;&#x8B80;&#x6A94;&#x6848;&#x7684;&#x670D;&#x52D9;&#x5F9E;&#x76EE;&#x9304;&#x4E2D;&#x8B80;&#x53D6;&#x6A94;&#x6848;&#xFF0C;&#x4E0D;&#x904E;&#x9019;&#x61C9;&#x8A72;&#x6BD4;&#x525B;&#x525B;&#x7684;&#x7C21;&#x55AE;&#x591A;&#x4E86;&#x3002;</p>
<h3 id="%E5%BE%9E%E8%B3%87%E6%96%99%E5%BA%AB%E5%8F%96%E5%BE%97%E5%BD%B1%E7%89%87%E8%B3%87%E8%A8%8A">&#x5F9E;&#x8CC7;&#x6599;&#x5EAB;&#x53D6;&#x5F97;&#x5F71;&#x7247;&#x8CC7;&#x8A0A;</h3>
<p>&#x5728;<code>MultimediaService.cs</code>&#x4E2D;&#x52A0;&#x5165;<code>GetMultimediaViews</code>&#x51FD;&#x5F0F;&#xFF0C;&#x53D6;&#x5F97;<code>_dbContext</code>&#x4E2D;<code>Multimedia</code>&#x8CC7;&#x6599;&#x8868;&#x7684;&#x8CC7;&#x6599;&#x3002;</p>
<pre><code class="language-csharp">//MultimediaService.cs

public class MultimediaService
{    
    private readonly DBContext _dbContext;
    private readonly FileService _file;
    private readonly HLSService _hls;

    public MultimediaService(DBContext dbContext, FileService file, HLSService hls)
    {
        _dbContext = dbContext;
        _file = file;
        _hls = hls;
    }
    
    public List&lt;Multimedia&gt; GetMultimediaViews()
    {
        return _dbContext.Multimedia.ToList();
    }
    
    public async Task CreateMultimedia(IFormFile file)
    {
        ...
    }
}
</code></pre>
<p>&#x958B;&#x597D;&#x670D;&#x52D9;&#x5F8C;&#x7531;<code>MultimediaController</code>&#x547C;&#x53EB;<code>GetMultimediaViews</code>&#x670D;&#x52D9;&#xFF0C;&#x5C07;&#x8CC7;&#x6599;&#x8868;&#x4E2D;&#x7684;&#x5F71;&#x97F3;&#x8CC7;&#x8A0A;&#x6E05;&#x55AE;&#x8FD4;&#x56DE;&#x7D66;&#x4F7F;&#x7528;&#x8005;</p>
<pre><code class="language-csharp">//MultimediaController.cs

[Route(&quot;api/[controller]&quot;)]
[ApiController]
public class MultimediaController : Controller
{
    private MultimediaService _mmedia;

    public MultimediaController(MultimediaService mmedia)
    {
        _mmedia = mmedia;
    }
    
    [HttpGet]
    [Route(&quot;List&quot;)]
    public IActionResult GetMultimediaList()
    {

        List&lt;Multimedia&gt; list = _mmedia.GetMultimediaViews();

        return Ok(list);
    }

    [HttpPost]
    public async Task&lt;IActionResult&gt; PostMultimedia([FromForm] IFormFile file)
    {
        ...
    }
}
</code></pre>
<h3 id="%E5%BE%9E%E7%9B%AE%E9%8C%84%E5%8F%96%E5%BE%97%E6%AA%94%E6%A1%88">&#x5F9E;&#x76EE;&#x9304;&#x53D6;&#x5F97;&#x6A94;&#x6848;</h3>
<p>&#x5148;&#x524D;&#x5BEB;&#x5165;&#x6A94;&#x6848;&#x6642;&#x628A;&#x7A0B;&#x5F0F;&#x5BEB;&#x5728;<code>FileService.cs</code>&#xFF0C;&#x8B80;&#x53D6;&#x6A94;&#x6848;&#x6211;&#x5011;&#x4E00;&#x6A23;&#x628A;&#x51FD;&#x5F0F;&#x653E;&#x5728;&#x9019;&#x500B;&#x6A94;&#x6848;&#x88E1;&#x9762;</p>
<pre><code class="language-csharp">//FileService.cs

public class FileService
{

    private readonly string basePath = &quot;./MultimediaFiles/&quot;;


    public Stream? ReadFile(string fileName)
    {
        string filePath = Path.Combine(basePath, fileName);
        if (File.Exists(fileFullPath) == false)
        {
            return null;
        }

        //&#x4F7F;&#x7528;FileStream&#x8B80;&#x53D6;&#x4E26;&#x8FD4;&#x56DE;&#x6A94;&#x6848;Stream
        return new FileStream(filePath, FileMode.Open, FileAccess.Read,
            FileShare.ReadWrite, 4096, FileOptions.SequentialScan);
    }
    
    public async Task WriteFile(IFormFile file, string fileName, string fileExt)
    {
        ...
    }
    
}
</code></pre>
<p>&#x63A5;&#x8457;&#x5728;<code>MultimediaService</code>&#x4E2D;&#x547C;&#x53EB;&#x525B;&#x525B;&#x5EFA;&#x7ACB;&#x7684;&#x8B80;&#x53D6;&#x6A94;&#x6848;&#x51FD;&#x5F0F;&#xFF0C;&#x5EFA;&#x7ACB;<code>GetMultimedia</code>&#x670D;&#x52D9;</p>
<pre><code class="language-csharp">//MultimediaService.cs

public class MultimediaService
{    
    private readonly DBContext _dbContext;
    private readonly FileService _file;
    private readonly HLSService _hls;

    public MultimediaService(DBContext dbContext, FileService file, HLSService hls)
    {
        _dbContext = dbContext;
        _file = file;
        _hls = hls;
    }

    public Stream GetMultimedia(string filename)
    {
        return _file.ReadFile(filename);
    }
    
    public List&lt;Multimedia&gt; GetMultimediaViews()
    {
        ...
    }
    
    public async Task CreateMultimedia(IFormFile file)
    {
        ...
    }
}
</code></pre>
<p>&#x5230;&#x9019;&#x908A;&#x5DF2;&#x7D93;&#x5B8C;&#x6210;&#x6240;&#x6709;&#x670D;&#x52D9;&#x4E86;&#xFF0C;&#x63A5;&#x8457;&#x53EA;&#x8981;&#x5EFA;&#x7ACB;&#x53D6;&#x5F97;&#x6A94;&#x6848;&#x7684;API&#x5373;&#x53EF;</p>
<h3 id="%E5%BB%BA%E7%AB%8B%E4%B8%B2%E6%B5%81api">&#x5EFA;&#x7ACB;&#x4E32;&#x6D41;API</h3>
<p>&#x5728;<code>MultimediaController</code>&#x4E2D;&#x5EFA;&#x7ACB;<code>GetHLSMultimedia</code>API&#x51FD;&#x5F0F;&#xFF0C;&#x51FD;&#x5F0F;&#x4E2D;&#x547C;&#x53EB;<code>MultimediaService</code>&#x4E2D;&#x7684;<code>GetHLSMultimedia</code>&#x65B9;&#x6CD5;&#xFF0C;&#x53D6;&#x5F97;stream&#x5F8C;&#x4F7F;&#x7528;<code>File</code>&#x51FD;&#x5F0F;&#x5C07;stream&#x8FD4;&#x56DE;&#x7D66;&#x4F7F;&#x7528;&#x8005;&#xFF0C;&#x4E26;&#x6307;&#x5B9A;Content-Type&#x70BA;<code>video/mp2t</code>&#x3002;</p>
<pre><code class="language-csharp">//MultimediaController.cs

[Route(&quot;api/[controller]&quot;)]
[ApiController]
public class MultimediaController : Controller
{
    private MultimediaService _mmedia;

    public MultimediaController(MultimediaService mmedia)
    {
        _mmedia = mmedia;
    }
    
    [HttpGet]
    [Route(&quot;List&quot;)]
    public IActionResult GetMultimediaList()
    {
        ...
    }
    
    [HttpGet]
    [Route(&quot;HLS/{FileName}&quot;)]
    public async Task&lt;IActionResult&gt; GetHLSMultimedia(string FileName)
    {
        Stream? stream = await _mmedia.GetHLSMultimedia(FileName);
        if (stream == null)
        {
            return NotFound();
        }

        return File(stream, &quot;video/mp2t&quot;);
    }

    [HttpPost]
    public async Task&lt;IActionResult&gt; PostMultimedia([FromForm] IFormFile file)
    {
        ...
    }
}
</code></pre>
<h3 id="%E5%91%BC%E5%8F%ABapi">&#x547C;&#x53EB;API</h3>
<p>&#x7531;&#x65BC;&#x6211;&#x5011;&#x5EFA;&#x7ACB;&#x7684;&#x662F;HttpGet&#x65B9;&#x6CD5;&#xFF0C;&#x5728;&#x700F;&#x89BD;&#x5668;&#x7DB2;&#x5740;&#x5217;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x8F38;&#x5165;&#x7DB2;&#x5740;&#x547C;&#x53EB;API&#xFF0C;&#x5728;<code>MultimediaController</code>&#x8A2D;&#x5B9A;&#x7684;&#x8DEF;&#x7531;&#x662F;<code>/api/Multimedia/HLS/&lt;&#x5DF2;&#x8F49;&#x6A94;&#x5F8C;&#x7684;&#x6A94;&#x540D;&gt;</code>&#xFF0C;&#x4EE5;&#x6A94;&#x540D;&#x70BA;<code>vxvi0clz.4od</code>&#x7684;&#x6A94;&#x6848;&#x70BA;&#x4F8B;&#xFF0C;&#x525B;&#x525B;&#x5728;&#x8F49;&#x6A94;&#x7684;&#x6642;&#x5019;&#x6703;&#x8F49;&#x51FA;&#x4E00;&#x500B;<code>vxvi0clz.4od.m3u8</code>&#x6A94;&#x6848;&#x53CA;<code>vxvi0clz.4od0.ts</code>,<code>vxvi0clz.4od1.ts</code>...&#x7B49;&#x591A;&#x500B;ts&#x6A94;&#x6848;&#xFF0C;&#x5B58;&#x53D6;&#x6642;&#x547C;&#x53EB;<code>/api/Multimedia/HLS/vxvi0clz.4od.m3u8</code>&#x5373;&#x53EF;&#x53D6;&#x5F97;&#x6A94;&#x6848;&#x3002;</p>
<h6 id="%E5%8F%83%E8%80%83%E8%B3%87%E6%96%99">&#x53C3;&#x8003;&#x8CC7;&#x6599;</h6>
<ul>
<li><a href="https://www.twblogs.net/a/5c7f9ef7bd9eee35fc1345d5?ref=localhost">ASP.NET &#x4F7F;&#x7528;FFmpeg&#x5BE6;&#x73FE;MP4&#x8F49;&#x63DB;M3U8</a></li>
<li><a href="https://stackoverflow.com/questions/54398461/asp-net-core-2-0-not-serving-some-static-file-like-m3u8?ref=localhost">Asp.Net Core 2.0 not serving some static file like m3u8</a></li>
<li><a href="https://ithelp.ithome.com.tw/articles/10310697?ref=localhost">JS&#x7B46;&#x8A18;-&#x524D;&#x7AEF;&#x64A5;&#x653E;m3u8&#x7684;&#x5169;&#x7A2E;&#x65B9;&#x6CD5;</a></li>
</ul>
<!--kg-card-end: markdown-->]]></content:encoded></item><item><title><![CDATA[Promise in JavaScript]]></title><description><![CDATA[Promise是Javascript提供的建構函式，用於建構Promise物件，該物件會存放非同步事件的結果。]]></description><link>https://vincent87720.github.io/promise-in-javascript/</link><guid isPermaLink="false">64ed875555ef9900013f35f7</guid><category><![CDATA[JavaScript]]></category><dc:creator><![CDATA[Katsuobushi]]></dc:creator><pubDate>Tue, 29 Aug 2023 05:55:58 GMT</pubDate><media:content url="https://vincent87720.github.io/content/images/2023/08/javascript-2.png" medium="image"/><content:encoded><![CDATA[<img src="https://vincent87720.github.io/content/images/2023/08/javascript-2.png" alt="Promise in JavaScript"><p>Promise&#x662F;Javascript&#x63D0;&#x4F9B;&#x7684;&#x5EFA;&#x69CB;&#x51FD;&#x5F0F;&#xFF0C;&#x7528;&#x65BC;&#x5EFA;&#x69CB;Promise&#x7269;&#x4EF6;&#xFF0C;&#x8A72;&#x7269;&#x4EF6;&#x6703;&#x5B58;&#x653E;&#x975E;&#x540C;&#x6B65;&#x4E8B;&#x4EF6;&#x7684;&#x7D50;&#x679C;&#x3002;</p><h2 id="promise%E7%9A%84%E7%8B%80%E6%85%8B">Promise&#x7684;&#x72C0;&#x614B;</h2><p>Promise&#x5305;&#x542B;&#x4E09;&#x500B;&#x72C0;&#x614B;&#xFF0C;<code>pending</code>&#x3001;<code>fulfilled</code>&#x53CA;<code>rejected</code>&#xFF0C;&#x6BCF;&#x500B;Promise&#x7269;&#x4EF6;&#x50C5;&#x80FD;&#x4FDD;&#x5B58;&#x4E00;&#x7A2E;&#x72C0;&#x614B;&#xFF0C;&#x5728;&#x7D50;&#x679C;&#x5C1A;&#x672A;&#x51FA;&#x7210;&#x6642;&#x90FD;&#x662F;<code>pending</code>&#x72C0;&#x614B;&#xFF0C;&#x2CA;&#x4E00;&#x65E6;&#x8B8A;&#x70BA;<code>fulfilled</code>&#x6216;<code>rejected</code>&#x5176;&#x4E2D;&#x4E00;&#x500B;&#x4E4B;&#x5F8C;&#x4FBF;&#x7121;&#x6CD5;&#x518D;&#x66F4;&#x6539;&#x72C0;&#x614B;&#x3002;</p><h2 id="promise%E7%89%A9%E4%BB%B6%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E7%9A%84%E6%96%B9%E6%B3%95">Promise&#x7269;&#x4EF6;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x7684;&#x65B9;&#x6CD5;</h2><p>Promise&#x7269;&#x4EF6;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#x5305;&#x62EC;<code>then</code>&#x3001;<code>catch</code>&#x548C;<code>finally</code></p><h2 id="%E5%BB%BA%E7%AB%8Bpromise">&#x5EFA;&#x7ACB;Promise</h2><p>Promise&#x5728;&#x5EFA;&#x7ACB;&#x6642;&#x6703;&#x9700;&#x8981;&#x5E36;&#x5165;&#x4E00;&#x500B;&#x51FD;&#x5F0F;&#xFF0C;&#x51FD;&#x5F0F;&#x9700;&#x8981;&#x5E36;&#x5165;&#x5169;&#x500B;&#x53C3;&#x6578;&#xFF0C;&#x5206;&#x5225;&#x662F;<code>resolve</code>&#x548C;<code>reject</code></p><pre><code class="language-javascript">const p = new Promise(function(resolve, reject) { 
    if(...){
        resolve();//&#x7576;&#x4E8B;&#x4EF6;&#x5DF2;&#x7D93;&#x57F7;&#x884C;&#x5B8C;&#x7562;&#x4E14;&#x6210;&#x529F;&#x64CD;&#x4F5C;&#x6642;&#xFF0C;&#x547C;&#x53EB;&#x6B64;&#x51FD;&#x5F0F;
    }
    ...
	reject();//&#x7576;&#x4E8B;&#x4EF6;&#x5DF2;&#x7D93;&#x57F7;&#x884C;&#x5B8C;&#x7562;&#x4F46;&#x64CD;&#x4F5C;&#x5931;&#x6557;&#x6642;&#xFF0C;&#x547C;&#x53EB;&#x6B64;&#x51FD;&#x5F0F;
});
</code></pre><h2 id="%E8%AE%80%E5%8F%96promise">&#x8B80;&#x53D6;Promise</h2><h3 id="%E6%96%B9%E6%B3%95%E4%B8%80">&#x65B9;&#x6CD5;&#x4E00;</h3><p>&#x5728;then&#x4E2D;&#x50B3;&#x5165;&#x5169;&#x500B;callback function&#xFF0C;&#x5206;&#x5225;&#x63A5;&#x6536;&#x6210;&#x529F;&#x8207;&#x5931;&#x6557;&#x7684;&#x7D50;&#x679C;</p><pre><code class="language-javascript">p.then((success) =&gt; {
    console.log(success);
}, (fail) =&gt; {
    console.log(fail);
})
</code></pre><h3 id="%E6%96%B9%E6%B3%95%E4%BA%8C">&#x65B9;&#x6CD5;&#x4E8C;</h3><p>&#x4F7F;&#x7528;then&#x53D6;&#x5F97;&#x6210;&#x529F;&#x7684;&#x7D50;&#x679C;&#xFF0C;&#x4F7F;&#x7528;catch&#x53D6;&#x5F97;&#x5931;&#x6557;&#x7684;&#x7D50;&#x679C;&#xFF0C;&#x5927;&#x90E8;&#x5206;&#x958B;&#x767C;&#x8005;&#x7FD2;&#x6163;&#x4F7F;&#x7528;&#x6B64;&#x7A2E;&#x65B9;&#x5F0F;&#x8655;&#x7406;&#x7D50;&#x679C;</p><pre><code class="language-javascript">p.then(success =&gt; {
    console.log(success);
})
// &#x5931;&#x6557;&#x7684;&#x884C;&#x70BA;&#x4E00;&#x5F8B;&#x4EA4;&#x7D66;&#x4E86; catch
.catch(fail =&gt; {
    console.log(fail);
});
</code></pre><h2 id="%E9%8F%88">&#x93C8;</h2><p>Promise&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x93C8;&#x7684;&#x6A5F;&#x5236;&#x4E32;&#x9023;&#x591A;&#x500B;Promise&#xFF0C;&#x6B64;&#x65B9;&#x6CD5;&#x53EF;&#x4EE5;&#x6709;&#x6548;&#x907F;&#x514D;Callback Hell</p><pre><code class="language-javascript">p.then(success =&gt; {
        ...
    })
    .then(success =&gt; {
        ...
    })
    .then(success =&gt; {
        ...
    })
    .catch(fail =&gt; {
        ...
        console.log(fail);
    })
</code></pre><h2 id="promise%E7%9A%84%E9%9D%9C%E6%85%8B%E6%96%B9%E6%B3%95">Promise&#x7684;&#x975C;&#x614B;&#x65B9;&#x6CD5;</h2><h3 id="promiseall">Promise.all</h3><p>Promise.all&#x53EF;&#x4EE5;&#x50B3;&#x5165;&#x591A;&#x500B;promise&#x505A;&#x70BA;&#x53C3;&#x6578;&#xFF0C;&#x9019;&#x500B;&#x65B9;&#x6CD5;&#x6703;&#x7B49;&#x5F85;&#x6240;&#x6709;promise&#x90FD;&#x88AB;&#x5B8C;&#x6210;&#x5F8C;&#x624D;&#x7E7C;&#x7E8C;&#x57F7;&#x884C;&#x3002;<br>&#x5728;&#x5BE6;&#x4F5C;&#x67D0;&#x529F;&#x80FD;&#x9700;&#x8981;&#x591A;&#x500B;API&#x7684;&#x8CC7;&#x6599;&#x90FD;&#x62FF;&#x5230;&#x624D;&#x80FD;&#x57F7;&#x884C;&#x6642;&#x5F88;&#x5BE6;&#x7528;&#x3002;</p><pre><code class="language-javascript">Promise.all([promise(test1), promise(test2), promise(test3)])
.then(res =&gt; {
    console.log(res);
});
</code></pre><h3 id="promiserace">Promise.race</h3><p>Promise.race&#x53EF;&#x4EE5;&#x50B3;&#x5165;&#x591A;&#x500B;promise&#x4F5C;&#x70BA;&#x53C3;&#x6578;&#xFF0C;&#x6B64;&#x65B9;&#x6CD5;&#x53EA;&#x6703;&#x56DE;&#x50B3;&#x7B2C;&#x4E00;&#x500B;&#x57F7;&#x884C;&#x5B8C;&#x6210;&#x7684;promise</p><h6 id="%E5%8F%83%E8%80%83%E8%B3%87%E6%96%99">&#x53C3;&#x8003;&#x8CC7;&#x6599;</h6><ul><li><a href="https://israynotarray.com/javascript/20211128/2950137358/?ref=localhost">JavaScript &#x4E2D;&#x7684; Promise &#x662F;&#x4EC0;&#x9EBC;&#xFF1F;&#x4EE5;&#x53CA;&#x70BA;&#x4EC0;&#x9EBC;&#x4F60;&#x8981;&#x61C2; Promise</a></li><li><a href="https://www.casper.tw/development/2020/02/16/all-new-promise/?ref=localhost">JavaScript Promise &#x5168;&#x4ECB;&#x7D39;</a></li><li><a href="https://hackmd.io/@Heidi-Liu/note-fetch-and-promise?ref=localhost">[week 13] Fetch &amp; Promise &#x88DC;&#x5145;</a></li></ul>]]></content:encoded></item><item><title><![CDATA[Validation attributes in ASP.NET Core]]></title><description><![CDATA[ASP.NET Core 裡的 Validation attributes 用於設定欄位的規則，當收到 HTTP 請求時依照規則檢查請求的資料是否符合 Validation attributes 設定的規則，以此過濾掉不符合規則的請求。]]></description><link>https://vincent87720.github.io/validation-attributes-in-asp-net-core/</link><guid isPermaLink="false">64ea48dd4feca3000178b923</guid><category><![CDATA[ASP.NET Core]]></category><category><![CDATA[C#]]></category><dc:creator><![CDATA[Katsuobushi]]></dc:creator><pubDate>Sat, 26 Aug 2023 18:51:08 GMT</pubDate><media:content url="https://vincent87720.github.io/content/images/2023/08/jason-dent-3wPJxh-piRw-unsplash-1.jpg" medium="image"/><content:encoded><![CDATA[<!--kg-card-begin: markdown--><img src="https://vincent87720.github.io/content/images/2023/08/jason-dent-3wPJxh-piRw-unsplash-1.jpg" alt="Validation attributes in ASP.NET Core"><p>ASP.NET Core &#x88E1;&#x7684; Validation attributes &#x7528;&#x65BC;&#x8A2D;&#x5B9A;&#x6B04;&#x4F4D;&#x7684;&#x898F;&#x5247;&#xFF0C;&#x7576;&#x6536;&#x5230; HTTP &#x8ACB;&#x6C42;&#x6642;&#x4F9D;&#x7167;&#x898F;&#x5247;&#x6AA2;&#x67E5;&#x8ACB;&#x6C42;&#x7684;&#x8CC7;&#x6599;&#x662F;&#x5426;&#x7B26;&#x5408; Validation attributes &#x8A2D;&#x5B9A;&#x7684;&#x898F;&#x5247;&#xFF0C;&#x4EE5;&#x6B64;&#x904E;&#x6FFE;&#x6389;&#x4E0D;&#x7B26;&#x5408;&#x898F;&#x5247;&#x7684;&#x8ACB;&#x6C42;&#x3002;</p>
<h2 id="%E8%87%AA%E5%8B%95%E5%9B%9E%E8%A6%86%E9%8C%AF%E8%AA%A4%E8%A8%8A%E6%81%AF">&#x81EA;&#x52D5;&#x56DE;&#x8986;&#x932F;&#x8AA4;&#x8A0A;&#x606F;</h2>
<p>&#x5728; Web API controllers &#x4E2D;&#x52A0;&#x5165;<code>[ApiController]</code>&#x5C6C;&#x6027;&#x53EF;&#x4EE5;&#x8B93;&#x6211;&#x5011;&#x514D;&#x53BB;&#x8A2D;&#x5B9A;<code>ModelState.IsValid</code>&#x7684;&#x6B65;&#x9A5F;</p>
<pre><code class="language-csharp">using Microsoft.AspNetCore.Mvc;

namespace todoAPP.Controllers
{
    [ApiController]
    public class TodoListController : Controller
    {
        ...
    }
}
</code></pre>
<h2 id="%E5%85%A7%E5%BB%BA%E7%9A%84validation-attributes">&#x5167;&#x5EFA;&#x7684;Validation attributes</h2>
<p><code>[ValidateNever]</code>&#xFF1A;&#x4E0D;&#x9A57;&#x8B49;&#x8A72;&#x985E;&#x5225;&#x5C6C;&#x6027;<br>
<code>[CreditCard]</code>&#xFF1A;&#x9A57;&#x8B49;&#x662F;&#x5426;&#x7B26;&#x5408;&#x4FE1;&#x7528;&#x5361;&#x5361;&#x865F;&#x898F;&#x5247;<br>
<code>[Compare]</code>&#xFF1A;&#x9A57;&#x8B49;&#x5169;&#x500B;&#x6B04;&#x4F4D;&#x662F;&#x5426;&#x76F8;&#x7B26;</p>
<pre><code class="language-csharp">using System.ComponentModel.DataAnnotations;

public class RegisterRequestModel
{
    public string Password { get; set; }

    //&#x8207;Password&#x6B04;&#x4F4D;&#x6BD4;&#x5C0D;&#xFF0C;&#x82E5;&#x4E0D;&#x76F8;&#x7B26;&#x5247;&#x56DE;&#x8986;&#x932F;&#x8AA4;
    [Compare(&quot;Password&quot;)]
    public string ConfirmPassword { get; set; }
}
</code></pre>
<p><code>[EmailAddress]</code>&#xFF1A;&#x9A57;&#x8B49;&#x662F;&#x5426;&#x7B26;&#x5408;E-mail&#x683C;&#x5F0F;<br>
<code>[Phone]</code>&#xFF1A;&#x9A57;&#x8B49;&#x662F;&#x5426;&#x7B26;&#x5408;&#x96FB;&#x8A71;&#x865F;&#x78BC;&#x683C;&#x5F0F;<br>
<code>[Range]</code>: &#x9A57;&#x8B49;&#x662F;&#x5426;&#x5728;&#x6578;&#x503C;&#x5340;&#x9593;&#x5167;<br>
<code>[RegularExpression]</code>: &#x9A57;&#x8B49;&#x662F;&#x5426;&#x7B26;&#x5408;&#x6B63;&#x898F;&#x8868;&#x9054;&#x5F0F;<br>
<code>[Required]</code>: &#x9A57;&#x8B49;&#x6B04;&#x4F4D;&#x6709;&#x503C;&#x4E14;&#x4E0D;&#x662F;null<br>
<code>[StringLength]</code>: &#x9A57;&#x8B49;&#x5B57;&#x4E32;&#x9577;&#x5EA6;&#x4E0D;&#x8D85;&#x904E;&#x6307;&#x5B9A;&#x5B57;&#x6578;<br>
<code>[MaxLength]</code>&#xFF1A;&#x9A57;&#x8B49;&#x5B57;&#x4E32;&#x9577;&#x5EA6;&#x4E0D;&#x53EF;&#x8D85;&#x904E;&#x6307;&#x5B9A;&#x5B57;&#x6578;</p>
<pre><code class="language-csharp">using System.ComponentModel.DataAnnotations;

public class RegisterRequestModel
{
    [MaxLength(50)]
    public string Username { get; set; }
}
</code></pre>
<p><code>[Url]</code>: &#x9A57;&#x8B49;&#x662F;&#x5426;&#x7B26;&#x5408;URL&#x683C;&#x5F0F;<br>
<code>[Remote]</code>: &#x5F9E;client&#x547C;&#x53EB;server&#x7684;&#x65B9;&#x6CD5;&#x9A57;&#x8B49;&#x4F7F;&#x7528;&#x8005;&#x8F38;&#x5165;</p>
<p>&#x66F4;&#x591A;&#x9A57;&#x8B49;&#x5C6C;&#x6027;&#x8ACB;&#x53C3;&#x8003;&#x5FAE;&#x8EDF;&#x7684;<a href="https://learn.microsoft.com/en-us/dotnet/api/system.componentmodel.dataannotations?view=net-6.0&amp;ref=localhost">DataAnnotations</a></p>
<h6 id="%E5%8F%83%E8%80%83%E8%B3%87%E6%96%99">&#x53C3;&#x8003;&#x8CC7;&#x6599;</h6>
<ul>
<li><a href="https://learn.microsoft.com/en-us/aspnet/core/mvc/models/validation?view=aspnetcore-6.0&amp;ref=localhost">Model validation in ASP.NET Core MVC and Razor Pages</a></li>
<li><a href="https://learn.microsoft.com/en-us/aspnet/core/web-api/?view=aspnetcore-6.0&amp;ref=localhost#apicontroller-attribute-1">ApiController attribute</a></li>
<li><a href="https://learn.microsoft.com/en-us/dotnet/api/system.componentmodel.dataannotations?view=net-6.0&amp;ref=localhost">System.ComponentModel.DataAnnotations Namespace</a></li>
</ul>
<!--kg-card-end: markdown-->]]></content:encoded></item><item><title><![CDATA[Model Binding in ASP.NET Core]]></title><description><![CDATA[Controller會處理來自用戶端的HTTP Request，請求中會有一些資訊來往，這些資料會需要經過型別轉換、檢查必填、最大長度及正確性等步驟後我們才能使用，若手動處理這些步驟將會非常繁瑣。
ASP.NET提供Model Binding的功能，可以處理來自使用者請求中的資料，將其綁定到指定型態的資料上，省去繁複的處理程序並提高正確性。]]></description><link>https://vincent87720.github.io/model-binding-in-asp-net-core/</link><guid isPermaLink="false">64e7a2daf1c6660001711fd6</guid><category><![CDATA[ASP.NET Core]]></category><category><![CDATA[C#]]></category><dc:creator><![CDATA[Katsuobushi]]></dc:creator><pubDate>Thu, 24 Aug 2023 18:38:03 GMT</pubDate><media:content url="https://vincent87720.github.io/content/images/2023/08/vs2012_gray_imprint.png" medium="image"/><content:encoded><![CDATA[<!--kg-card-begin: markdown--><img src="https://vincent87720.github.io/content/images/2023/08/vs2012_gray_imprint.png" alt="Model Binding in ASP.NET Core"><p>Controller&#x6703;&#x8655;&#x7406;&#x4F86;&#x81EA;&#x7528;&#x6236;&#x7AEF;&#x7684;HTTP Request&#xFF0C;&#x8ACB;&#x6C42;&#x4E2D;&#x6703;&#x6709;&#x4E00;&#x4E9B;&#x8CC7;&#x8A0A;&#x4F86;&#x5F80;&#xFF0C;&#x9019;&#x4E9B;&#x8CC7;&#x6599;&#x6703;&#x9700;&#x8981;&#x7D93;&#x904E;&#x578B;&#x5225;&#x8F49;&#x63DB;&#x3001;&#x6AA2;&#x67E5;&#x5FC5;&#x586B;&#x3001;&#x6700;&#x5927;&#x9577;&#x5EA6;&#x53CA;&#x6B63;&#x78BA;&#x6027;&#x7B49;&#x6B65;&#x9A5F;&#x5F8C;&#x6211;&#x5011;&#x624D;&#x80FD;&#x4F7F;&#x7528;&#xFF0C;&#x82E5;&#x624B;&#x52D5;&#x8655;&#x7406;&#x9019;&#x4E9B;&#x6B65;&#x9A5F;&#x5C07;&#x6703;&#x975E;&#x5E38;&#x7E41;&#x7463;&#x3002;<br>
ASP.NET&#x63D0;&#x4F9B;Model Binding&#x7684;&#x529F;&#x80FD;&#xFF0C;&#x53EF;&#x4EE5;&#x8655;&#x7406;&#x4F86;&#x81EA;&#x4F7F;&#x7528;&#x8005;&#x8ACB;&#x6C42;&#x4E2D;&#x7684;&#x8CC7;&#x6599;&#xFF0C;&#x5C07;&#x5176;&#x7D81;&#x5B9A;&#x5230;&#x6307;&#x5B9A;&#x578B;&#x614B;&#x7684;&#x8CC7;&#x6599;&#x4E0A;&#xFF0C;&#x7701;&#x53BB;&#x7E41;&#x8907;&#x7684;&#x8655;&#x7406;&#x7A0B;&#x5E8F;&#x4E26;&#x63D0;&#x9AD8;&#x6B63;&#x78BA;&#x6027;&#x3002;</p>
<p>Model Binding&#x53EF;&#x4EE5;&#x5C07;HTTP requests&#x7684;&#x8CC7;&#x6599;&#x8F49;&#x70BA;&#x6307;&#x5B9A;&#x7684;&#x8CC7;&#x6599;&#x578B;&#x614B;</p>
<ul>
<li>&#x8F49;&#x63DB;&#x591A;&#x500B;&#x4F86;&#x6E90;&#x7684;&#x8CC7;&#x6599;&#xFF0C;&#x4F8B;&#x5982;route data&#x3001;form fields&#x6216;query strings&#x7B49;</li>
<li>&#x5C07;&#x5B57;&#x4E32;&#x8F49;&#x70BA;.NET&#x7684;&#x985E;&#x5225;</li>
</ul>
<h2 id="apicontroller%E5%B1%AC%E6%80%A7">ApiController&#x5C6C;&#x6027;</h2>
<p>&#x5728;&#x958B;&#x59CB;&#x4ECB;&#x7D39;&#x7D81;&#x5B9A;&#x524D;&#x5148;&#x4ECB;&#x7D39;ApiController&#x9019;&#x500B;&#x5C6C;&#x6027;</p>
<p>&#x82E5;&#x5728;Controller&#x4E2D;&#x5957;&#x7528;[ApiController]&#x9019;&#x500B;&#x5C6C;&#x6027;&#x5F8C;&#x6703;&#x5E36;&#x4F86;&#x4EE5;&#x4E0B;&#x5F71;&#x97FF;&#xFF0C;&#x5176;&#x4E2D;&#x6709;&#x4E00;&#x500B;&#x8207;&#x7D81;&#x5B9A;&#x6709;&#x95DC;</p>
<ul>
<li>&#x5FC5;&#x9808;&#x8981;&#x4F7F;&#x7528;&#x5C6C;&#x6027;&#x8DEF;&#x7531;(Attribute Routing)</li>
<li>&#x81EA;&#x52D5;&#x56DE;&#x61C9;HTTP 400</li>
<li>&#x81EA;&#x52D5;&#x5957;&#x7528;Model Binding&#x7684;&#x9810;&#x8A2D;&#x898F;&#x5247;&#xFF0C;&#x9810;&#x8A2D;&#x898F;&#x5247;&#x5305;&#x542B;&#xFF1A;
<ul>
<li>&#x82E5;HTTP&#x662F;Request&#x8907;&#x96DC;&#x6A21;&#x578B;&#xFF0C;&#x5247;&#x9810;&#x8A2D;&#x6703;&#x81EA;&#x52D5;&#x5957;&#x7528;[FromBody]&#x5C6C;&#x6027;</li>
<li>&#x82E5;HTTP&#x662F;Request&#x7C21;&#x55AE;&#x6A21;&#x578B;&#xFF0C;&#x5247;&#x9810;&#x8A2D;&#x6703;&#x81EA;&#x52D5;&#x5957;&#x7528;[FromQuery]&#x5C6C;&#x6027;</li>
<li>&#x82E5;&#x53C3;&#x6578;&#x5305;&#x542B;IFormFile&#x6216;IFormFileCollection&#x6703;&#x81EA;&#x52D5;&#x63A8;&#x65B7;content-type&#x70BA;<code>multipart/form-data</code>&#xFF0C;&#x4E26;&#x81EA;&#x52D5;&#x5957;&#x7528;[FromForm]&#x5C6C;&#x6027;</li>
</ul>
</li>
</ul>
<h2 id="%E9%A0%90%E8%A8%AD%E7%B6%81%E5%AE%9A%E4%BE%86%E6%BA%90%E5%8F%8A%E9%A0%86%E5%BA%8F">&#x9810;&#x8A2D;&#x7D81;&#x5B9A;&#x4F86;&#x6E90;&#x53CA;&#x9806;&#x5E8F;</h2>
<ol>
<li>Form fields</li>
<li>Request body</li>
<li>Route data</li>
<li>Query string parameters</li>
<li>Uploaded files&#xFF08;&#x50C5;&#x6703;&#x7D81;&#x5B9A;&#x5230;IFormFile&#x6216;IEnumerable&lt;IFormFile&gt;&#x985E;&#x5225;&#x7684;&#x5BE6;&#x9AD4;&#xFF09;</li>
</ol>
<h2 id="%E6%8C%87%E5%AE%9A%E7%B6%81%E5%AE%9A%E4%BE%86%E6%BA%90">&#x6307;&#x5B9A;&#x7D81;&#x5B9A;&#x4F86;&#x6E90;</h2>
<ul>
<li>[FromBody]&#xFF1A;Requet body&#x53D6;&#x503C;&#x4E26;&#x5957;&#x7528;&#x5728;&#x8907;&#x96DC;&#x6A21;&#x578B;&#x4E0A;</li>
<li>[FromRoute]&#xFF1A;&#x5F9E;&#x8DEF;&#x7531;&#x8CC7;&#x6599;&#x53D6;&#x503C;</li>
<li>[FromQuery]&#xFF1A;&#x5F9E;Query string&#x4E2D;&#x53D6;&#x503C;</li>
<li>[FromHeader]&#xFF1A;&#x5F9E;HTTP&#x6A19;&#x982D;&#x53D6;&#x5F97;&#x503C;</li>
<li>[FromForm]&#xFF1A;&#x5F9E;Request body&#x53D6;&#x503C;&#xFF0C;&#x53EA;&#x6703;&#x5957;&#x7528;&#x5728;IFormFile &#x6216; IFormFileCollection &#x4E0A;</li>
</ul>
<h2 id="%E7%B6%81%E5%AE%9A%E6%96%B9%E5%BC%8F">&#x7D81;&#x5B9A;&#x65B9;&#x5F0F;</h2>
<h3 id="%E7%B6%81%E5%AE%9A%E8%87%B3%E5%8F%83%E6%95%B8">&#x7D81;&#x5B9A;&#x81F3;&#x53C3;&#x6578;</h3>
<pre><code class="language-csharp">public Task&lt;IActionResult&gt; Create([FromBody]CreateTodoRequestModel request)
</code></pre>
<pre><code class="language-csharp">public class CreateTodoRequestModel
{
    public string Text { get; set; }
}
</code></pre>
<h3 id="%E7%B6%81%E5%AE%9A%E8%87%B3%E9%A1%9E%E5%88%A5%E5%B1%AC%E6%80%A7">&#x7D81;&#x5B9A;&#x81F3;&#x985E;&#x5225;&#x5C6C;&#x6027;</h3>
<pre><code class="language-csharp">public Task&lt;IActionResult&gt; Create(CreateTodoRequestModel request)
</code></pre>
<pre><code class="language-csharp">public class CreateTodoRequestModel
{
    [FromBody]
    public string Text { get; set; }
}
</code></pre>
<h6 id="%E5%8F%83%E8%80%83%E8%B3%87%E6%96%99">&#x53C3;&#x8003;&#x8CC7;&#x6599;</h6>
<ul>
<li><a href="https://learn.microsoft.com/zh-tw/aspnet/core/mvc/models/model-binding?view=aspnetcore-3.1&amp;ref=localhost">ASP.NET Core &#x4E2D;&#x7684;&#x8CC7;&#x6599;&#x7E6B;&#x7D50;</a></li>
<li><a href="https://ithelp.ithome.com.tw/articles/10244545?ref=localhost">[Day12] &#x6A21;&#x578B;&#x7E6B;&#x7D50;&#x8207;&#x9A57;&#x8B49; - &#x6211;&#x8207; ASP.NET Core 3 &#x7684; 30&#x5929;</a></li>
<li><a href="https://www.gss.com.tw/blog/asp-net-core-model-binding-1?ref=localhost">ASP.NET Core Model Binding &#x6B7B;&#x6D3B;&#x7D81;&#x4E0D;&#x4E0A; - 1</a></li>
<li><a href="https://learn.microsoft.com/zh-tw/aspnet/core/web-api/?view=aspnetcore-3.1&amp;ref=localhost#apicontroller-attribute-2">ApiController &#x5C6C;&#x6027;</a></li>
</ul>
<!--kg-card-end: markdown-->]]></content:encoded></item><item><title><![CDATA[HTTP header Content-Disposition]]></title><description><![CDATA[Content-Disposition包含兩種類型，分別是inline 和 attachment，用於指定下載的行為]]></description><link>https://vincent87720.github.io/http-header-content-disposition/</link><guid isPermaLink="false">64de4be0f1c6660001711fc3</guid><category><![CDATA[HTTP]]></category><category><![CDATA[network]]></category><dc:creator><![CDATA[Katsuobushi]]></dc:creator><pubDate>Thu, 17 Aug 2023 16:37:55 GMT</pubDate><media:content url="https://vincent87720.github.io/content/images/2023/08/communication-4871245.jpg" medium="image"/><content:encoded><![CDATA[<!--kg-card-begin: markdown--><img src="https://vincent87720.github.io/content/images/2023/08/communication-4871245.jpg" alt="HTTP header Content-Disposition"><p>Content-Disposition&#x5305;&#x542B;&#x5169;&#x7A2E;&#x985E;&#x578B;&#xFF0C;&#x5206;&#x5225;&#x662F;inline &#x548C; attachment&#xFF0C;&#x7528;&#x65BC;&#x6307;&#x5B9A;&#x4E0B;&#x8F09;&#x7684;&#x884C;&#x70BA;</p>
<h3 id="inline">inline</h3>
<p>&#x4F7F;&#x7528;inline&#x6703;&#x76F4;&#x63A5;&#x5C07;&#x6A94;&#x6848;&#x986F;&#x793A;&#x5728;&#x700F;&#x89BD;&#x5668;&#x4E2D;&#xFF0C;&#x9810;&#x8A2D;&#x884C;&#x70BA;&#x4E5F;&#x662F;inline</p>
<pre><code>Content-Disposition: inline
</code></pre>
<h3 id="attachment">attachment</h3>
<p>&#x82E5;&#x5C07;Content-Disposition&#x8A2D;&#x70BA;attachment&#x6703;&#x5F48;&#x51FA;&#x8996;&#x7A97;&#x8B93;&#x4F7F;&#x7528;&#x8005;&#x4E0B;&#x8F09;&#x6A94;&#x6848;</p>
<p>Content-Disposition&#x9664;&#x4E86;&#x6307;&#x5B9A;&#x986F;&#x793A;&#x884C;&#x70BA;&#x5916;&#xFF0C;&#x9084;&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x9810;&#x8A2D;&#x4E0B;&#x8F09;&#x540D;&#x7A31;&#xFF0C;&#x4F7F;&#x7528;filename&#x53EF;&#x4EE5;&#x6307;&#x5B9A;&#x6A94;&#x6848;&#x540D;&#x7A31;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;</p>
<pre><code>Content-Disposition: attachment; filename=test.zip
</code></pre>
<p>&#x4F7F;&#x7528;&#x6B64;Header&#x4FBF;&#x53EF;&#x4EE5;&#x8B93;&#x4F7F;&#x7528;&#x8005;&#x7AEF;&#x8DF3;&#x51FA;&#x53E6;&#x5B58;&#x8996;&#x7A97;&#xFF0C;&#x4E26;&#x5728;&#x9810;&#x8A2D;&#x6A94;&#x540D;&#x4E2D;&#x986F;&#x793A;filename&#x7684;&#x5B57;&#x4E32;</p>
<h6 id="%E5%8F%83%E8%80%83%E8%B3%87%E6%96%99">&#x53C3;&#x8003;&#x8CC7;&#x6599;</h6>
<ul>
<li><a href="https://www.cnblogs.com/Lambquan/p/12980088.html?ref=localhost">header&#x4E2D;Content-Disposition&#x7684;&#x4F5C;&#x7528;&#x4E0E;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;</a></li>
<li><a href="https://ithelp.ithome.com.tw/articles/10186863?ref=localhost">Day20-&#x5167;&#x5BB9;&#x8981;&#x5982;&#x4F55;&#x8655;&#x7F6E;-Content-Disposition</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition?ref=localhost">Content-Disposition</a></li>
</ul>
<!--kg-card-end: markdown-->]]></content:encoded></item><item><title><![CDATA[依賴注入 Dependency injection]]></title><description><![CDATA[在高階模組中直接針對低階模組進行實作會產生高耦合，高度依賴低階模組，當想抽換低階模組、低階模組常常變動或是低階模組的設計改變時，會影響到高階模組。應統一由控制反轉中心建立物件，將物件送到高階模組內進行使用]]></description><link>https://vincent87720.github.io/aspnet-core-dependency-injection/</link><guid isPermaLink="false">64dbb5f35f1c820001e0a416</guid><category><![CDATA[ASP.NET Core]]></category><category><![CDATA[C#]]></category><category><![CDATA[Pattern]]></category><dc:creator><![CDATA[Katsuobushi]]></dc:creator><pubDate>Tue, 15 Aug 2023 17:32:39 GMT</pubDate><media:content url="https://vincent87720.github.io/content/images/2023/08/shapelined-_JBKdviweXI-unsplash.jpg" medium="image"/><content:encoded><![CDATA[<!--kg-card-begin: markdown--><h2 id="%E4%BE%9D%E8%B3%B4%E6%B3%A8%E5%85%A5">&#x4F9D;&#x8CF4;&#x6CE8;&#x5165;</h2>
<h3 id="%E7%82%BA%E4%BB%80%E9%BA%BC%E8%A6%81%E4%BD%BF%E7%94%A8%E6%B3%A8%E5%85%A5">&#x70BA;&#x4EC0;&#x9EBC;&#x8981;&#x4F7F;&#x7528;&#x6CE8;&#x5165;</h3>
<img src="https://vincent87720.github.io/content/images/2023/08/shapelined-_JBKdviweXI-unsplash.jpg" alt="&#x4F9D;&#x8CF4;&#x6CE8;&#x5165; Dependency injection"><p>&#x70BA;&#x4E86;&#x628A;&#x4F4E;&#x968E;&#x6A21;&#x7D44;&#x9001;&#x5230;&#x9AD8;&#x968E;&#x6A21;&#x7D44;&#x7684;&#x5167;&#x4F7F;&#x7528;</p>
<h3 id="%E7%82%BA%E4%BB%80%E9%BA%BC%E8%A6%81%E6%8A%8A%E4%BD%8E%E9%9A%8E%E6%A8%A1%E7%B5%84%E5%BE%80%E9%AB%98%E9%9A%8E%E6%A8%A1%E7%B5%84%E9%80%81">&#x70BA;&#x4EC0;&#x9EBC;&#x8981;&#x628A;&#x4F4E;&#x968E;&#x6A21;&#x7D44;&#x5F80;&#x9AD8;&#x968E;&#x6A21;&#x7D44;&#x9001;</h3>
<p>&#x70BA;&#x4E86;&#x4E0D;&#x76F4;&#x63A5;&#x5728;&#x9AD8;&#x968E;&#x6A21;&#x7D44;&#x5167;&#x5EFA;&#x7ACB;&#x4F4E;&#x968E;&#x6A21;&#x7D44;&#x7269;&#x4EF6;</p>
<h3 id="%E7%82%BA%E4%BB%80%E9%BA%BC%E4%B8%8D%E7%9B%B4%E6%8E%A5%E5%9C%A8%E9%AB%98%E9%9A%8E%E6%A8%A1%E7%B5%84%E4%B8%AD%E5%BB%BA%E7%AB%8B%E7%89%A9%E4%BB%B6">&#x70BA;&#x4EC0;&#x9EBC;&#x4E0D;&#x76F4;&#x63A5;&#x5728;&#x9AD8;&#x968E;&#x6A21;&#x7D44;&#x4E2D;&#x5EFA;&#x7ACB;&#x7269;&#x4EF6;</h3>
<p>&#x5728;&#x9AD8;&#x968E;&#x6A21;&#x7D44;&#x4E2D;&#x76F4;&#x63A5;&#x91DD;&#x5C0D;&#x4F4E;&#x968E;&#x6A21;&#x7D44;&#x9032;&#x884C;&#x5BE6;&#x4F5C;&#x6703;&#x7522;&#x751F;&#x9AD8;&#x8026;&#x5408;&#xFF0C;&#x9AD8;&#x5EA6;&#x4F9D;&#x8CF4;&#x4F4E;&#x968E;&#x6A21;&#x7D44;&#xFF0C;&#x7576;&#x60F3;&#x62BD;&#x63DB;&#x4F4E;&#x968E;&#x6A21;&#x7D44;&#x3001;&#x4F4E;&#x968E;&#x6A21;&#x7D44;&#x5E38;&#x5E38;&#x8B8A;&#x52D5;&#x6216;&#x662F;&#x4F4E;&#x968E;&#x6A21;&#x7D44;&#x7684;&#x8A2D;&#x8A08;&#x6539;&#x8B8A;&#x6642;&#xFF0C;&#x6703;&#x5F71;&#x97FF;&#x5230;&#x9AD8;&#x968E;&#x6A21;&#x7D44;&#x3002;&#x61C9;&#x7D71;&#x4E00;&#x7531;&#x63A7;&#x5236;&#x53CD;&#x8F49;&#x4E2D;&#x5FC3;&#x5EFA;&#x7ACB;&#x7269;&#x4EF6;&#xFF0C;&#x5C07;&#x7269;&#x4EF6;&#x9001;&#x5230;&#x9AD8;&#x968E;&#x6A21;&#x7D44;&#x5167;&#x9032;&#x884C;&#x4F7F;&#x7528;</p>
<h3 id="%E7%82%BA%E4%BB%80%E9%BA%BC%E6%98%AF%E9%AB%98%E9%9A%8E%E6%A8%A1%E7%B5%84%E5%AE%9A%E7%BE%A9%E9%9C%80%E6%B1%82%E6%94%BE%E5%9C%A8interface%E5%85%A7">&#x70BA;&#x4EC0;&#x9EBC;&#x662F;&#x9AD8;&#x968E;&#x6A21;&#x7D44;&#x5B9A;&#x7FA9;&#x9700;&#x6C42;&#x653E;&#x5728;Interface&#x5167;</h3>
<p>&#x9AD8;&#x968E;&#x6A21;&#x7D44;&#x4F9D;&#x8CF4;&#x4F4E;&#x968E;&#x6A21;&#x7D44;&#xFF0C;&#x7576;&#x4F4E;&#x968E;&#x6A21;&#x7D44;&#x7570;&#x52D5;&#x6642;&#x9AD8;&#x968E;&#x6A21;&#x7D44;&#x6703;&#x53D7;&#x5F71;&#x97FF;&#xFF0C;&#x9AD8;&#x968E;&#x6A21;&#x7D44;&#x76F8;&#x5C0D;&#x5F31;&#x52E2;&#xFF0C;&#x6545;&#x4F7F;&#x7528;&#x9AD8;&#x968E;&#x6A21;&#x7D44;&#x7684;&#x9700;&#x6C42;&#x5B9A;&#x7FA9;&#x4ECB;&#x9762;&#x7684;&#x5167;&#x5BB9;&#x3002;<br>
&#x53E6;&#x5916;&#x4EE5;&#x5E38;&#x7406;&#x4F86;&#x770B;&#xFF0C;&#x5047;&#x8A2D;&#x6211;&#x5011;&#x5EFA;&#x7ACB;&#x4E00;&#x500B;&#x700F;&#x89BD;&#x6E05;&#x55AE;&#x670D;&#x52D9;&#xFF0C;&#x6703;&#x9700;&#x8981;&#x7528;&#x5230;&#x767B;&#x5165;&#x529F;&#x80FD;&#x53CA;&#x5217;&#x8868;&#x529F;&#x80FD;&#xFF0C;&#x6211;&#x5011;&#x662F;&#x5148;&#x77E5;&#x9053;&#x6211;&#x5011;&#x8981;&#x4EC0;&#x9EBC;&#x529F;&#x80FD;&#xFF0C;&#x5B9A;&#x7FA9;&#x597D;&#x4ECB;&#x9762;&#x5F8C;&#x518D;&#x7531;&#x4F4E;&#x968E;&#x6A21;&#x7D44;&#x5BE6;&#x4F5C;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5BE6;&#x4F5C;&#x597D;&#x767B;&#x5165;&#x529F;&#x80FD;&#x53CA;&#x5217;&#x8868;&#x529F;&#x80FD;&#x7B49;&#x4F4E;&#x968E;&#x6A21;&#x7D44;&#x5F8C;&#xFF0C;&#x6211;&#x5011;&#x624D;&#x60F3;&#x8AAA;&#x4F86;&#x5EFA;&#x7ACB;&#x4E00;&#x500B;&#x700F;&#x89BD;&#x6E05;&#x55AE;&#x670D;&#x52D9;&#x3002;<br>
&#x5F9E;&#x4E0D;&#x540C;&#x89D2;&#x5EA6;&#x4F86;&#x770B;&#x90FD;&#x61C9;&#x8A72;&#x7531;&#x9AD8;&#x968E;&#x6A21;&#x7D44;&#x5B9A;&#x7FA9;&#x4ECB;&#x9762;&#x5167;&#x7684;&#x65B9;&#x6CD5;&#x3002;</p>
<h2 id="%E6%8E%A7%E5%88%B6%E5%8F%8D%E8%BD%89%E5%8F%8A%E4%BE%9D%E8%B3%B4%E6%B3%A8%E5%85%A5">&#x63A7;&#x5236;&#x53CD;&#x8F49;&#x53CA;&#x4F9D;&#x8CF4;&#x6CE8;&#x5165;</h2>
<p>&#x4EE5;&#x98F2;&#x6599;&#x5E97;&#x4F86;&#x8209;&#x4F8B;&#xFF0C;&#x5047;&#x8A2D;&#x6211;&#x4ECA;&#x5929;&#x958B;&#x4E86;&#x4E00;&#x9593;&#x683C;&#x96F7;&#x4F2F;&#x7235;&#x5976;&#x8336;&#x5C08;&#x8CE3;&#x5E97;&#xFF0C;&#x6211;&#x5411;&#x98DF;&#x54C1;&#x6750;&#x6599;&#x884C;&#x9032;&#x8CA8;&#x8336;&#x8449;</p>
<pre><code class="language-csharp">public class TeaShop{
    public int GetTea(){
        //&#x5EFA;&#x7ACB;&#x4E00;&#x500B;&#x4F9B;&#x61C9;&#x5546;&#x7269;&#x4EF6;
        SupplierA supplierA = new SupplierA();
        
        //&#x5F9E;&#x4F9B;&#x61C9;&#x5546;&#x8CFC;&#x8CB7;600g&#x7684;&#x8336;&#x8449;
        int tea = supplierA.buy(600);
        
        //&#x53D6;&#x5F97;&#x8336;&#x8449;&#x4E26;&#x56DE;&#x50B3;
        return tea;
    }
}
</code></pre>
<p>&#x76EE;&#x524D;&#x6211;&#x628A;SupplierA&#x5BEB;&#x6B7B;&#x5728;&#x98F2;&#x6599;&#x5E97;&#x88E1;&#x7684;GetTea&#x65B9;&#x6CD5;&#x88E1;&#xFF0C;TeaShop&#x9AD8;&#x5EA6;&#x4F9D;&#x8CF4;&#x65BC;SupplierA&#x3002;<br>
&#x958B;&#x5E97;&#x4E00;&#x9663;&#x5B50;&#x5F8C;&#x6211;&#x89BA;&#x5F97;SupplierA&#x63D0;&#x4F9B;&#x7684;&#x8336;&#x6709;&#x602A;&#x5473;&#xFF0C;&#x60F3;&#x63DB;&#x6210;&#x5F9E;SupplierB&#x53EB;&#x8CA8;</p>
<pre><code class="language-csharp">public class TeaShop{
    public int GetTea(){
        //&#x5EFA;&#x7ACB;&#x4E00;&#x500B;&#x4F9B;&#x61C9;&#x5546;&#x7269;&#x4EF6;
        SupplierB supplierB = new SupplierB();
        
        //&#x5F9E;&#x4F9B;&#x61C9;&#x5546;&#x8CFC;&#x8CB7;600g&#x7684;&#x8336;&#x8449;
        int tea = supplierB.buy(600);
        
        //&#x53D6;&#x5F97;&#x8336;&#x8449;&#x4E26;&#x56DE;&#x50B3;
        return tea;
    }
}
</code></pre>
<p>&#x5982;&#x679C;&#x4F9B;&#x61C9;&#x5546;&#x4E00;&#x76F4;&#x63DB;&#xFF0C;&#x6211;&#x7684;&#x7A0B;&#x5F0F;&#x8C48;&#x4E0D;&#x662F;&#x8981;&#x4E00;&#x76F4;&#x6539;&#xFF1F;<br>
&#x5E78;&#x597D;&#x9019;&#x500B;&#x554F;&#x984C;&#x6709;&#x89E3;&#x6C7A;&#x7684;&#x8FA6;&#x6CD5;&#xFF0C;&#x6211;&#x5011;&#x628A;SupplierA&#x548C;SupplierB&#x62BD;&#x8C61;&#x6210;Supplier&#x5C31;&#x7686;&#x5927;&#x6B61;&#x559C;&#x5566;</p>
<pre><code class="language-csharp">public interface ISupplier{
    int buy();
}

public class SupplierA : ISupplier{
    public int buy();
}

public class TeaShop{
    public int GetTea(){
        //&#x5EFA;&#x7ACB;&#x4E00;&#x500B;&#x4F9B;&#x61C9;&#x5546;&#x7269;&#x4EF6;
        ISupplier supplier = new SupplierA();
        
        //&#x5F9E;&#x4F9B;&#x61C9;&#x5546;&#x8CFC;&#x8CB7;600g&#x7684;&#x8336;&#x8449;
        int tea = supplier.buy(600);
        
        //&#x53D6;&#x5F97;&#x8336;&#x8449;&#x4E26;&#x56DE;&#x50B3;
        return tea;
    }
}
</code></pre>
<p>&#x9019;&#x986F;&#x7136;&#x6C92;&#x6709;&#x89E3;&#x6C7A;&#x6211;&#x5011;&#x7684;&#x554F;&#x984C;&#xFF0C;&#x7576;&#x6211;&#x8981;&#x628A;SupplierA&#x63DB;&#x6210;SupplierB&#x6642;&#x9084;&#x662F;&#x6703;&#x66F4;&#x6539;&#x5230;&#x7A0B;&#x5F0F;&#x3002;<br>
&#x5982;&#x679C;&#x6211;&#x8B93;GetTea&#x53EA;&#x95DC;&#x5FC3;&#x8981;&#x8DDF;&#x5EE0;&#x5546;&#x9032;&#x8CA8;&#xFF0C;&#x800C;&#x4E0D;&#x95DC;&#x5FC3;&#x8981;&#x8DDF;&#x54EA;&#x9593;&#x9032;&#x8CA8;&#xFF0C;&#x628A;&#x9019;&#x500B;&#x7169;&#x60F1;&#x4EA4;&#x7D66;&#x5225;&#x4EBA;&#x597D;&#x50CF;&#x554F;&#x984C;&#x5C31;&#x89E3;&#x6C7A;&#x4E86;</p>
<pre><code class="language-csharp">public interface ISupplier{
    int buy();
}

public class SupplierA : ISupplier{
    public int buy();
}

public class TeaShop{
    
    private ISupplier _supplier;
    
    public TeaShop(ISupplier supplier){
        _supplier = supplier;
    }
    
    public int GetTea(){
        
        //&#x5F9E;&#x4F9B;&#x61C9;&#x5546;&#x8CFC;&#x8CB7;600g&#x7684;&#x8336;&#x8449;
        int tea = _supplier.buy(600);
        
        //&#x53D6;&#x5F97;&#x8336;&#x8449;&#x4E26;&#x56DE;&#x50B3;
        return tea;
    }
}
</code></pre>
<p>&#x9019;&#x5C31;&#x662F;&#x5927;&#x5BB6;&#x4FD7;&#x7A31;&#x7684;&#x63A7;&#x5236;&#x53CD;&#x8F49; (Inversion of Control, IoC)&#xFF0C;&#x539F;&#x672C;&#x9AD8;&#x968E;&#x4F9D;&#x8CF4;&#x65BC;&#x4F4E;&#x968E;&#xFF08;TeaShop&#x4F9D;&#x8CF4;&#x65BC;SupplierA&#x6216;SupplierB&#xFF09;&#xFF0C;&#x8B8A;&#x6210;&#x9AD8;&#x968E;&#x88AB;&#x52D5;&#x63A5;&#x6536;&#x4F4E;&#x968E;&#x6A21;&#x7D44;&#xFF08;TeaShop&#x88AB;&#x52D5;&#x63A5;&#x6536;&#x88AB;&#x50B3;&#x5165;&#x7684;supplier&#xFF09;&#x3002;<br>
&#x539F;&#x672C;&#x662F;&#x9AD8;&#x968E;&#x6A21;&#x7D44;&#x76F4;&#x63A5;&#x5EFA;&#x7ACB;&#x4F4E;&#x968E;&#x6A21;&#x7D44;&#xFF0C;&#x7D93;&#x904E;&#x63A7;&#x5236;&#x53CD;&#x8F49;&#x4E4B;&#x5F8C;&#x8B8A;&#x6210;&#x7531;&#x63A7;&#x5236;&#x53CD;&#x8F49;&#x4E2D;&#x5FC3;&#x53BB;&#x5EFA;&#x7ACB;&#x4F4E;&#x968E;&#x6A21;&#x7D44;&#xFF0C;&#x4E26;&#x50B3;&#x7D66;&#x9AD8;&#x968E;&#x6A21;&#x7D44;&#x4F7F;&#x7528;&#x3002;</p>
<p>&#x4F4E;&#x968E;&#x6A21;&#x7D44;&#x7684;&#x7269;&#x4EF6;&#x8981;&#x80FD;&#x5920;&#x88AB;&#x50B3;&#x5165;&#x9AD8;&#x968E;&#x6A21;&#x7D44;&#x5C31;&#x7A31;&#x70BA;&#x4F9D;&#x8CF4;&#x6CE8;&#x5165;&#xFF0C;&#x901A;&#x5E38;&#x6703;&#x5728;&#x9AD8;&#x968E;&#x6A21;&#x7D44;&#x4E2D;&#x4F7F;&#x7528;&#x5169;&#x8005;&#x4F9D;&#x8CF4;&#x7684;&#x4ECB;&#x9762;&#x5BA3;&#x544A;&#x4E00;&#x500B;&#x8B8A;&#x6578;&#xFF08;&#x4F7F;&#x7528;ISupplier&#x5BA3;&#x544A;_supplier&#x8B8A;&#x6578;&#x7528;&#x65BC;&#x5B58;&#x653E;&#x4F4E;&#x968E;&#x6A21;&#x7D44;&#x7269;&#x4EF6;&#xFF09;&#xFF0C;&#x4F7F;&#x7528;&#x5EFA;&#x69CB;&#x5B50;&#x5C07;&#x8A72;&#x7269;&#x4EF6;&#x50B3;&#x5165;&#x4E26;&#x6307;&#x5B9A;&#x7D66;&#x8A72;&#x8B8A;&#x6578;&#xFF0C;&#x4F9B;&#x9AD8;&#x968E;&#x6A21;&#x7D44;&#x4F7F;&#x7528;&#x3002;</p>
<p>&#x8981;&#x7528;&#x54EA;&#x500B;&#x5EE0;&#x5546;&#x7684;&#x554F;&#x984C;&#x662F;&#x89E3;&#x6C7A;&#x4E86;&#xFF0C;&#x4F46;&#x4E5F;&#x9084;&#x6C92;&#x89E3;&#x6C7A;&#xFF0C;&#x6211;&#x5011;&#x53EA;&#x662F;&#x628A;&#x554F;&#x984C;&#x4E1F;&#x7D66;&#x5225;&#x4EBA;&#x4E86;&#xFF0C;&#x9019;&#x6642;&#x8A72;&#x7531;&#x8AB0;&#x4F86;&#x5EFA;&#x7ACB;&#x7269;&#x4EF6;&#x50B3;&#x905E;&#x7269;&#x4EF6;&#x5462;&#xFF1F;&#x6211;&#x5011;&#x9019;&#x6642;&#x5C31;&#x6703;&#x9700;&#x8981;&#x300C;&#x63A7;&#x5236;&#x53CD;&#x8F49;&#x4E2D;&#x5FC3;&#x300D;&#x3002;</p>
<h2 id="%E6%8E%A7%E5%88%B6%E5%8F%8D%E8%BD%89%E4%B8%AD%E5%BF%83">&#x63A7;&#x5236;&#x53CD;&#x8F49;&#x4E2D;&#x5FC3;</h2>
<p>&#x63A7;&#x5236;&#x53CD;&#x8F49;&#x4E2D;&#x5FC3;&#x5C31;&#x662F;&#x5EFA;&#x7ACB;&#x6240;&#x6709;&#x7269;&#x4EF6;&#x53CA;&#x50B3;&#x905E;&#x7269;&#x4EF6;&#x7684;&#x6839;&#xFF0C;&#x4ED6;&#x6703;&#x96C6;&#x7D50;&#x6240;&#x6709;&#x5BE6;&#x9AD4;&#x5206;&#x914D;&#x7D66;&#x5404;&#x500B;&#x7269;&#x4EF6;&#x3002;</p>
<h2 id="aspnet-core%E7%9A%84%E4%BE%9D%E8%B3%B4%E6%B3%A8%E5%85%A5">ASP.Net Core&#x7684;&#x4F9D;&#x8CF4;&#x6CE8;&#x5165;</h2>
<p>&#x5728;ASP.NET&#x4E2D;&#x4F7F;&#x7528;&#x4F9D;&#x8CF4;&#x6CE8;&#x5165;&#x7684;&#x65B9;&#x6CD5;&#x5982;&#x4E0B;<br>
&#x9996;&#x5148;&#xFF0C;&#x5728;&#x5C08;&#x6848;&#x4E2D;&#x52A0;&#x5165;<strong>services</strong>&#x8CC7;&#x6599;&#x593E;&#xFF0C;&#x5728;&#x8CC7;&#x6599;&#x593E;&#x5EFA;&#x7ACB;SupplierAService.cs</p>
<pre><code class="language-csharp">public class SupplierAService{
    public int buy(int gram){
        return gram;
    }
}
</code></pre>
<p>&#x63A5;&#x8457;&#x5C07;SupplierAService&#x670D;&#x52D9;&#x8A3B;&#x518A;&#x5230;WebApplicationBuilder&#xFF0C;&#x8A3B;&#x518A;&#x5B8C;&#x4E4B;&#x5F8C;DI&#x5BB9;&#x5668;&#x4FBF;&#x6703;&#x77E5;&#x9053;ISupplier&#x5C0D;&#x61C9;&#x7684;&#x5BE6;&#x4F5C;&#x662F;SupplierAService&#xFF0C;&#x7576;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x5230;ISupplier&#x6642;&#x4FBF;&#x6703;&#x5E6B;&#x6211;&#x5011;&#x627E;&#x5230;SupplierAService&#xFF0C;new&#x51FA;&#x7269;&#x4EF6;&#x4E4B;&#x5F8C;&#x5E6B;&#x6211;&#x5011;&#x4E1F;&#x5230;&#x9AD8;&#x968E;&#x5BB9;&#x5668;&#x4E2D;&#x6CE8;&#x5165;&#xFF0C;&#x8D85;&#x7D1A;&#x65B9;&#x4FBF;&#xFF01;&#xFF01;</p>
<pre><code class="language-csharp">public static void Main(string[] args){
    var builder = WebApplication.CreateBuilder(args);
    ...
    builder.Services.AddTransient&lt;ISupplier,SupplierAService&gt;();
    ...
    var app = builder.Build();
}
</code></pre>
<p>&#x4F8B;&#x5982;&#x7576;TeaShopController&#x6709;&#x8981;&#x7528;&#x5230;ISupplier&#x670D;&#x52D9;&#x6642;&#xFF0C;&#x53EA;&#x9700;&#x8981;&#x5728;&#x5EFA;&#x69CB;&#x5F0F;&#x50B3;&#x5165;ISupplier&#x5373;&#x53EF;&#x4F7F;&#x7528;</p>
<pre><code class="language-csharp">public class TeaShopController{
    private ISupplier _supplier;
    
    public TeaShopController(ISupplier supplier){
        _supplier = supplier;
    }
    
    public int GetTea(){
        
        //&#x5F9E;&#x4F9B;&#x61C9;&#x5546;&#x8CFC;&#x8CB7;600g&#x7684;&#x8336;&#x8449;
        int tea = _supplier.buy(600);
        
        //&#x53D6;&#x5F97;&#x8336;&#x8449;&#x4E26;&#x56DE;&#x50B3;
        return tea;
    }  
}

</code></pre>
<h6 id="%E5%8F%83%E8%80%83%E8%B3%87%E6%96%99">&#x53C3;&#x8003;&#x8CC7;&#x6599;</h6>
<ul>
<li><a href="https://igouist.github.io/post/2021/11/newbie-6-dependency-injection/?ref=localhost">&#x83DC;&#x96DE;&#x65B0;&#x8A13;&#x8A18; (6): &#x4F7F;&#x7528; &#x4F9D;&#x8CF4;&#x6CE8;&#x5165; (Dependency Injection) &#x4F86;&#x89E3;&#x9664;&#x5F37;&#x8026;&#x5408;&#x5427;</a></li>
<li><a href="https://old-oomusou.goodjack.tw/netcore/di/?ref=localhost">&#x5982;&#x4F55;&#x5728; .NET Core &#x4F7F;&#x7528; DI ?</a></li>
<li><a href="https://www.youtube.com/watch&amp;ref=localhost">Dependency Injection in .NET Core (.NET 6)</a></li>
<li><a href="https://medium.com/wenchin-rolls-around/%E6%B7%BA%E5%85%A5%E6%B7%BA%E5%87%BA-dependency-injection-ea672ba033ca?ref=localhost">&#x6DFA;&#x5165;&#x6DFA;&#x51FA; Dependency Injection</a></li>
<li><a href="https://learn.microsoft.com/zh-tw/dotnet/core/extensions/dependency-injection?ref=localhost">.NET &#x76F8;&#x4F9D;&#x6027;&#x63D2;&#x5165;</a></li>
</ul>
<!--kg-card-end: markdown-->]]></content:encoded></item><item><title><![CDATA[ASP.NET中RenderSection的作用]]></title><description><![CDATA[專案中的各個Page會被插入到_Layout.cshtml裡@RenderBody()的位置，與主版面整合。若Page中的某段程式不想被放在body內時，可以使用Section及RenderSection改變程式碼在_Layout.cshtml中的插入位置。]]></description><link>https://vincent87720.github.io/aspnet-core-render-section/</link><guid isPermaLink="false">64db19c5e17ae60001fb73af</guid><category><![CDATA[ASP.NET Core]]></category><category><![CDATA[C#]]></category><dc:creator><![CDATA[Katsuobushi]]></dc:creator><pubDate>Tue, 15 Aug 2023 06:25:07 GMT</pubDate><media:content url="https://vincent87720.github.io/content/images/2023/08/vs2012_gray_imprint-1.png" medium="image"/><content:encoded><![CDATA[<!--kg-card-begin: markdown--><img src="https://vincent87720.github.io/content/images/2023/08/vs2012_gray_imprint-1.png" alt="ASP.NET&#x4E2D;RenderSection&#x7684;&#x4F5C;&#x7528;"><p>&#x5C08;&#x6848;&#x4E2D;&#x7684;&#x5404;&#x500B;Page&#x6703;&#x88AB;&#x63D2;&#x5165;&#x5230;_Layout.cshtml&#x88E1;@RenderBody()&#x7684;&#x4F4D;&#x7F6E;&#xFF0C;&#x8207;&#x4E3B;&#x7248;&#x9762;&#x6574;&#x5408;&#x3002;&#x82E5;Page&#x4E2D;&#x7684;&#x67D0;&#x6BB5;&#x7A0B;&#x5F0F;&#x4E0D;&#x60F3;&#x88AB;&#x653E;&#x5728;body&#x5167;&#x6642;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;Section&#x53CA;RenderSection&#x6539;&#x8B8A;&#x7A0B;&#x5F0F;&#x78BC;&#x5728;_Layout.cshtml&#x4E2D;&#x7684;&#x63D2;&#x5165;&#x4F4D;&#x7F6E;&#x3002;</p>
<p>&#x672C;&#x6B21;&#x7684;&#x4F7F;&#x7528;&#x60C5;&#x5883;&#x662F;&#x60F3;&#x8981;&#x5728;&#x9801;&#x9762;&#x4E2D;&#x52A0;&#x5165;JavaScript&#x6A94;&#x6848;&#xFF0C;&#x4F46;&#x60F3;&#x8981;&#x8B93;&#x4ED6;&#x5728;_Layout.cshtml&#x7684;&#x6700;&#x5C3E;&#x7AEF;&#x624D;&#x88AB;&#x8B80;&#x53D6;&#xFF0C;&#x6545;&#x4F7F;&#x7528;Section&#x53CA;RenderSection&#x6539;&#x8B8A;&#x7A0B;&#x5F0F;&#x78BC;&#x7684;&#x63D2;&#x5165;&#x4F4D;&#x7F6E;&#x3002;</p>
<h2 id="%E5%BB%BA%E7%AB%8Bsection%E5%8D%80%E5%A1%8A">&#x5EFA;&#x7ACB;Section&#x5340;&#x584A;</h2>
<p>&#x5728;<code>Index.cshtml</code>&#x4E2D;&#x52A0;&#x5165;Section&#x5340;&#x584A;&#xFF0C;&#x5C07;&#x8981;&#x63D2;&#x5165;&#x7684;&#x7A0B;&#x5F0F;&#x78BC;&#x653E;&#x5728;&#x5927;&#x62EC;&#x5F27;&#x4E2D;</p>
<pre><code class="language-csharp">&lt;div id=&quot;index&quot;&gt;
    &lt;section class=&quot;section&quot;&gt;
    ...
    &lt;/section&gt;
&lt;/div&gt;

@section Scripts {
    &lt;script type=&quot;module&quot; src=&quot;~/js/Index.min.js&quot; asp-append-version=&quot;true&quot;&gt;&lt;/script&gt;
}

</code></pre>
<p>@section&#x5F8C;&#x9762;&#x7684;Scripts&#x53EF;&#x4EE5;&#x81EA;&#x5B9A;&#x7FA9;&#x540D;&#x7A31;&#xFF0C;&#x5FC5;&#x9808;&#x5C0D;&#x61C9;&#x5230;RenderSection&#x51FD;&#x5F0F;&#x5167;&#x50B3;&#x5165;&#x7684;&#x540D;&#x7A31;</p>
<h2 id="%E4%BD%BF%E7%94%A8rendersection%E6%8F%92%E5%85%A5%E7%A8%8B%E5%BC%8F%E7%A2%BC">&#x4F7F;&#x7528;RenderSection&#x63D2;&#x5165;&#x7A0B;&#x5F0F;&#x78BC;</h2>
<p>&#x5728;<code>_Layout.cshtml</code>&#x4E2D;&#x9078;&#x64C7;&#x4E00;&#x500B;&#x98A8;&#x6C34;&#x5BF6;&#x5730;&#x5C07;RenderSection&#x52A0;&#x5165;&#x7A0B;&#x5F0F;&#x4E2D;&#xFF0C;&#x7528;&#x4EE5;&#x63D2;&#x5165;&#x5728;Section&#x4E2D;&#x7684;&#x7A0B;&#x5F0F;&#x78BC;</p>
<pre><code class="language-csharp">&lt;body&gt;
    &lt;div id=&quot;app&quot;&gt;
        &lt;header class=&quot;header&quot;&gt;
        ...
        &lt;/header&gt;
    &lt;/div&gt;
    @RenderBody()

    &lt;script type=&quot;module&quot; src=&quot;~/js/App.min.js&quot; asp-append-version=&quot;true&quot;&gt;&lt;/script&gt;
    @RenderSection(&quot;Scripts&quot;, required: false)
&lt;/body&gt;

</code></pre>
<h6 id="%E5%8F%83%E8%80%83%E8%B3%87%E6%96%99">&#x53C3;&#x8003;&#x8CC7;&#x6599;</h6>
<ul>
<li><a href="https://ithelp.ithome.com.tw/articles/10159990?ref=localhost">&#x8A8D;&#x8B58;View - View&#x7684;&#x7A2E;&#x985E;</a></li>
<li><a href="http://white1027.blogspot.com/2013/10/mvc-razor-rendersection.html?ref=localhost">[MVC] Razor @RenderSection &#x4F7F;&#x7528;&#x5FC3;&#x5F97;</a></li>
<li><a href="https://learn.microsoft.com/en-us/aspnet/core/mvc/views/layout?view=aspnetcore-7.0&amp;ref=localhost">Layout in ASP.NET Core</a></li>
</ul>
<!--kg-card-end: markdown-->]]></content:encoded></item><item><title><![CDATA[叢集索引與非叢集索引]]></title><description><![CDATA[通常資料庫在尋找資料是逐行檢查，看看每一筆資料是否符合條件，若符合則拿出，不符合就往下一筆直到結束，稱為Full table scan。

隨著資料量越來越大，查找的時間也會跟著變慢，使用Index可以加快查詢速度。]]></description><link>https://vincent87720.github.io/clustered-and-nonclustered-indexes/</link><guid isPermaLink="false">64da6975e17ae60001fb739e</guid><category><![CDATA[Database]]></category><dc:creator><![CDATA[Katsuobushi]]></dc:creator><pubDate>Mon, 14 Aug 2023 17:53:35 GMT</pubDate><media:content url="https://vincent87720.github.io/content/images/2023/08/jan-antonin-kolar-lRoX0shwjUQ-unsplash_database.jpeg" medium="image"/><content:encoded><![CDATA[<!--kg-card-begin: markdown--><img src="https://vincent87720.github.io/content/images/2023/08/jan-antonin-kolar-lRoX0shwjUQ-unsplash_database.jpeg" alt="&#x53E2;&#x96C6;&#x7D22;&#x5F15;&#x8207;&#x975E;&#x53E2;&#x96C6;&#x7D22;&#x5F15;"><p>&#x901A;&#x5E38;&#x8CC7;&#x6599;&#x5EAB;&#x5728;&#x5C0B;&#x627E;&#x8CC7;&#x6599;&#x662F;&#x9010;&#x884C;&#x6AA2;&#x67E5;&#xFF0C;&#x770B;&#x770B;&#x6BCF;&#x4E00;&#x7B46;&#x8CC7;&#x6599;&#x662F;&#x5426;&#x7B26;&#x5408;&#x689D;&#x4EF6;&#xFF0C;&#x82E5;&#x7B26;&#x5408;&#x5247;&#x62FF;&#x51FA;&#xFF0C;&#x4E0D;&#x7B26;&#x5408;&#x5C31;&#x5F80;&#x4E0B;&#x4E00;&#x7B46;&#x76F4;&#x5230;&#x7D50;&#x675F;&#xFF0C;&#x7A31;&#x70BA;Full table scan&#x3002;</p>
<p>&#x96A8;&#x8457;&#x8CC7;&#x6599;&#x91CF;&#x8D8A;&#x4F86;&#x8D8A;&#x5927;&#xFF0C;&#x67E5;&#x627E;&#x7684;&#x6642;&#x9593;&#x4E5F;&#x6703;&#x8DDF;&#x8457;&#x8B8A;&#x6162;&#xFF0C;&#x4F7F;&#x7528;Index&#x53EF;&#x4EE5;&#x52A0;&#x5FEB;&#x67E5;&#x8A62;&#x901F;&#x5EA6;&#x3002;</p>
<p>&#x82E5;&#x5728;&#x67D0;&#x6B04;&#x4F4D;&#x8A2D;&#x5B9A;Index&#xFF0C;&#x8CC7;&#x6599;&#x5EAB;&#x6703;&#x53E6;&#x5916;&#x5EFA;&#x7ACB;&#x4E00;&#x5F35;&#x8868;&#xFF0C;&#x7528;&#x65BC;&#x5C0D;&#x61C9;&#x8A72;&#x6B04;&#x4F4D;&#x8207;&#x5B8C;&#x6574;&#x8CC7;&#x6599;&#xFF0C;&#x4E26;&#x63A1;&#x7528;Binary Search Algorithm&#x6216;&#x66F4;&#x5FEB;&#x7684;&#x6F14;&#x7B97;&#x6CD5;&#x53D6;&#x5F97;&#x8CC7;&#x6599;&#xFF0C;&#x4EE5;&#x9054;&#x6210;&#x52A0;&#x5FEB;&#x641C;&#x5C0B;&#x7684;&#x76EE;&#x7684;&#x3002;</p>
<p>&#x8CC7;&#x6599;&#x7D50;&#x69CB;&#x65B9;&#x9762;&#x901A;&#x5E38;&#x6703;&#x4F7F;&#x7528;Hash&#x6216;B-tree&#x5BE6;&#x4F5C;&#x3002;<br>
Hash&#x901A;&#x5E38;&#x7528;&#x65BC;&#x5132;&#x5B58;&#x4E0D;&#x80FD;&#x91CD;&#x8907;&#x7684;&#x8CC7;&#x6599;&#xFF0C;&#x4F8B;&#x5982;Primary Index&#x6216;Unique Index&#x3002;<br>
B-tree&#x5247;&#x9069;&#x5408;&#x5132;&#x5B58;&#x5141;&#x8A31;&#x91CD;&#x8907;&#x7684;&#x503C;&#xFF0C;&#x4F8B;&#x5982;Non-Unique Index</p>
<h2 id="%E7%B4%A2%E5%BC%95%E7%9A%84%E7%BC%BA%E9%BB%9E">&#x7D22;&#x5F15;&#x7684;&#x7F3A;&#x9EDE;</h2>
<ul>
<li>&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#x6703;&#x984D;&#x5916;&#x5EFA;&#x7ACB;&#x4E00;&#x5F35;&#x8868;&#xFF0C;&#x62FF;&#x7A7A;&#x9593;&#x63DB;&#x53D6;&#x6642;&#x9593;</li>
<li>&#x5728;&#x66F4;&#x52D5;&#x8CC7;&#x6599;&#x6642;&#x6703;&#x9023;&#x52D5;&#x5230;&#x7D22;&#x5F15;&#x8868;&#xFF0C;&#x82E5;&#x8A72;&#x8868;&#x6703;&#x983B;&#x7E41;&#x4FEE;&#x6539;&#x5247;&#x6703;&#x5C0D;&#x8CC7;&#x6599;&#x5EAB;&#x9020;&#x6210;&#x8CA0;&#x64D4;</li>
</ul>
<h2 id="%E5%8F%A2%E9%9B%86%E7%B4%A2%E5%BC%95%EF%BC%88clustered-index%EF%BC%89">&#x53E2;&#x96C6;&#x7D22;&#x5F15;&#xFF08;Clustered Index&#xFF09;</h2>
<ul>
<li>&#x4E00;&#x500B;&#x8CC7;&#x6599;&#x8868;&#x53EA;&#x6703;&#x6709;&#x4E00;&#x500B;&#x53E2;&#x96C6;&#x7D22;&#x5F15;&#xFF0C;&#x901A;&#x5E38;&#x662F;&#x4E3B;&#x9375;&#xFF08;Primary Key&#xFF09;&#x6B04;&#x4F4D;</li>
<li>&#x8CC7;&#x6599;&#x8868;&#x6703;&#x76F4;&#x63A5;&#x4F9D;&#x7167;&#x53E2;&#x96C6;&#x7D22;&#x5F15;&#x7684;&#x9806;&#x5E8F;&#x6392;&#x5217;&#xFF0C;&#x641C;&#x5C0B;&#x901F;&#x5EA6;&#x6703;&#x975E;&#x5E38;&#x5FEB;&#x901F;</li>
<li>&#x5BE6;&#x9AD4;&#x7684;&#x8CC7;&#x6599;&#x8868;&#x8207;&#x7D22;&#x5F15;&#x8868;&#x7684;&#x9806;&#x5E8F;&#x662F;&#x4E00;&#x6A23;&#x7684;</li>
</ul>
<h2 id="%E9%9D%9E%E5%8F%A2%E9%9B%86%E7%B4%A2%E5%BC%95%EF%BC%88non-clustered-index%EF%BC%89">&#x975E;&#x53E2;&#x96C6;&#x7D22;&#x5F15;&#xFF08;Non-Clustered Index&#xFF09;</h2>
<ul>
<li>&#x4E00;&#x500B;&#x8CC7;&#x6599;&#x8868;&#x4E2D;&#x53EF;&#x4EE5;&#x6709;&#x591A;&#x500B;&#x975E;&#x53E2;&#x96C6;&#x7D22;&#x5F15;</li>
<li>&#x4E0D;&#x6703;&#x8B8A;&#x52D5;&#x8CC7;&#x6599;&#x8868;&#x7684;&#x9806;&#x5E8F;&#xFF0C;&#x53EA;&#x6703;&#x5728;&#x7D22;&#x5F15;&#x8868;&#x4E2D;&#x4F9D;&#x7167;&#x7D22;&#x5F15;&#x6B04;&#x4F4D;&#x81EA;&#x884C;&#x6392;&#x5E8F;</li>
</ul>
<h2 id="%E4%BD%BF%E7%94%A8%E7%B4%A2%E5%BC%95%E7%9A%84%E6%99%82%E6%A9%9F">&#x4F7F;&#x7528;&#x7D22;&#x5F15;&#x7684;&#x6642;&#x6A5F;</h2>
<ul>
<li>&#x4E3B;&#x9375; Primary Key</li>
<li>&#x5916;&#x90E8;&#x9375; Foreign Key</li>
<li>&#x5E38;&#x88AB;&#x653E;&#x5728;ORDER, WHERE, GROUP&#x7B49;&#x67E5;&#x8A62;&#x7684;&#x6B04;&#x4F4D;</li>
</ul>
<h6 id="%E5%8F%83%E8%80%83%E8%B3%87%E6%96%99">&#x53C3;&#x8003;&#x8CC7;&#x6599;</h6>
<ul>
<li><a href="https://learn.microsoft.com/zh-tw/sql/relational-databases/indexes/clustered-and-nonclustered-indexes-described?view=sql-server-ver16&amp;ref=localhost">&#x53E2;&#x96C6;&#x8207;&#x975E;&#x53E2;&#x96C6;&#x7D22;&#x5F15;&#x8AAA;&#x660E;</a></li>
<li><a href="https://medium.com/@jinghua.shih/rails-%E7%B6%B2%E7%AB%99%E6%95%88%E8%83%BD%E5%84%AA%E5%8C%96-%E4%BA%8C-%E8%B3%87%E6%96%99%E5%BA%AB%E7%B4%A2%E5%BC%95-database-index-bd89fa3757a?ref=localhost">[Rails &#x6548;&#x80FD;&#x512A;&#x5316;] &#x8CC7;&#x6599;&#x5EAB;&#x7D22;&#x5F15; Database Indexing</a></li>
<li><a href="https://medium.com/omarelgabrys-blog/database-indexing-and-transactions-part-9-a24781d429f8?ref=localhost">Database &#x2014; Indexing, Transactions &amp; Stored Procedures (Part 9)</a></li>
</ul>
<!--kg-card-end: markdown-->]]></content:encoded></item></channel></rss>